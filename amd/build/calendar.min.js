define("mod_bookit/calendar",["exports","core/str","core_form/modalform","core/prefetch","./filter_manager","./filter_ui"],(function(_exports,_str,_modalform,_prefetch,_filter_manager,_filter_ui){function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.init=async function(cmid,instanceid,eventsource,lang,permissions){_prefetch.default.prefetchString("mod_bookit","addbooking"),await(globalPropertyName="EventCalendar",new Promise((resolve=>{const innerWait=()=>{window[globalPropertyName]||setTimeout(innerWait,20),resolve()};innerWait()}))),_prefetch.default.prefetchStrings("mod_bookit",["addbooking"]),_prefetch.default.prefetchStrings("core",["today","month","week"]),_prefetch.default.prefetchStrings("core_calendar",["day","upcomingevents"]);var globalPropertyName;const str_request_booking=await(0,_str.get_string)("addbooking","mod_bookit"),str_today=await(0,_str.get_string)("today","core"),str_month=await(0,_str.get_string)("month","core"),str_week=await(0,_str.get_string)("week","core"),str_day=await(0,_str.get_string)("day","core_calendar"),str_list=await(0,_str.get_string)("upcomingevents","core_calendar");let viewType="timeGridWeek";window.screen.width<=1e3&&(viewType="listWeek");const filterManager=new _filter_manager.FilterManager,filterUI=new _filter_ui.FilterUI;await filterUI.init(permissions.isAdmin||permissions.isServiceTeam),filterManager.init();const calendar=new window.EventCalendar(document.getElementById("ec"),{locale:lang,view:viewType,firstDay:1,scrollTime:"09:00:00",slotMinTime:"07:00:00",slotMaxTime:"22:00:00",dayMaxEvents:!0,nowIndicator:!0,selectable:!0,eventStartEditable:!1,eventDurationEditable:!1,hiddenDays:[0,6],buttonText:function(text){return text.today=str_today,text.dayGridMonth=str_month,text.timeGridWeek=str_week,text.timeGridDay=str_day,text.listWeek=str_list,text},customButtons:{addButton:{text:str_request_booking,click:function(){const modalForm=new _modalform.default({formClass:"mod_bookit\\form\\edit_event_form",args:{cmid:cmid},modalConfig:{title:(0,_str.get_string)("edit_event","mod_bookit")}});modalForm.addEventListener(modalForm.events.FORM_SUBMITTED,(()=>{calendar.refetchEvents()})),modalForm.show()}}},dateClick:function(info){const modalForm=new _modalform.default({formClass:"mod_bookit\\form\\edit_event_form",args:{cmid:cmid,startdate:info.dateStr},modalConfig:{title:(0,_str.get_string)("add_event","mod_bookit")}});modalForm.addEventListener(modalForm.events.FORM_SUBMITTED,(()=>{calendar.refetchEvents()})),modalForm.show()},eventClick:function(info){if("reserved"!==info.event.title.toLowerCase()){const modalForm=new _modalform.default({formClass:"mod_bookit\\form\\edit_event_form",args:{cmid:cmid,id:info.event.id},modalConfig:{title:(0,_str.get_string)("edit_event","mod_bookit")}});modalForm.addEventListener(modalForm.events.FORM_SUBMITTED,(()=>{calendar.refetchEvents()})),modalForm.show()}},headerToolbar:{start:"prev,next today addButton",center:"title",end:"dayGridMonth,timeGridWeek,timeGridDay,listWeek"},eventSources:[{url:eventsource,method:"POST",extraParams:function(){const params={id:String(cmid)},filters=filterManager.filters;return filters&&(filters.search&&(params.search=String(filters.search)),filters.room&&(params.roomid=String(filters.room)),filters.faculty&&(params.facultyid=String(filters.faculty)),void 0!==filters.status&&""!==filters.status&&(params.status=parseInt(filters.status,10)),filters.timeslot&&(params.timeslot=String(filters.timeslot))),params}}]});document.addEventListener("filterchange",(event=>{filterManager.filters=event.detail,calendar.refetchEvents()}))},_modalform=_interopRequireDefault(_modalform),_prefetch=_interopRequireDefault(_prefetch)}));

//# sourceMappingURL=calendar.min.js.map