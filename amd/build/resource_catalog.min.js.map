{"version":3,"file":"resource_catalog.min.js","sources":["../src/resource_catalog.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Resource catalog reactive component.\n *\n * @module mod_bookit/resource_catalog\n * @copyright   2026 ssystems GmbH <oss@ssystems.de>\n * @author      Andreas Rosenthal\n * @license     http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\nimport {BaseComponent} from 'core/reactive';\nimport {resourceReactiveInstance, initResourceReactive} from './resource_reactive';\nimport ModalForm from 'core_form/modalform';\nimport {get_string as getString} from 'core/str';\nimport Ajax from 'core/ajax';\nimport ResourceCategory from './resource_category';\n\n/**\n * Resource catalog component.\n */\nexport default class extends BaseComponent {\n    /**\n     * Static init method.\n     *\n     * @param {string} target - CSS selector for container element\n     * @return {ResourceCatalog} Component instance\n     */\n    static init(target) {\n        // Get container element.\n        const element = document.querySelector(target);\n        if (!element) {\n            return null;\n        }\n\n        // Read contextId from DOM.\n        const contextId = parseInt(element.dataset.contextid);\n\n        // Read categories and resources from DOM.\n        const categoriesArray = [];\n        const itemsArray = [];\n\n        const categoryElements = element.querySelectorAll('[data-region=\"resource-category\"]');\n        categoryElements.forEach(categoryEl => {\n            const categoryRow = categoryEl.querySelector('[data-region=\"resource-category-row\"]');\n            const categoryData = {\n                id: parseInt(categoryEl.dataset.categoryid),\n                name: categoryEl.dataset.categoryName || categoryRow?.textContent.trim(),\n                description: categoryEl.dataset.categoryDescription || '',\n                sortorder: parseInt(categoryEl.dataset.categorySortorder) || 0,\n            };\n            categoriesArray.push(categoryData);\n\n            // Read resources for this category.\n            const itemElements = categoryEl.querySelectorAll('[data-region=\"resource-item-row\"]');\n            itemElements.forEach(itemEl => {\n                // Parse roomids from JSON string.\n                let roomids = [];\n                if (itemEl.dataset.itemRoomids) {\n                    try {\n                        roomids = JSON.parse(itemEl.dataset.itemRoomids);\n                        if (!Array.isArray(roomids)) {\n                            roomids = [];\n                        }\n                    } catch (e) {\n                        window.console.warn('Failed to parse roomids:', e);\n                        roomids = [];\n                    }\n                }\n\n                const itemData = {\n                    id: parseInt(itemEl.dataset.itemid),\n                    name: itemEl.dataset.itemName || '',\n                    description: itemEl.dataset.itemDescription || '',\n                    categoryid: parseInt(itemEl.dataset.itemCategoryid),\n                    amount: parseInt(itemEl.dataset.itemAmount) || 0,\n                    amountirrelevant: itemEl.dataset.itemAmountirrelevant === '1',\n                    active: itemEl.dataset.itemActive === '1',\n                    sortorder: parseInt(itemEl.dataset.itemSortorder) || 0,\n                    roomids: roomids,\n                };\n                itemsArray.push(itemData);\n            });\n        });\n\n        // Initialize reactive store.\n        initResourceReactive({\n            categories: categoriesArray,\n            items: itemsArray,\n        });\n\n        return new this({\n            element: element,\n            reactive: resourceReactiveInstance,\n            selectors: {contextId},\n        });\n    }\n\n    /**\n     * Component descriptor for debugging.\n     *\n     * @return {string} Component name\n     */\n    static get componentName() {\n        return 'mod_bookit/resource_catalog';\n    }\n\n    /**\n     * Create component.\n     *\n     * Called by BaseComponent constructor.\n     */\n    create() {\n        this.selectors.addCategoryBtn = '#add-category-btn';\n        this.selectors.addResourceBtn = '#add-resource-btn';\n        this.selectors.tableView = '#mod-bookit-resource-table-view';\n        this.categoryComponents = new Map();\n\n        // Cache localized strings for active/inactive.\n        this.strings = {};\n        getString('active', 'core').then(str => {\n            this.strings.active = str;\n            return str;\n        }).catch(() => {\n            this.strings.active = 'Active';\n        });\n        getString('inactive', 'core').then(str => {\n            this.strings.inactive = str;\n            return str;\n        }).catch(() => {\n            this.strings.inactive = 'Inactive';\n        });\n    }\n\n    /**\n     * Initial state ready.\n     *\n     * Called when reactive state is ready.\n     */\n    stateReady() {\n        this._initializeCategoryComponents();\n        this._attachEventListeners();\n    }\n\n    /**\n     * Get state watchers.\n     *\n     * @return {Array} Array of watcher definitions\n     */\n    getWatchers() {\n        return [\n            {watch: `categories:created`, handler: this._handleCategoryCreated},\n            {watch: `categories.name:updated`, handler: this._handleCategoryUpdated},\n            {watch: `categories.description:updated`, handler: this._handleCategoryUpdated},\n            {watch: `categories:deleted`, handler: this._handleCategoryDeleted},\n            {watch: `items:created`, handler: this._handleItemCreated},\n            {watch: `items.active:updated`, handler: this._handleActiveToggle},\n            {watch: `items.name:updated`, handler: this._replaceRenderedItem},\n            {watch: `items.description:updated`, handler: this._replaceRenderedItem},\n            {watch: `items.amount:updated`, handler: this._replaceRenderedItem},\n            {watch: `items.amountirrelevant:updated`, handler: this._replaceRenderedItem},\n            {watch: `items.roomids:updated`, handler: this._handleRoomidsUpdated},\n            {watch: `items.roomnames:updated`, handler: this._handleRoomnamesUpdated},\n        ];\n    }\n\n    /**\n     * Handle category created.\n     *\n     * @param {Object} args - Event args\n     * @param {Object} args.element - New category data\n     */\n    async _handleCategoryCreated({element}) {\n        await this._renderCategory(element);\n    }\n\n    /**\n     * Handle category updated.\n     *\n     * @param {Object} args - Event args\n     * @param {Object} args.element - Updated category data\n     */\n    _handleCategoryUpdated({element}) {\n        const component = this.categoryComponents.get(element.id);\n        if (component) {\n            component.update(element);\n        }\n    }\n\n    /**\n     * Handle category deleted.\n     *\n     * @param {Object} args - Event args\n     * @param {Object} args.element - Deleted category data\n     */\n    _handleCategoryDeleted({element}) {\n        const component = this.categoryComponents.get(element.id);\n        if (component) {\n            component.remove();\n            this.categoryComponents.delete(element.id);\n        }\n    }\n\n    /**\n     * Handle item created.\n     *\n     * Item creation is handled by the category component.\n     */\n    _handleItemCreated() {\n        // Category component handles this via its watchers.\n    }\n\n    /**\n     * Handle active state toggle.\n     *\n     * @param {Object} args - Event args\n     * @param {Object} args.element - Updated item data\n     */\n    _handleActiveToggle({element}) {\n        const checkbox = document.querySelector(`#resource-active-${element.id}`);\n        if (!checkbox) {\n            window.console.warn(`Toggle checkbox not found for item ${element.id}`);\n            return;\n        }\n        checkbox.checked = element.active;\n\n        const label = document.querySelector(`label[for=\"resource-active-${element.id}\"]`);\n        if (label) {\n            label.textContent = element.active ?\n                (this.strings.active || 'Active') :\n                (this.strings.inactive || 'Inactive');\n        }\n\n        const row = document.querySelector(`#resource-item-row-${element.id}`);\n        if (row) {\n            row.classList.toggle('opacity-50', !element.active);\n        }\n    }\n\n    /**\n     * Replace rendered item field (follows masterchecklist pattern).\n     *\n     * @param {Object} event - Event object\n     */\n    async _replaceRenderedItem(event) {\n        const actionParts = event.action.split('.');\n        const fieldPart = actionParts[1].split(':')[0];\n        const item = this.reactive.state.items.get(event.element.id);\n\n        if (fieldPart === 'amount' || fieldPart === 'amountirrelevant') {\n            const amountCell = document.querySelector(`td[data-bookit-resource-tabledata-amount-id=\"${item.id}\"]`);\n            if (!amountCell) {\n                return;\n            }\n            if (item.amountirrelevant) {\n                amountCell.innerHTML = '<span class=\"badge badge-secondary\">Unlimited</span>';\n            } else {\n                amountCell.innerHTML = `<span class=\"badge badge-info\">${item.amount}x</span>`;\n            }\n        } else if (fieldPart === 'name') {\n            const nameSpan = document.querySelector(`span[data-bookit-resource-tabledata-name-id=\"${item.id}\"]`);\n            if (!nameSpan) {\n                return;\n            }\n            nameSpan.textContent = item.name;\n        } else if (fieldPart === 'description') {\n            await this._updateDescriptionField(item);\n        }\n    }\n\n    /**\n     * Update description field in the DOM.\n     *\n     * @param {Object} item - Item data\n     */\n    async _updateDescriptionField(item) {\n        const descSpan = document.querySelector(`small[data-bookit-resource-tabledata-description-id=\"${item.id}\"]`);\n        if (descSpan) {\n            descSpan.innerHTML = item.description || '';\n            return;\n        }\n\n        // Description was added but <small> element doesn't exist - need to re-render row.\n        if (!item.description) {\n            return;\n        }\n\n        const row = document.querySelector(`#resource-item-row-${item.id}`);\n        if (!row) {\n            return;\n        }\n\n        // Find category component and trigger re-render.\n        const categoryComponent = Array.from(this.categoryComponents.values())\n            .find(cat => cat.categoryData.id === item.categoryid);\n        if (!categoryComponent) {\n            return;\n        }\n\n        try {\n            await categoryComponent._renderItems();\n        } catch (error) {\n            window.console.error('Failed to re-render items:', error);\n        }\n    }\n\n    /**\n     * Handle roomnames updated.\n     *\n     * @param {Object} event - Event object\n     */\n    _handleRoomnamesUpdated(event) {\n        const item = this.reactive.state.items.get(event.element.id);\n        window.console.log('[BOOKIT DEBUG] _handleRoomnamesUpdated fired for item:', event.element.id);\n        if (!item) {\n            window.console.log('[BOOKIT DEBUG] Item not found in state');\n            return;\n        }\n\n        window.console.log('[BOOKIT DEBUG] Item roomnames:', item.roomnames, 'length:', item.roomnames?.length);\n\n        const roomsCell = document.querySelector(`td[data-bookit-resource-tabledata-roomids-id=\"${item.id}\"]`);\n        if (!roomsCell) {\n            window.console.log('[BOOKIT DEBUG] Rooms cell not found');\n            return;\n        }\n\n        // Clear existing content.\n        roomsCell.innerHTML = '<div class=\"d-flex flex-wrap align-items-center\"></div>';\n        const container = roomsCell.querySelector('div');\n\n        if (!item.roomnames || item.roomnames.length === 0) {\n            // Show \"All rooms\" badge.\n            window.console.log('[BOOKIT DEBUG] Showing \"All rooms\" badge (roomnames empty)');\n            container.innerHTML = '<span class=\"badge badge-secondary\">All rooms</span>';\n        } else {\n            window.console.log('[BOOKIT DEBUG] Rendering room badges:', item.roomnames);\n            // Render room badges with colors.\n            item.roomnames.forEach(room => {\n                const badge = document.createElement('span');\n                badge.className = `badge ${room.textclass} mr-1 mb-1`;\n                badge.style.opacity = '0.8';\n                badge.style.backgroundColor = room.eventcolor;\n                badge.dataset.bookitResourceTabledataRoomColor = room.eventcolor;\n                badge.dataset.bookitResourceTabledataRoomTextclass = room.textclass;\n                badge.dataset.bookitResourceTabledataRoomId = room.roomid;\n                badge.dataset.bookitResourceRoomname = room.roomname;\n                badge.dataset.bookitResourceTabledataIsRoomElement = '';\n                badge.textContent = room.roomname;\n                container.appendChild(badge);\n            });\n        }\n    }\n\n    /**\n     * Handle roomids updated.\n     *\n     * @param {Object} event - Event object\n     */\n    _handleRoomidsUpdated(event) {\n        const item = this.reactive.state.items.get(event.element.id);\n        if (!item) {\n            return;\n        }\n\n        const row = document.querySelector(`tr[data-itemid=\"${item.id}\"]`);\n        if (!row) {\n            return;\n        }\n\n        // Update data-item-roomids attribute with JSON string.\n        row.dataset.itemRoomids = JSON.stringify(item.roomids || []);\n    }\n\n    /**\n     * Attach event listeners.\n     */\n    _attachEventListeners() {\n        const addBtn = document.querySelector(this.selectors.addCategoryBtn);\n        if (addBtn) {\n            addBtn.addEventListener('click', (e) => {\n                e.preventDefault();\n                this._handleAddCategory();\n            });\n        }\n\n        const addResourceBtn = document.querySelector(this.selectors.addResourceBtn);\n        if (addResourceBtn) {\n            addResourceBtn.addEventListener('click', (e) => {\n                e.preventDefault();\n                this._handleAddResource();\n            });\n        }\n\n        // Toggle active switches (event delegation).\n        const tableView = document.querySelector(this.selectors.tableView);\n        if (tableView) {\n            tableView.addEventListener('change', async(e) => {\n                const toggle = e.target.closest('[data-action=\"toggle-active\"]');\n                if (toggle) {\n                    await this._handleToggleActive(toggle);\n                }\n            });\n        }\n    }\n\n    /**\n     * Handle add category action.\n     */\n    async _handleAddCategory() {\n        const modalForm = new ModalForm({\n            formClass: 'mod_bookit\\\\form\\\\edit_resource_category_form',\n            args: {\n                contextid: this.selectors.contextId,\n            },\n            modalConfig: {\n                title: await getString('resources:add_category', 'mod_bookit'),\n            },\n        });\n\n        modalForm.addEventListener(modalForm.events.FORM_SUBMITTED, (response) => {\n            this.reactive.stateManager.processUpdates(response.detail);\n        });\n\n        modalForm.show();\n    }\n\n    /**\n     * Handle add resource button click.\n     */\n    async _handleAddResource() {\n        const modalForm = new ModalForm({\n            formClass: 'mod_bookit\\\\form\\\\edit_resource_form',\n            args: {\n                contextid: this.selectors.contextId,\n            },\n            modalConfig: {\n                title: await getString('resources:add_resource', 'mod_bookit'),\n            },\n        });\n\n        modalForm.addEventListener(modalForm.events.FORM_SUBMITTED, (response) => {\n            this.reactive.stateManager.processUpdates(response.detail);\n        });\n\n        modalForm.show();\n    }\n\n    /**\n     * Handle toggle active switch.\n     *\n     * @param {HTMLElement} checkbox - Toggle checkbox element\n     */\n    async _handleToggleActive(checkbox) {\n        const itemId = parseInt(checkbox.dataset.itemId);\n        const state = this.reactive.state;\n        const item = state.items.get(itemId);\n\n        if (!item) {\n            return;\n        }\n\n        // Get the new active state from the checkbox.\n        const newActiveState = checkbox.checked;\n\n        // Build form data object (excluding roomids array).\n        const formData = {\n            id: itemId,\n            name: item.name,\n            description: item.description || '',\n            categoryid: item.categoryid,\n            amount: item.amount,\n            amountirrelevant: item.amountirrelevant ? 1 : 0,\n            sortorder: item.sortorder,\n            active: newActiveState ? 1 : 0,\n            action: 'put',\n            [`_qf__mod_bookit_form_edit_resource_form`]: 1\n        };\n\n        // Convert to URL-encoded string.\n        const params = new URLSearchParams(formData);\n\n        // Add roomids as repeated parameters (roomids[]=1&roomids[]=2).\n        const roomids = item.roomids || [];\n        roomids.forEach(roomid => {\n            params.append('roomids[]', roomid);\n        });\n\n        const formDataString = params.toString();\n\n        // Submit via Ajax.\n        try {\n            const response = await Ajax.call([{\n                methodname: 'core_form_dynamic_form',\n                args: {\n                    formdata: formDataString,\n                    form: 'mod_bookit\\\\form\\\\edit_resource_form'\n                }\n            }])[0];\n            this.reactive.stateManager.processUpdates(JSON.parse(response.data));\n        } catch (error) {\n            // Revert checkbox on error.\n            checkbox.checked = !newActiveState;\n            window.console.error('Toggle active error:', error);\n        }\n    }\n\n    /**\n     * Show no categories message.\n     */\n    _showNoCategoriesMessage() {\n        const msg = document.querySelector(this.selectors.noCategoriesMsg);\n        if (msg) {\n            msg.classList.remove('d-none');\n        }\n    }\n\n    /**\n     * Hide no categories message.\n     */\n    _hideNoCategoriesMessage() {\n        const msg = document.querySelector(this.selectors.noCategoriesMsg);\n        if (msg) {\n            msg.classList.add('d-none');\n        }\n    }\n\n    /**\n     * Initialize category components from existing DOM.\n     */\n    _initializeCategoryComponents() {\n        const categoryElements = this.element.querySelectorAll('[data-region=\"resource-category\"]');\n        const state = this.reactive.state;\n\n        categoryElements.forEach(categoryEl => {\n            const categoryId = parseInt(categoryEl.dataset.categoryid);\n            const category = state.categories.get(categoryId);\n            if (category) {\n                // Component attaches to existing DOM element (no rendering).\n                const component = new ResourceCategory({\n                    element: this.element.querySelector('#mod-bookit-resource-table'),\n                    reactive: this.reactive,\n                    categoryData: category,\n                });\n                // Set existing DOM element.\n                component.categoryElement = categoryEl;\n                component._attachEventListeners();\n                // Initialize item components from existing DOM.\n                component._initItemsFromDOM();\n\n                this.categoryComponents.set(categoryId, component);\n            }\n        });\n    }\n\n    /**\n     * Render a new category component.\n     *\n     * @param {Object} categoryData - Category data object\n     */\n    async _renderCategory(categoryData) {\n        const tableEl = this.element.querySelector('#mod-bookit-resource-table');\n        if (!tableEl) {\n            return;\n        }\n\n        const component = new ResourceCategory({\n            element: tableEl,\n            reactive: this.reactive,\n            categoryData: categoryData,\n        });\n\n        await component._render();\n\n        this.categoryComponents.set(categoryData.id, component);\n    }\n}\n"],"names":["BaseComponent","target","element","document","querySelector","contextId","parseInt","dataset","contextid","categoriesArray","itemsArray","querySelectorAll","forEach","categoryEl","categoryRow","categoryData","id","categoryid","name","categoryName","textContent","trim","description","categoryDescription","sortorder","categorySortorder","push","itemEl","roomids","itemRoomids","JSON","parse","Array","isArray","e","window","console","warn","itemData","itemid","itemName","itemDescription","itemCategoryid","amount","itemAmount","amountirrelevant","itemAmountirrelevant","active","itemActive","itemSortorder","categories","items","this","reactive","resourceReactiveInstance","selectors","componentName","create","addCategoryBtn","addResourceBtn","tableView","categoryComponents","Map","strings","then","str","catch","inactive","stateReady","_initializeCategoryComponents","_attachEventListeners","getWatchers","watch","handler","_handleCategoryCreated","_handleCategoryUpdated","_handleCategoryDeleted","_handleItemCreated","_handleActiveToggle","_replaceRenderedItem","_handleRoomidsUpdated","_handleRoomnamesUpdated","_renderCategory","component","get","update","remove","delete","checkbox","checked","label","row","classList","toggle","event","fieldPart","action","split","item","state","amountCell","innerHTML","nameSpan","_updateDescriptionField","descSpan","categoryComponent","from","values","find","cat","_renderItems","error","log","roomnames","_item$roomnames","length","roomsCell","container","room","badge","createElement","className","textclass","style","opacity","backgroundColor","eventcolor","bookitResourceTabledataRoomColor","bookitResourceTabledataRoomTextclass","bookitResourceTabledataRoomId","roomid","bookitResourceRoomname","roomname","bookitResourceTabledataIsRoomElement","appendChild","stringify","addBtn","addEventListener","preventDefault","_handleAddCategory","_handleAddResource","async","closest","_handleToggleActive","modalForm","ModalForm","formClass","args","modalConfig","title","events","FORM_SUBMITTED","response","stateManager","processUpdates","detail","show","itemId","newActiveState","formData","params","URLSearchParams","append","formDataString","toString","Ajax","call","methodname","formdata","form","data","_showNoCategoriesMessage","msg","noCategoriesMsg","_hideNoCategoriesMessage","add","categoryElements","categoryId","category","ResourceCategory","categoryElement","_initItemsFromDOM","set","tableEl","_render"],"mappings":"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"}