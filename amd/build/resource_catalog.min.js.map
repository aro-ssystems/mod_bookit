{"version":3,"file":"resource_catalog.min.js","sources":["../src/resource_catalog.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Resource catalog reactive component.\n *\n * @module mod_bookit/resource_catalog\n * @copyright   2026 ssystems GmbH <oss@ssystems.de>\n * @author      Andreas Rosenthal\n * @license     http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\nimport {BaseComponent} from 'core/reactive';\nimport {resourceReactiveInstance, initResourceReactive} from './resource_reactive';\nimport ResourceCategory from './resource_category';\nimport Templates from 'core/templates';\nimport ModalForm from 'core_form/modalform';\nimport {get_string as getString} from 'core/str';\nimport Notification from 'core/notification';\n\n/**\n * Resource catalog component.\n */\nexport default class extends BaseComponent {\n    /**\n     * Static init method.\n     *\n     * @param {string} target - CSS selector for container element\n     * @return {ResourceCatalog} Component instance\n     */\n    static init(target) {\n        // Get container element.\n        const element = document.querySelector(target);\n        if (!element) {\n            return null;\n        }\n\n        // Read contextId from DOM.\n        const contextId = parseInt(element.dataset.contextid);\n\n        // Read categories and resources from DOM.\n        const categoriesArray = [];\n        const itemsArray = [];\n\n        const categoryElements = element.querySelectorAll('[data-region=\"resource-category\"]');\n        categoryElements.forEach(categoryEl => {\n            const categoryData = {\n                id: parseInt(categoryEl.dataset.categoryid),\n                name: categoryEl.dataset.categoryName,\n                description: categoryEl.dataset.categoryDescription || '',\n                sortorder: parseInt(categoryEl.dataset.categorySortorder) || 0,\n            };\n            categoriesArray.push(categoryData);\n\n            // Read resources for this category.\n            const itemElements = categoryEl.querySelectorAll('[data-region=\"resource-item\"]');\n            itemElements.forEach(itemEl => {\n                const itemData = {\n                    id: parseInt(itemEl.dataset.itemid),\n                    name: itemEl.dataset.itemName,\n                    description: itemEl.dataset.itemDescription || '',\n                    categoryid: parseInt(itemEl.dataset.itemCategoryid),\n                    amount: parseInt(itemEl.dataset.itemAmount) || 0,\n                    amountirrelevant: itemEl.dataset.itemAmountirrelevant === 'true',\n                    sortorder: parseInt(itemEl.dataset.itemSortorder) || 0,\n                };\n                itemsArray.push(itemData);\n            });\n        });\n\n        // Initialize reactive store.\n        initResourceReactive({\n            categories: categoriesArray,\n            items: itemsArray,\n        });\n\n        return new this({\n            element: element,\n            reactive: resourceReactiveInstance,\n            selectors: {contextId},\n        });\n    }\n\n    /**\n     * Component descriptor for debugging.\n     *\n     * @return {string} Component name\n     */\n    static get componentName() {\n        return 'mod_bookit/resource_catalog';\n    }\n\n    /**\n     * Create component.\n     *\n     * Called by BaseComponent constructor.\n     */\n    create() {\n        this.selectors.categoriesContainer = '#mod-bookit-resource-categories';\n        this.selectors.noCategoriesMsg = '#mod-bookit-no-categories';\n        this.selectors.addCategoryBtn = '#add-category-btn';\n\n        // View mode selectors.\n        this.selectors.viewModeTable = '#view-mode-table';\n        this.selectors.viewModeCards = '#view-mode-cards';\n        this.selectors.tableView = '#mod-bookit-resource-table-view';\n        this.selectors.cardView = '#mod-bookit-resource-card-view';\n\n        this.categoryComponents = new Map();\n\n        // Default view mode (table).\n        this.currentView = 'table';\n    }\n\n    /**\n     * Initial state ready.\n     *\n     * Called when reactive state is ready.\n     *\n     * @param {Object} state - Reactive state\n     */\n    stateReady(state) {\n        this._initializeExistingComponents(state);\n        this._attachEventListeners();\n\n        // Restore saved view preference.\n        if (window.localStorage) {\n            const savedView = window.localStorage.getItem('bookit_resources_view_mode');\n            if (savedView && (savedView === 'table' || savedView === 'cards')) {\n                this._switchView(savedView);\n            }\n        }\n        // Default is already 'table' (set in template).\n    }\n\n    /**\n     * Initialize components for existing DOM elements.\n     *\n     * @param {Object} state - Reactive state\n     */\n    _initializeExistingComponents(state) {\n        const categories = Array.from(state.categories.values());\n\n        categories.forEach(categoryData => {\n            const categoryEl = document.getElementById(`resource-category-${categoryData.id}`);\n            if (categoryEl) {\n                const categoryComponent = new ResourceCategory({\n                    element: categoryEl.parentElement,\n                    reactive: this.reactive,\n                    categoryData: categoryData,\n                    existingElement: categoryEl,\n                });\n                this.categoryComponents.set(categoryData.id, categoryComponent);\n            }\n        });\n    }\n\n    /**\n     * Get state watchers.\n     *\n     * @return {Array} Array of watcher definitions\n     */\n    getWatchers() {\n        return [\n            {watch: `categories:created`, handler: this._handleCategoryCreated},\n            {watch: `categories.name:updated`, handler: this._handleCategoryUpdated},\n            {watch: `categories.description:updated`, handler: this._handleCategoryUpdated},\n            {watch: `categories:deleted`, handler: this._handleCategoryDeleted},\n            {watch: `items:created`, handler: this._handleItemCreated},\n            {watch: `items.name:updated`, handler: this._replaceRenderedItem},\n            {watch: `items.description:updated`, handler: this._replaceRenderedItem},\n            {watch: `items.amount:updated`, handler: this._replaceRenderedItem},\n            {watch: `items.amountirrelevant:updated`, handler: this._replaceRenderedItem},\n            {watch: `items.active:updated`, handler: this._replaceRenderedItem},\n        ];\n    }\n\n    /**\n     * Handle category created.\n     */\n    _handleCategoryCreated() {\n        const state = this.reactive.state;\n        this._renderCategories(state);\n    }\n\n    /**\n     * Render all categories (for dynamic updates).\n     *\n     * @param {Object} state - Reactive state\n     */\n    _renderCategories(state) {\n        const container = document.querySelector(this.selectors.categoriesContainer);\n        if (!container) {\n            return;\n        }\n\n        const categories = Array.from(state.categories.values())\n            .sort((a, b) => a.sortorder - b.sortorder);\n\n        // Clear existing.\n        container.innerHTML = '';\n        this.categoryComponents.clear();\n\n        if (categories.length === 0) {\n            this._showNoCategoriesMessage();\n            return;\n        }\n\n        this._hideNoCategoriesMessage();\n\n        // Render each category.\n        categories.forEach(categoryData => {\n            const categoryComponent = new ResourceCategory({\n                element: container,\n                reactive: this.reactive,\n                categoryData: categoryData,\n            });\n            this.categoryComponents.set(categoryData.id, categoryComponent);\n        });\n    }\n\n    /**\n     * Handle category updated.\n     *\n     * @param {Object} args - Event args\n     * @param {Object} args.element - Updated category data\n     */\n    _handleCategoryUpdated({element}) {\n        if (this.currentView === 'table') {\n            // Table view: Re-render the table row\n            const targetElement = document.getElementById(`resource-category-row-${element.id}`);\n            if (targetElement) {\n                Templates.renderForPromise('mod_bookit/resource_category_row', {\n                    id: element.id,\n                    name: element.name,\n                    description: element.description || '',\n                    sortorder: element.sortorder,\n                    active: element.active,\n                })\n                .then(({html, js}) => {\n                    return Templates.replaceNode(targetElement, html, js);\n                })\n                .catch(error => {\n                    window.console.error('Error rendering resource category row:', error);\n                });\n            }\n        } else {\n            // Card view: Update component\n            const component = this.categoryComponents.get(element.id);\n            if (component) {\n                component.update(element);\n            }\n        }\n    }\n\n    /**\n     * Handle category deleted.\n     *\n     * @param {Object} args - Event args\n     * @param {Object} args.element - Deleted category data\n     */\n    _handleCategoryDeleted({element}) {\n        const component = this.categoryComponents.get(element.id);\n        if (component) {\n            component.remove();\n            this.categoryComponents.delete(element.id);\n        }\n\n        const state = this.reactive.state;\n        if (state.categories.size === 0) {\n            this._showNoCategoriesMessage();\n        }\n    }\n\n    /**\n     * Handle item created.\n     */\n    _handleItemCreated() {\n        // Re-render categories to show the new item\n        const state = this.reactive.state;\n        this._renderCategories(state);\n    }\n\n    /**\n     * Replace rendered item field (follows checklist pattern).\n     *\n     * @param {Object} event - Event object\n     */\n    _replaceRenderedItem(event) {\n        const actionParts = event.action.split('.');\n        const fieldPart = actionParts[1].split(':')[0];\n\n        if (fieldPart === 'amount' || fieldPart === 'amountirrelevant') {\n            // Amount field requires template re-render due to conditional logic\n            const targetElement = document.querySelector(`td[data-bookit-resource-tabledata-amount-id=\"${event.element.id}\"]`);\n            if (targetElement) {\n                const state = this.reactive.state;\n                const item = state.items.get(event.element.id);\n                if (item.amountirrelevant) {\n                    targetElement.innerHTML = '<span class=\"badge badge-secondary\">Unlimited</span>';\n                } else {\n                    targetElement.innerHTML = `<span class=\"badge badge-info\">${item.amount}x</span>`;\n                }\n            }\n        } else if (fieldPart === 'active') {\n            // Active field requires conditional badge rendering\n            const targetElement = document.querySelector(`td[data-bookit-resource-tabledata-active-id=\"${event.element.id}\"]`);\n            if (targetElement) {\n                const state = this.reactive.state;\n                const item = state.items.get(event.element.id);\n                if (item.active) {\n                    targetElement.innerHTML = '<span class=\"badge badge-success\">Active</span>';\n                } else {\n                    targetElement.innerHTML = '<span class=\"badge badge-secondary\">Inactive</span>';\n                }\n            }\n        } else {\n            // Simple fields: directly update innerHTML\n            const elementSelector = `span[data-bookit-resource-tabledata-${fieldPart}-id=\"${event.element.id}\"]`;\n            const targetElement = document.querySelector(elementSelector);\n            if (targetElement) {\n                targetElement.innerHTML = event.element[fieldPart];\n            }\n        }\n    }\n\n    /**\n     * Attach event listeners.\n     */\n    _attachEventListeners() {\n        const addBtn = document.querySelector(this.selectors.addCategoryBtn);\n        if (addBtn) {\n            addBtn.addEventListener('click', (e) => {\n                e.preventDefault();\n                this._handleAddCategory();\n            });\n        }\n\n        // View mode toggle buttons.\n        const tableModeBtn = document.querySelector(this.selectors.viewModeTable);\n        const cardsModeBtn = document.querySelector(this.selectors.viewModeCards);\n\n        if (tableModeBtn) {\n            tableModeBtn.addEventListener('click', () => {\n                this._switchView('table');\n            });\n        }\n\n        if (cardsModeBtn) {\n            cardsModeBtn.addEventListener('click', () => {\n                this._switchView('cards');\n            });\n        }\n\n        // Table view button event delegation.\n        this._attachTableViewEventListeners();\n    }\n\n    /**\n     * Attach event listeners for table view buttons (event delegation).\n     */\n    _attachTableViewEventListeners() {\n        const tableView = document.querySelector(this.selectors.tableView);\n        if (!tableView) {\n            return;\n        }\n\n        // Event delegation for all buttons in table view.\n        tableView.addEventListener('click', async(e) => {\n            const target = e.target.closest('button[data-action]');\n            if (!target) {\n                return;\n            }\n\n            const action = target.dataset.action;\n            e.preventDefault();\n\n            switch (action) {\n                case 'edit-category':\n                    await this._handleEditCategoryFromTable(target);\n                    break;\n                case 'edit-item':\n                    await this._handleEditItemFromTable(target);\n                    break;\n            }\n        });\n    }\n\n    /**\n     * Handle edit category from table view.\n     *\n     * @param {HTMLElement} button - Button element\n     */\n    async _handleEditCategoryFromTable(button) {\n        const categoryId = parseInt(button.dataset.categoryId);\n        const state = this.reactive.state;\n        const category = state.categories.get(categoryId);\n\n        if (!category) {\n            return;\n        }\n\n        const modalForm = new ModalForm({\n            formClass: 'mod_bookit\\\\form\\\\edit_resource_category_form',\n            moduleName: 'mod_bookit/modal_delete_save_cancel',\n            args: {\n                id: categoryId,\n            },\n            modalConfig: {\n                title: await getString('resources:edit_category', 'mod_bookit'),\n            },\n        });\n\n        modalForm.addEventListener(modalForm.events.FORM_SUBMITTED, (response) => {\n            this.reactive.stateManager.processUpdates(response.detail);\n        });\n\n        modalForm.addEventListener(modalForm.events.LOADED, () => {\n            const deleteButton = modalForm.modal.getRoot().find('button[data-action=\"delete\"]');\n\n            deleteButton.on('click', async(e) => {\n                e.preventDefault();\n\n                const confirmTitle = await getString('confirm', 'core');\n                const confirmMessage = await getString('areyousure', 'core');\n                const deleteText = await getString('delete', 'core');\n\n                Notification.deleteCancel(\n                    confirmTitle,\n                    confirmMessage,\n                    deleteText,\n                    () => {\n                        modalForm.getFormNode().querySelector('input[name=\"action\"]').value = 'delete';\n                        modalForm.submitFormAjax();\n                    }\n                );\n            });\n        });\n\n        modalForm.show();\n    }\n\n    /**\n     * Handle edit item from table view.\n     *\n     * @param {HTMLElement} button - Button element\n     */\n    async _handleEditItemFromTable(button) {\n        const itemId = parseInt(button.dataset.itemId);\n        const state = this.reactive.state;\n        const item = state.items.get(itemId);\n\n        if (!item) {\n            return;\n        }\n\n        const modalForm = new ModalForm({\n            formClass: 'mod_bookit\\\\form\\\\edit_resource_form',\n            moduleName: 'mod_bookit/modal_delete_save_cancel',\n            args: {\n                id: itemId,\n            },\n            modalConfig: {\n                title: await getString('resources:edit_resource', 'mod_bookit'),\n            },\n        });\n\n        modalForm.addEventListener(modalForm.events.FORM_SUBMITTED, (response) => {\n            this.reactive.stateManager.processUpdates(response.detail);\n        });\n\n        modalForm.addEventListener(modalForm.events.LOADED, () => {\n            const deleteButton = modalForm.modal.getRoot().find('button[data-action=\"delete\"]');\n\n            deleteButton.on('click', async(e) => {\n                e.preventDefault();\n\n                const confirmTitle = await getString('confirm', 'core');\n                const confirmMessage = await getString('areyousure', 'core');\n                const deleteText = await getString('delete', 'core');\n\n                Notification.deleteCancel(\n                    confirmTitle,\n                    confirmMessage,\n                    deleteText,\n                    () => {\n                        modalForm.getFormNode().querySelector('input[name=\"action\"]').value = 'delete';\n                        modalForm.submitFormAjax();\n                    }\n                );\n            });\n        });\n\n        modalForm.show();\n    }\n\n    /**\n     * Handle add category action.\n     */\n    async _handleAddCategory() {\n        const modalForm = new ModalForm({\n            formClass: 'mod_bookit\\\\form\\\\edit_resource_category_form',\n            args: {\n                contextid: this.selectors.contextId,\n            },\n            modalConfig: {\n                title: await getString('resources:add_category', 'mod_bookit'),\n            },\n        });\n\n        modalForm.addEventListener(modalForm.events.FORM_SUBMITTED, (e) => {\n            this.reactive.dispatch('createCategory', e.detail);\n        });\n\n        modalForm.show();\n    }\n\n    /**\n     * Show no categories message.\n     */\n    _showNoCategoriesMessage() {\n        const msg = document.querySelector(this.selectors.noCategoriesMsg);\n        if (msg) {\n            msg.classList.remove('d-none');\n        }\n    }\n\n    /**\n     * Hide no categories message.\n     */\n    _hideNoCategoriesMessage() {\n        const msg = document.querySelector(this.selectors.noCategoriesMsg);\n        if (msg) {\n            msg.classList.add('d-none');\n        }\n    }\n\n    /**\n     * Switch between table and card view.\n     *\n     * @param {string} mode - View mode ('table' or 'cards')\n     */\n    _switchView(mode) {\n        if (this.currentView === mode) {\n            return; // Already in this view.\n        }\n\n        const tableView = document.querySelector(this.selectors.tableView);\n        const cardView = document.querySelector(this.selectors.cardView);\n        const tableModeBtn = document.querySelector(this.selectors.viewModeTable);\n        const cardsModeBtn = document.querySelector(this.selectors.viewModeCards);\n\n        if (!tableView || !cardView || !tableModeBtn || !cardsModeBtn) {\n            return;\n        }\n\n        if (mode === 'table') {\n            // Show table, hide cards.\n            tableView.classList.remove('d-none');\n            cardView.classList.add('d-none');\n\n            // Update button states.\n            tableModeBtn.classList.add('active');\n            cardsModeBtn.classList.remove('active');\n\n            this.currentView = 'table';\n        } else if (mode === 'cards') {\n            // Show cards, hide table.\n            cardView.classList.remove('d-none');\n            tableView.classList.add('d-none');\n\n            // Update button states.\n            cardsModeBtn.classList.add('active');\n            tableModeBtn.classList.remove('active');\n\n            this.currentView = 'cards';\n        }\n\n        // Store preference in local storage.\n        if (window.localStorage) {\n            window.localStorage.setItem('bookit_resources_view_mode', mode);\n        }\n    }\n}\n"],"names":["BaseComponent","target","element","document","querySelector","contextId","parseInt","dataset","contextid","categoriesArray","itemsArray","querySelectorAll","forEach","categoryEl","categoryData","id","categoryid","name","categoryName","description","categoryDescription","sortorder","categorySortorder","push","itemEl","itemData","itemid","itemName","itemDescription","itemCategoryid","amount","itemAmount","amountirrelevant","itemAmountirrelevant","itemSortorder","categories","items","this","reactive","resourceReactiveInstance","selectors","componentName","create","categoriesContainer","noCategoriesMsg","addCategoryBtn","viewModeTable","viewModeCards","tableView","cardView","categoryComponents","Map","currentView","stateReady","state","_initializeExistingComponents","_attachEventListeners","window","localStorage","savedView","getItem","_switchView","Array","from","values","getElementById","categoryComponent","ResourceCategory","parentElement","existingElement","set","getWatchers","watch","handler","_handleCategoryCreated","_handleCategoryUpdated","_handleCategoryDeleted","_handleItemCreated","_replaceRenderedItem","_renderCategories","container","sort","a","b","innerHTML","clear","length","_hideNoCategoriesMessage","_showNoCategoriesMessage","targetElement","renderForPromise","active","then","_ref2","html","js","Templates","replaceNode","catch","error","console","component","get","update","remove","delete","size","event","fieldPart","action","split","item","elementSelector","addBtn","addEventListener","e","preventDefault","_handleAddCategory","tableModeBtn","cardsModeBtn","_attachTableViewEventListeners","async","closest","_handleEditCategoryFromTable","_handleEditItemFromTable","button","categoryId","modalForm","ModalForm","formClass","moduleName","args","modalConfig","title","events","FORM_SUBMITTED","response","stateManager","processUpdates","detail","LOADED","modal","getRoot","find","on","confirmTitle","confirmMessage","deleteText","deleteCancel","getFormNode","value","submitFormAjax","show","itemId","dispatch","msg","classList","add","mode","setItem"],"mappings":"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"}