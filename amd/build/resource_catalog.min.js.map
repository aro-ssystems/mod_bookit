{"version":3,"file":"resource_catalog.min.js","sources":["../src/resource_catalog.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Resource catalog reactive component.\n *\n * @module mod_bookit/resource_catalog\n * @copyright   2026 ssystems GmbH <oss@ssystems.de>\n * @author      Andreas Rosenthal\n * @license     http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\nimport {BaseComponent} from 'core/reactive';\nimport {resourceReactiveInstance, initResourceReactive} from './resource_reactive';\nimport ModalForm from 'core_form/modalform';\nimport {get_string as getString} from 'core/str';\nimport Ajax from 'core/ajax';\nimport ResourceCategory from './resource_category';\n\n/**\n * Resource catalog component.\n */\nexport default class extends BaseComponent {\n    /**\n     * Static init method.\n     *\n     * @param {string} target - CSS selector for container element\n     * @return {ResourceCatalog} Component instance\n     */\n    static init(target) {\n        // Get container element.\n        const element = document.querySelector(target);\n        if (!element) {\n            return null;\n        }\n\n        // Read contextId from DOM.\n        const contextId = parseInt(element.dataset.contextid);\n\n        // Read categories and resources from DOM.\n        const categoriesArray = [];\n        const itemsArray = [];\n\n        const categoryElements = element.querySelectorAll('[data-region=\"resource-category\"]');\n        categoryElements.forEach(categoryEl => {\n            const categoryRow = categoryEl.querySelector('[data-region=\"resource-category-row\"]');\n            const categoryData = {\n                id: parseInt(categoryEl.dataset.categoryid),\n                name: categoryEl.dataset.categoryName || categoryRow?.textContent.trim(),\n                description: categoryEl.dataset.categoryDescription || '',\n                sortorder: parseInt(categoryEl.dataset.categorySortorder) || 0,\n            };\n            categoriesArray.push(categoryData);\n\n            // Read resources for this category.\n            const itemElements = categoryEl.querySelectorAll('[data-region=\"resource-item-row\"]');\n            itemElements.forEach(itemEl => {\n                // Parse roomids from JSON string.\n                let roomids = [];\n                if (itemEl.dataset.itemRoomids) {\n                    try {\n                        roomids = JSON.parse(itemEl.dataset.itemRoomids);\n                        if (!Array.isArray(roomids)) {\n                            roomids = [];\n                        }\n                    } catch (e) {\n                        window.console.warn('Failed to parse roomids:', e);\n                        roomids = [];\n                    }\n                }\n\n                const itemData = {\n                    id: parseInt(itemEl.dataset.itemid),\n                    name: itemEl.dataset.itemName || '',\n                    description: itemEl.dataset.itemDescription || '',\n                    categoryid: parseInt(itemEl.dataset.itemCategoryid),\n                    amount: parseInt(itemEl.dataset.itemAmount) || 0,\n                    amountirrelevant: itemEl.dataset.itemAmountirrelevant === '1',\n                    active: itemEl.dataset.itemActive === '1',\n                    sortorder: parseInt(itemEl.dataset.itemSortorder) || 0,\n                    roomids: roomids,\n                };\n                itemsArray.push(itemData);\n            });\n        });\n\n        // Initialize reactive store.\n        initResourceReactive({\n            categories: categoriesArray,\n            items: itemsArray,\n        });\n\n        return new this({\n            element: element,\n            reactive: resourceReactiveInstance,\n            selectors: {contextId},\n        });\n    }\n\n    /**\n     * Component descriptor for debugging.\n     *\n     * @return {string} Component name\n     */\n    static get componentName() {\n        return 'mod_bookit/resource_catalog';\n    }\n\n    /**\n     * Create component.\n     *\n     * Called by BaseComponent constructor.\n     */\n    create() {\n        this.selectors.addCategoryBtn = '#add-category-btn';\n        this.selectors.addResourceBtn = '#add-resource-btn';\n        this.selectors.tableView = '#mod-bookit-resource-table-view';\n        this.selectors.roomFilter = '#id_roomfilter_filter_section';\n        this.categoryComponents = new Map();\n        this.selectedRooms = new Set();\n\n        // Cache localized strings for active/inactive.\n        this.strings = {};\n        getString('active', 'core').then(str => {\n            this.strings.active = str;\n            return str;\n        }).catch(() => {\n            this.strings.active = 'Active';\n        });\n        getString('inactive', 'core').then(str => {\n            this.strings.inactive = str;\n            return str;\n        }).catch(() => {\n            this.strings.inactive = 'Inactive';\n        });\n    }\n\n    /**\n     * Initial state ready.\n     *\n     * Called when reactive state is ready.\n     */\n    stateReady() {\n        this._initializeCategoryComponents();\n        this._attachEventListeners();\n        this._initializeRoomFilter();\n    }\n\n    /**\n     * Get state watchers.\n     *\n     * @return {Array} Array of watcher definitions\n     */\n    getWatchers() {\n        return [\n            {watch: `categories:created`, handler: this._handleCategoryCreated},\n            {watch: `categories.name:updated`, handler: this._handleCategoryUpdated},\n            {watch: `categories.description:updated`, handler: this._handleCategoryUpdated},\n            {watch: `categories:deleted`, handler: this._handleCategoryDeleted},\n            {watch: `items:created`, handler: this._handleItemCreated},\n            {watch: `items.active:updated`, handler: this._handleActiveToggle},\n            {watch: `items.name:updated`, handler: this._replaceRenderedItem},\n            {watch: `items.description:updated`, handler: this._replaceRenderedItem},\n            {watch: `items.amount:updated`, handler: this._replaceRenderedItem},\n            {watch: `items.amountirrelevant:updated`, handler: this._replaceRenderedItem},\n            {watch: `items.roomids:updated`, handler: this._handleRoomidsUpdated},\n            {watch: `items.roomnames:updated`, handler: this._handleRoomnamesUpdated},\n        ];\n    }\n\n    /**\n     * Handle category created.\n     *\n     * @param {Object} args - Event args\n     * @param {Object} args.element - New category data\n     */\n    async _handleCategoryCreated({element}) {\n        await this._renderCategory(element);\n    }\n\n    /**\n     * Handle category updated.\n     *\n     * @param {Object} args - Event args\n     * @param {Object} args.element - Updated category data\n     */\n    _handleCategoryUpdated({element}) {\n        const component = this.categoryComponents.get(element.id);\n        if (component) {\n            component.update(element);\n        }\n    }\n\n    /**\n     * Handle category deleted.\n     *\n     * @param {Object} args - Event args\n     * @param {Object} args.element - Deleted category data\n     */\n    _handleCategoryDeleted({element}) {\n        const component = this.categoryComponents.get(element.id);\n        if (component) {\n            component.remove();\n            this.categoryComponents.delete(element.id);\n        }\n    }\n\n    /**\n     * Handle item created.\n     *\n     * Item creation is handled by the category component.\n     */\n    _handleItemCreated() {\n        // Category component handles this via its watchers.\n    }\n\n    /**\n     * Handle active state toggle.\n     *\n     * @param {Object} args - Event args\n     * @param {Object} args.element - Updated item data\n     */\n    _handleActiveToggle({element}) {\n        const checkbox = document.querySelector(`#resource-active-${element.id}`);\n        if (!checkbox) {\n            window.console.warn(`Toggle checkbox not found for item ${element.id}`);\n            return;\n        }\n        checkbox.checked = element.active;\n\n        const label = document.querySelector(`label[for=\"resource-active-${element.id}\"]`);\n        if (label) {\n            label.textContent = element.active ?\n                (this.strings.active || 'Active') :\n                (this.strings.inactive || 'Inactive');\n        }\n\n        const row = document.querySelector(`#resource-item-row-${element.id}`);\n        if (row) {\n            row.classList.toggle('opacity-50', !element.active);\n        }\n    }\n\n    /**\n     * Replace rendered item field (follows masterchecklist pattern).\n     *\n     * @param {Object} event - Event object\n     */\n    async _replaceRenderedItem(event) {\n        const actionParts = event.action.split('.');\n        const fieldPart = actionParts[1].split(':')[0];\n        const item = this.reactive.state.items.get(event.element.id);\n\n        if (fieldPart === 'amount' || fieldPart === 'amountirrelevant') {\n            const amountCell = document.querySelector(`td[data-bookit-resource-tabledata-amount-id=\"${item.id}\"]`);\n            if (!amountCell) {\n                return;\n            }\n            if (item.amountirrelevant) {\n                amountCell.innerHTML = '<span class=\"badge badge-secondary\">Unlimited</span>';\n            } else {\n                amountCell.innerHTML = `<span class=\"badge badge-info\">${item.amount}x</span>`;\n            }\n        } else if (fieldPart === 'name') {\n            const nameSpan = document.querySelector(`span[data-bookit-resource-tabledata-name-id=\"${item.id}\"]`);\n            if (!nameSpan) {\n                return;\n            }\n            nameSpan.textContent = item.name;\n        } else if (fieldPart === 'description') {\n            await this._updateDescriptionField(item);\n        }\n    }\n\n    /**\n     * Update description field in the DOM.\n     *\n     * @param {Object} item - Item data\n     */\n    async _updateDescriptionField(item) {\n        const descSpan = document.querySelector(`small[data-bookit-resource-tabledata-description-id=\"${item.id}\"]`);\n        if (descSpan) {\n            descSpan.innerHTML = item.description || '';\n            return;\n        }\n\n        // Description was added but <small> element doesn't exist - need to re-render row.\n        if (!item.description) {\n            return;\n        }\n\n        const row = document.querySelector(`#resource-item-row-${item.id}`);\n        if (!row) {\n            return;\n        }\n\n        // Find category component and trigger re-render.\n        const categoryComponent = Array.from(this.categoryComponents.values())\n            .find(cat => cat.categoryData.id === item.categoryid);\n        if (!categoryComponent) {\n            return;\n        }\n\n        try {\n            await categoryComponent._renderItems();\n        } catch (error) {\n            window.console.error('Failed to re-render items:', error);\n        }\n    }\n\n    /**\n     * Handle roomnames updated.\n     *\n     * @param {Object} event - Event object\n     */\n    _handleRoomnamesUpdated(event) {\n        const item = this.reactive.state.items.get(event.element.id);\n        if (!item) {\n            return;\n        }\n\n        const roomsCell = document.querySelector(`td[data-bookit-resource-tabledata-roomids-id=\"${item.id}\"]`);\n        if (!roomsCell) {\n            return;\n        }\n\n        // Clear existing content.\n        roomsCell.innerHTML = '<div class=\"d-flex flex-wrap align-items-center\"></div>';\n        const container = roomsCell.querySelector('div');\n\n        if (!item.roomnames || item.roomnames.length === 0) {\n            // Show \"All rooms\" badge.\n            container.innerHTML = '<span class=\"badge badge-secondary\">All rooms</span>';\n        } else {\n            // Render room badges with colors.\n            item.roomnames.forEach(room => {\n                const badge = document.createElement('span');\n                badge.className = `badge ${room.textclass} mr-1 mb-1`;\n                badge.style.opacity = '0.8';\n                badge.style.backgroundColor = room.eventcolor;\n                badge.dataset.bookitResourceTabledataRoomColor = room.eventcolor;\n                badge.dataset.bookitResourceTabledataRoomTextclass = room.textclass;\n                badge.dataset.bookitResourceTabledataRoomId = room.roomid;\n                badge.dataset.bookitResourceRoomname = room.roomname;\n                badge.dataset.bookitResourceTabledataIsRoomElement = '';\n                badge.textContent = room.roomname;\n                container.appendChild(badge);\n            });\n        }\n    }\n\n    /**\n     * Handle roomids updated.\n     *\n     * @param {Object} event - Event object\n     */\n    _handleRoomidsUpdated(event) {\n        const item = this.reactive.state.items.get(event.element.id);\n        if (!item) {\n            return;\n        }\n\n        const row = document.querySelector(`tr[data-bookit-item-id=\"${item.id}\"]`);\n        if (!row) {\n            return;\n        }\n\n        // Update data-item-roomids attribute with JSON string.\n        row.dataset.itemRoomids = JSON.stringify(item.roomids || []);\n    }\n\n    /**\n     * Attach event listeners.\n     */\n    _attachEventListeners() {\n        const addBtn = document.querySelector(this.selectors.addCategoryBtn);\n        if (addBtn) {\n            addBtn.addEventListener('click', (e) => {\n                e.preventDefault();\n                this._handleAddCategory();\n            });\n        }\n\n        const addResourceBtn = document.querySelector(this.selectors.addResourceBtn);\n        if (addResourceBtn) {\n            addResourceBtn.addEventListener('click', (e) => {\n                e.preventDefault();\n                this._handleAddResource();\n            });\n        }\n\n        // Toggle active switches (event delegation).\n        const tableView = document.querySelector(this.selectors.tableView);\n        if (tableView) {\n            tableView.addEventListener('change', async(e) => {\n                const toggle = e.target.closest('[data-action=\"toggle-active\"]');\n                if (toggle) {\n                    await this._handleToggleActive(toggle);\n                }\n            });\n        }\n    }\n\n    /**\n     * Handle add category action.\n     */\n    async _handleAddCategory() {\n        const modalForm = new ModalForm({\n            formClass: 'mod_bookit\\\\form\\\\edit_resource_category_form',\n            args: {\n                contextid: this.selectors.contextId,\n            },\n            modalConfig: {\n                title: await getString('resources:add_category', 'mod_bookit'),\n            },\n        });\n\n        modalForm.addEventListener(modalForm.events.FORM_SUBMITTED, (response) => {\n            this.reactive.stateManager.processUpdates(response.detail);\n        });\n\n        modalForm.show();\n    }\n\n    /**\n     * Handle add resource button click.\n     */\n    async _handleAddResource() {\n        const modalForm = new ModalForm({\n            formClass: 'mod_bookit\\\\form\\\\edit_resource_form',\n            args: {\n                contextid: this.selectors.contextId,\n            },\n            modalConfig: {\n                title: await getString('resources:add_resource', 'mod_bookit'),\n            },\n        });\n\n        modalForm.addEventListener(modalForm.events.FORM_SUBMITTED, (response) => {\n            this.reactive.stateManager.processUpdates(response.detail);\n        });\n\n        modalForm.show();\n    }\n\n    /**\n     * Handle toggle active switch.\n     *\n     * @param {HTMLElement} checkbox - Toggle checkbox element\n     */\n    async _handleToggleActive(checkbox) {\n        const itemId = parseInt(checkbox.dataset.itemId);\n        const state = this.reactive.state;\n        const item = state.items.get(itemId);\n\n        if (!item) {\n            return;\n        }\n\n        // Get the new active state from the checkbox.\n        const newActiveState = checkbox.checked;\n\n        // Build form data object (excluding roomids array).\n        const formData = {\n            id: itemId,\n            name: item.name,\n            description: item.description || '',\n            categoryid: item.categoryid,\n            amount: item.amount,\n            amountirrelevant: item.amountirrelevant ? 1 : 0,\n            sortorder: item.sortorder,\n            active: newActiveState ? 1 : 0,\n            action: 'put',\n            [`_qf__mod_bookit_form_edit_resource_form`]: 1\n        };\n\n        // Convert to URL-encoded string.\n        const params = new URLSearchParams(formData);\n\n        // Add roomids as repeated parameters (roomids[]=1&roomids[]=2).\n        const roomids = item.roomids || [];\n        roomids.forEach(roomid => {\n            params.append('roomids[]', roomid);\n        });\n\n        const formDataString = params.toString();\n\n        // Submit via Ajax.\n        try {\n            const response = await Ajax.call([{\n                methodname: 'core_form_dynamic_form',\n                args: {\n                    formdata: formDataString,\n                    form: 'mod_bookit\\\\form\\\\edit_resource_form'\n                }\n            }])[0];\n            this.reactive.stateManager.processUpdates(JSON.parse(response.data));\n        } catch (error) {\n            // Revert checkbox on error.\n            checkbox.checked = !newActiveState;\n            window.console.error('Toggle active error:', error);\n        }\n    }\n\n    /**\n     * Show no categories message.\n     */\n    _showNoCategoriesMessage() {\n        const msg = document.querySelector(this.selectors.noCategoriesMsg);\n        if (msg) {\n            msg.classList.remove('d-none');\n        }\n    }\n\n    /**\n     * Hide no categories message.\n     */\n    _hideNoCategoriesMessage() {\n        const msg = document.querySelector(this.selectors.noCategoriesMsg);\n        if (msg) {\n            msg.classList.add('d-none');\n        }\n    }\n\n    /**\n     * Initialize category components from existing DOM.\n     */\n    _initializeCategoryComponents() {\n        const categoryElements = this.element.querySelectorAll('[data-region=\"resource-category\"]');\n        const state = this.reactive.state;\n\n        categoryElements.forEach(categoryEl => {\n            const categoryId = parseInt(categoryEl.dataset.categoryid);\n            const category = state.categories.get(categoryId);\n            if (category) {\n                // Component attaches to existing DOM element (no rendering).\n                const component = new ResourceCategory({\n                    element: this.element.querySelector('#mod-bookit-resource-table'),\n                    reactive: this.reactive,\n                    categoryData: category,\n                });\n                // Set existing DOM element.\n                component.categoryElement = categoryEl;\n                component._attachEventListeners();\n                // Initialize item components from existing DOM.\n                component._initItemsFromDOM();\n\n                this.categoryComponents.set(categoryId, component);\n            }\n        });\n    }\n\n    /**\n     * Render a new category component.\n     *\n     * @param {Object} categoryData - Category data object\n     */\n    async _renderCategory(categoryData) {\n        const tableEl = this.element.querySelector('#mod-bookit-resource-table');\n        if (!tableEl) {\n            return;\n        }\n\n        const component = new ResourceCategory({\n            element: tableEl,\n            reactive: this.reactive,\n            categoryData: categoryData,\n        });\n\n        await component._render();\n\n        this.categoryComponents.set(categoryData.id, component);\n    }\n\n    /**\n     * Initialize room filter event handlers.\n     *\n     * Integrates the roomfilter form element with reactive component.\n     */\n    _initializeRoomFilter() {\n        const filterContainer = this.element.querySelector(this.selectors.roomFilter);\n        if (!filterContainer) {\n            return;\n        }\n\n        const selectedRow = filterContainer.querySelector('[data-row=\"selected\"]');\n        const unselectedRow = filterContainer.querySelector('[data-row=\"unselected\"]');\n\n        if (!selectedRow || !unselectedRow) {\n            return;\n        }\n\n        // Event delegation on both rows using addEventListener (BaseComponent integration).\n        this.addEventListener(selectedRow, 'click', (e) => {\n            if (!e.target.matches('button') && !e.target.closest('button')) {\n                return;\n            }\n            const button = e.target.closest('button');\n            this._toggleFilterButton(button, selectedRow, unselectedRow);\n            this._applyFilter();\n        });\n\n        this.addEventListener(unselectedRow, 'click', (e) => {\n            if (!e.target.matches('button') && !e.target.closest('button')) {\n                return;\n            }\n            const button = e.target.closest('button');\n            this._toggleFilterButton(button, selectedRow, unselectedRow);\n            this._applyFilter();\n        });\n    }\n\n    /**\n     * Toggle filter button state and move between rows.\n     *\n     * @param {HTMLElement} button - Button element to toggle\n     * @param {HTMLElement} selectedRow - Selected row container\n     * @param {HTMLElement} unselectedRow - Unselected row container\n     */\n    _toggleFilterButton(button, selectedRow, unselectedRow) {\n        const value = button.dataset.value;\n        const isPressed = button.getAttribute('aria-pressed') === 'true';\n        const icon = button.querySelector('.filter-icon');\n        const filterSection = button.closest('.filter-section');\n        const hiddenSelect = filterSection ? filterSection.querySelector('select[multiple]') : null;\n\n        if (isPressed) {\n            // Deselect: Move to unselected row, show plus, unselected color.\n            button.style.backgroundColor = button.dataset.colorUnselected;\n            button.setAttribute('aria-pressed', 'false');\n            if (icon) {\n                icon.textContent = '+';\n            }\n            this.selectedRooms.delete(value);\n            unselectedRow.appendChild(button);\n\n            // Update hidden select.\n            if (hiddenSelect) {\n                const option = hiddenSelect.querySelector(`option[value=\"${value}\"]`);\n                if (option) {\n                    option.selected = false;\n                }\n            }\n        } else {\n            // Select: Move to selected row, show checkmark, selected color.\n            button.style.backgroundColor = button.dataset.colorSelected;\n            button.setAttribute('aria-pressed', 'true');\n            if (icon) {\n                icon.textContent = 'âœ“';\n            }\n            this.selectedRooms.add(value);\n            selectedRow.appendChild(button);\n\n            // Update hidden select.\n            if (hiddenSelect) {\n                const option = hiddenSelect.querySelector(`option[value=\"${value}\"]`);\n                if (option) {\n                    option.selected = true;\n                }\n            }\n        }\n    }\n\n    /**\n     * Apply current filter to resource table.\n     */\n    _applyFilter() {\n        const allCategories = document.querySelectorAll('[data-region=\"resource-category\"]');\n        const hasActiveFilters = this.selectedRooms.size > 0;\n\n        // Reset: Show all categories and resources when no filters are active.\n        if (!hasActiveFilters) {\n            allCategories.forEach(category => {\n                category.style.display = '';\n                const resourceRows = category.querySelectorAll('[data-region=\"resource-row\"]');\n                resourceRows.forEach(row => {\n                    row.style.display = '';\n                });\n            });\n            return;\n        }\n\n        // Filters active: Apply strict matching.\n        allCategories.forEach(category => {\n            const resourceRows = category.querySelectorAll('[data-region=\"resource-row\"]');\n\n            let hasVisibleResources = false;\n\n            resourceRows.forEach(row => {\n                const resourceRooms = this._getResourceRooms(row);\n\n                if (this._hasMatchingRoom(resourceRooms)) {\n                    row.style.display = '';\n                    hasVisibleResources = true;\n                } else {\n                    row.style.display = 'none';\n                }\n            });\n\n            // Hide category if no resources match filter.\n            if (hasVisibleResources) {\n                category.style.display = '';\n            } else {\n                category.style.display = 'none';\n            }\n        });\n    }\n\n    /**\n     * Get room IDs for a resource row.\n     *\n     * @param {HTMLElement} row - Resource row element\n     * @return {Array} Array of room IDs\n     */\n    _getResourceRooms(row) {\n        const roomsData = row.dataset.rooms;\n        if (!roomsData) {\n            return [];\n        }\n\n        try {\n            return JSON.parse(roomsData);\n        } catch (e) {\n            return [];\n        }\n    }\n\n    /**\n     * Check if resource has any matching room.\n     *\n     * Resources with no rooms assigned cannot match any filter.\n     *\n     * @param {Array} resourceRooms - Array of room IDs\n     * @return {boolean} True if any room matches\n     */\n    _hasMatchingRoom(resourceRooms) {\n        // Resources with no rooms cannot match filters.\n        if (resourceRooms.length === 0) {\n            return false;\n        }\n\n        return resourceRooms.some(roomId =>\n            this.selectedRooms.has(String(roomId))\n        );\n    }\n}\n"],"names":["BaseComponent","target","element","document","querySelector","contextId","parseInt","dataset","contextid","categoriesArray","itemsArray","querySelectorAll","forEach","categoryEl","categoryRow","categoryData","id","categoryid","name","categoryName","textContent","trim","description","categoryDescription","sortorder","categorySortorder","push","itemEl","roomids","itemRoomids","JSON","parse","Array","isArray","e","window","console","warn","itemData","itemid","itemName","itemDescription","itemCategoryid","amount","itemAmount","amountirrelevant","itemAmountirrelevant","active","itemActive","itemSortorder","categories","items","this","reactive","resourceReactiveInstance","selectors","componentName","create","addCategoryBtn","addResourceBtn","tableView","roomFilter","categoryComponents","Map","selectedRooms","Set","strings","then","str","catch","inactive","stateReady","_initializeCategoryComponents","_attachEventListeners","_initializeRoomFilter","getWatchers","watch","handler","_handleCategoryCreated","_handleCategoryUpdated","_handleCategoryDeleted","_handleItemCreated","_handleActiveToggle","_replaceRenderedItem","_handleRoomidsUpdated","_handleRoomnamesUpdated","_renderCategory","component","get","update","remove","delete","checkbox","checked","label","row","classList","toggle","event","fieldPart","action","split","item","state","amountCell","innerHTML","nameSpan","_updateDescriptionField","descSpan","categoryComponent","from","values","find","cat","_renderItems","error","roomsCell","container","roomnames","length","room","badge","createElement","className","textclass","style","opacity","backgroundColor","eventcolor","bookitResourceTabledataRoomColor","bookitResourceTabledataRoomTextclass","bookitResourceTabledataRoomId","roomid","bookitResourceRoomname","roomname","bookitResourceTabledataIsRoomElement","appendChild","stringify","addBtn","addEventListener","preventDefault","_handleAddCategory","_handleAddResource","async","closest","_handleToggleActive","modalForm","ModalForm","formClass","args","modalConfig","title","events","FORM_SUBMITTED","response","stateManager","processUpdates","detail","show","itemId","newActiveState","formData","params","URLSearchParams","append","formDataString","toString","Ajax","call","methodname","formdata","form","data","_showNoCategoriesMessage","msg","noCategoriesMsg","_hideNoCategoriesMessage","add","categoryElements","categoryId","category","ResourceCategory","categoryElement","_initItemsFromDOM","set","tableEl","_render","filterContainer","selectedRow","unselectedRow","matches","button","_toggleFilterButton","_applyFilter","value","isPressed","getAttribute","icon","filterSection","hiddenSelect","colorUnselected","setAttribute","option","selected","colorSelected","allCategories","size","resourceRows","hasVisibleResources","resourceRooms","_getResourceRooms","_hasMatchingRoom","display","roomsData","rooms","some","roomId","has","String"],"mappings":"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"}