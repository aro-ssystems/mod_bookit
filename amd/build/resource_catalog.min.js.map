{"version":3,"file":"resource_catalog.min.js","sources":["../src/resource_catalog.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Resource catalog reactive component.\n *\n * @module mod_bookit/resource_catalog\n * @copyright   2026 ssystems GmbH <oss@ssystems.de>\n * @author      Andreas Rosenthal\n * @license     http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\nimport {BaseComponent} from 'core/reactive';\nimport {resourceReactiveInstance, initResourceReactive} from './resource_reactive';\nimport ModalForm from 'core_form/modalform';\nimport {get_string as getString} from 'core/str';\nimport Notification from 'core/notification';\nimport Ajax from 'core/ajax';\nimport ResourceCategory from './resource_category';\n\n/**\n * Resource catalog component.\n */\nexport default class extends BaseComponent {\n    /**\n     * Static init method.\n     *\n     * @param {string} target - CSS selector for container element\n     * @return {ResourceCatalog} Component instance\n     */\n    static init(target) {\n        // Get container element.\n        const element = document.querySelector(target);\n        if (!element) {\n            return null;\n        }\n\n        // Read contextId from DOM.\n        const contextId = parseInt(element.dataset.contextid);\n\n        // Read categories and resources from DOM.\n        const categoriesArray = [];\n        const itemsArray = [];\n\n        const categoryElements = element.querySelectorAll('[data-region=\"resource-category\"]');\n        categoryElements.forEach(categoryEl => {\n            const categoryRow = categoryEl.querySelector('[data-region=\"resource-category-row\"]');\n            const categoryData = {\n                id: parseInt(categoryEl.dataset.categoryid),\n                name: categoryEl.dataset.categoryName || categoryRow?.textContent.trim(),\n                description: categoryEl.dataset.categoryDescription || '',\n                sortorder: parseInt(categoryEl.dataset.categorySortorder) || 0,\n            };\n            categoriesArray.push(categoryData);\n\n            // Read resources for this category.\n            const itemElements = categoryEl.querySelectorAll('[data-region=\"resource-item-row\"]');\n            itemElements.forEach(itemEl => {\n                const itemData = {\n                    id: parseInt(itemEl.dataset.itemid),\n                    name: itemEl.dataset.itemName || '',\n                    description: itemEl.dataset.itemDescription || '',\n                    categoryid: parseInt(itemEl.dataset.itemCategoryid),\n                    amount: parseInt(itemEl.dataset.itemAmount) || 0,\n                    amountirrelevant: itemEl.dataset.itemAmountirrelevant === 'true',\n                    active: itemEl.dataset.itemActive === 'true',\n                    sortorder: parseInt(itemEl.dataset.itemSortorder) || 0,\n                };\n                itemsArray.push(itemData);\n            });\n        });\n\n        // Initialize reactive store.\n        initResourceReactive({\n            categories: categoriesArray,\n            items: itemsArray,\n        });\n\n        return new this({\n            element: element,\n            reactive: resourceReactiveInstance,\n            selectors: {contextId},\n        });\n    }\n\n    /**\n     * Component descriptor for debugging.\n     *\n     * @return {string} Component name\n     */\n    static get componentName() {\n        return 'mod_bookit/resource_catalog';\n    }\n\n    /**\n     * Create component.\n     *\n     * Called by BaseComponent constructor.\n     */\n    create() {\n        this.selectors.addCategoryBtn = '#add-category-btn';\n        this.selectors.addResourceBtn = '#add-resource-btn';\n        this.selectors.tableView = '#mod-bookit-resource-table-view';\n        this.categoryComponents = new Map();\n    }\n\n    /**\n     * Initial state ready.\n     *\n     * Called when reactive state is ready.\n     */\n    stateReady() {\n        this._initializeCategoryComponents();\n        this._attachEventListeners();\n    }\n\n    /**\n     * Get state watchers.\n     *\n     * @return {Array} Array of watcher definitions\n     */\n    getWatchers() {\n        return [\n            {watch: `categories:created`, handler: this._handleCategoryCreated},\n            {watch: `categories.name:updated`, handler: this._handleCategoryUpdated},\n            {watch: `categories.description:updated`, handler: this._handleCategoryUpdated},\n            {watch: `categories:deleted`, handler: this._handleCategoryDeleted},\n            {watch: `items:created`, handler: this._handleItemCreated},\n            {watch: `items.active:updated`, handler: this._handleActiveToggle},\n            {watch: `items.name:updated`, handler: this._replaceRenderedItem},\n            {watch: `items.description:updated`, handler: this._replaceRenderedItem},\n            {watch: `items.amount:updated`, handler: this._replaceRenderedItem},\n            {watch: `items.amountirrelevant:updated`, handler: this._replaceRenderedItem},\n        ];\n    }\n\n    /**\n     * Handle category created.\n     *\n     * @param {Object} args - Event args\n     * @param {Object} args.element - New category data\n     */\n    _handleCategoryCreated({element}) {\n        this._renderCategory(element);\n    }\n\n    /**\n     * Handle category updated.\n     *\n     * @param {Object} args - Event args\n     * @param {Object} args.element - Updated category data\n     */\n    _handleCategoryUpdated({element}) {\n        const component = this.categoryComponents.get(element.id);\n        if (component) {\n            component.update(element);\n        }\n    }\n\n    /**\n     * Handle category deleted.\n     *\n     * @param {Object} args - Event args\n     * @param {Object} args.element - Deleted category data\n     */\n    _handleCategoryDeleted({element}) {\n        const component = this.categoryComponents.get(element.id);\n        if (component) {\n            component.remove();\n            this.categoryComponents.delete(element.id);\n        }\n    }\n\n    /**\n     * Handle item created.\n     *\n     * Item creation is handled by the category component.\n     */\n    _handleItemCreated() {\n        // Category component handles this via its watchers.\n    }\n\n    /**\n     * Handle active state toggle.\n     *\n     * @param {Object} args - Event args\n     * @param {Object} args.element - Updated item data\n     */\n    _handleActiveToggle({element}) {\n        const checkbox = document.querySelector(`#resource-active-${element.id}`);\n        if (!checkbox) {\n            window.console.warn(`Toggle checkbox not found for item ${element.id}`);\n            return;\n        }\n        checkbox.checked = element.active;\n\n        const label = document.querySelector(`label[for=\"resource-active-${element.id}\"]`);\n        if (label) {\n            label.textContent = element.active ? 'Active' : 'Inactive';\n        }\n\n        const row = document.querySelector(`#resource-item-row-${element.id}`);\n        if (row) {\n            row.classList.toggle('opacity-50', !element.active);\n        }\n    }\n\n    /**\n     * Replace rendered item field (follows masterchecklist pattern).\n     *\n     * @param {Object} event - Event object\n     */\n    _replaceRenderedItem(event) {\n        const actionParts = event.action.split('.');\n        const fieldPart = actionParts[1].split(':')[0];\n        const item = this.reactive.state.items.get(event.element.id);\n\n        if (fieldPart === 'amount' || fieldPart === 'amountirrelevant') {\n            const amountCell = document.querySelector(`td[data-bookit-resource-tabledata-amount-id=\"${item.id}\"]`);\n            if (item.amountirrelevant) {\n                amountCell.innerHTML = '<span class=\"badge badge-secondary\">Unlimited</span>';\n            } else {\n                amountCell.innerHTML = `<span class=\"badge badge-info\">${item.amount}x</span>`;\n            }\n        } else if (fieldPart === 'name') {\n            const nameSpan = document.querySelector(`span[data-bookit-resource-tabledata-name-id=\"${item.id}\"]`);\n            nameSpan.textContent = item.name;\n        } else if (fieldPart === 'description') {\n            const descSpan = document.querySelector(`small[data-bookit-resource-tabledata-description-id=\"${item.id}\"]`);\n            descSpan.innerHTML = item.description || '';\n        }\n    }\n\n    /**\n     * Attach event listeners.\n     */\n    _attachEventListeners() {\n        const addBtn = document.querySelector(this.selectors.addCategoryBtn);\n        if (addBtn) {\n            addBtn.addEventListener('click', (e) => {\n                e.preventDefault();\n                this._handleAddCategory();\n            });\n        }\n\n        const addResourceBtn = document.querySelector(this.selectors.addResourceBtn);\n        if (addResourceBtn) {\n            addResourceBtn.addEventListener('click', (e) => {\n                e.preventDefault();\n                this._handleAddResource();\n            });\n        }\n\n        // Table view button event delegation.\n        this._attachTableViewEventListeners();\n    }\n\n    /**\n     * Attach event listeners for table view buttons (event delegation).\n     */\n    _attachTableViewEventListeners() {\n        const tableView = document.querySelector(this.selectors.tableView);\n        if (!tableView) {\n            return;\n        }\n\n        // Event delegation for all buttons in table view.\n        tableView.addEventListener('click', async(e) => {\n            const target = e.target.closest('button[data-action]');\n            if (!target) {\n                // Check for toggle switches.\n                const toggle = e.target.closest('[data-action=\"toggle-active\"]');\n                if (toggle) {\n                    e.preventDefault();\n                    await this._handleToggleActive(toggle);\n                }\n                return;\n            }\n\n            const action = target.dataset.action;\n            e.preventDefault();\n\n            switch (action) {\n                case 'edit-category':\n                    await this._handleEditCategoryFromTable(target);\n                    break;\n                case 'edit-item':\n                    await this._handleEditItemFromTable(target);\n                    break;\n            }\n        });\n    }\n\n    /**\n     * Handle edit category from table view.\n     *\n     * @param {HTMLElement} button - Button element\n     */\n    async _handleEditCategoryFromTable(button) {\n        const categoryId = parseInt(button.dataset.categoryId);\n        const state = this.reactive.state;\n        const category = state.categories.get(categoryId);\n\n        if (!category) {\n            return;\n        }\n\n        const modalForm = new ModalForm({\n            formClass: 'mod_bookit\\\\form\\\\edit_resource_category_form',\n            moduleName: 'mod_bookit/modal_delete_save_cancel',\n            args: {\n                id: categoryId,\n            },\n            modalConfig: {\n                title: await getString('resources:edit_category', 'mod_bookit'),\n            },\n        });\n\n        modalForm.addEventListener(modalForm.events.FORM_SUBMITTED, (response) => {\n            this.reactive.stateManager.processUpdates(response.detail);\n        });\n\n        modalForm.addEventListener(modalForm.events.LOADED, () => {\n            const deleteButton = modalForm.modal.getRoot().find('button[data-action=\"delete\"]');\n\n            deleteButton.on('click', async(e) => {\n                e.preventDefault();\n\n                // Check if category has resources.\n                const state = this.reactive.state;\n                const resourceCount = Array.from(state.items.values())\n                    .filter(item => item.categoryid === categoryId).length;\n\n                if (resourceCount > 0) {\n                    // Category has resources - show informative message.\n                    const errorTitle = await getString('error', 'core');\n                    const errorMessage = await getString('resources:category_has_resources', 'mod_bookit');\n\n                    Notification.alert(\n                        errorTitle,\n                        errorMessage\n                    );\n                    return;\n                }\n\n                // No resources - proceed with delete confirmation.\n                const confirmTitle = await getString('confirm', 'core');\n                const confirmMessage = await getString('areyousure', 'core');\n                const deleteText = await getString('delete', 'core');\n\n                Notification.deleteCancel(\n                    confirmTitle,\n                    confirmMessage,\n                    deleteText,\n                    () => {\n                        modalForm.getFormNode().querySelector('input[name=\"action\"]').value = 'delete';\n                        modalForm.submitFormAjax();\n                    }\n                );\n            });\n        });\n\n        modalForm.show();\n    }\n\n    /**\n     * Handle edit item from table view.\n     *\n     * @param {HTMLElement} button - Button element\n     */\n    async _handleEditItemFromTable(button) {\n        const itemId = parseInt(button.dataset.itemId);\n        const state = this.reactive.state;\n        const item = state.items.get(itemId);\n\n        if (!item) {\n            return;\n        }\n\n        const modalForm = new ModalForm({\n            formClass: 'mod_bookit\\\\form\\\\edit_resource_form',\n            moduleName: 'mod_bookit/modal_delete_save_cancel',\n            args: {\n                id: itemId,\n            },\n            modalConfig: {\n                title: await getString('resources:edit_resource', 'mod_bookit'),\n            },\n        });\n\n        modalForm.addEventListener(modalForm.events.FORM_SUBMITTED, (response) => {\n            this.reactive.stateManager.processUpdates(response.detail);\n        });\n\n        modalForm.addEventListener(modalForm.events.LOADED, () => {\n            const deleteButton = modalForm.modal.getRoot().find('button[data-action=\"delete\"]');\n\n            deleteButton.on('click', async(e) => {\n                e.preventDefault();\n\n                const confirmTitle = await getString('confirm', 'core');\n                const confirmMessage = await getString('areyousure', 'core');\n                const deleteText = await getString('delete', 'core');\n\n                Notification.deleteCancel(\n                    confirmTitle,\n                    confirmMessage,\n                    deleteText,\n                    () => {\n                        modalForm.getFormNode().querySelector('input[name=\"action\"]').value = 'delete';\n                        modalForm.submitFormAjax();\n                    }\n                );\n            });\n        });\n\n        modalForm.show();\n    }\n\n    /**\n     * Handle add category action.\n     */\n    async _handleAddCategory() {\n        const modalForm = new ModalForm({\n            formClass: 'mod_bookit\\\\form\\\\edit_resource_category_form',\n            args: {\n                contextid: this.selectors.contextId,\n            },\n            modalConfig: {\n                title: await getString('resources:add_category', 'mod_bookit'),\n            },\n        });\n\n        modalForm.addEventListener(modalForm.events.FORM_SUBMITTED, (response) => {\n            this.reactive.stateManager.processUpdates(response.detail);\n        });\n\n        modalForm.show();\n    }\n\n    /**\n     * Handle add resource button click.\n     */\n    async _handleAddResource() {\n        const modalForm = new ModalForm({\n            formClass: 'mod_bookit\\\\form\\\\edit_resource_form',\n            args: {\n                contextid: this.selectors.contextId,\n            },\n            modalConfig: {\n                title: await getString('resources:add_resource', 'mod_bookit'),\n            },\n        });\n\n        modalForm.addEventListener(modalForm.events.FORM_SUBMITTED, (response) => {\n            this.reactive.stateManager.processUpdates(response.detail);\n        });\n\n        modalForm.show();\n    }\n\n    /**\n     * Handle toggle active switch.\n     *\n     * @param {HTMLElement} checkbox - Toggle checkbox element\n     */\n    async _handleToggleActive(checkbox) {\n        const itemId = parseInt(checkbox.dataset.itemId);\n        const state = this.reactive.state;\n        const item = state.items.get(itemId);\n\n        if (!item) {\n            return;\n        }\n\n        // Get the new active state from the checkbox.\n        const newActiveState = checkbox.checked;\n\n        // Build form data object.\n        const formData = {\n            id: itemId,\n            name: item.name,\n            description: item.description || '',\n            categoryid: item.categoryid,\n            amount: item.amount,\n            amountirrelevant: item.amountirrelevant ? 1 : 0,\n            sortorder: item.sortorder,\n            active: newActiveState ? 1 : 0,\n            roomids: item.roomids || [],\n            action: 'put',\n            [`_qf__mod_bookit_form_edit_resource_form`]: 1\n        };\n\n        // Convert to URL-encoded string.\n        const formDataString = new URLSearchParams(formData).toString();\n\n        // Submit via Ajax.\n        Ajax.call([{\n            methodname: 'core_form_dynamic_form',\n            args: {\n                formdata: formDataString,\n                form: 'mod_bookit\\\\form\\\\edit_resource_form'\n            }\n        }])[0]\n        .then((response) => {\n            this.reactive.stateManager.processUpdates(JSON.parse(response.data));\n            return;\n        })\n        .catch((error) => {\n            // Revert checkbox on error.\n            checkbox.checked = !newActiveState;\n            window.console.error('Toggle active error:', error);\n        });\n    }\n\n    /**\n     * Show no categories message.\n     */\n    _showNoCategoriesMessage() {\n        const msg = document.querySelector(this.selectors.noCategoriesMsg);\n        if (msg) {\n            msg.classList.remove('d-none');\n        }\n    }\n\n    /**\n     * Hide no categories message.\n     */\n    _hideNoCategoriesMessage() {\n        const msg = document.querySelector(this.selectors.noCategoriesMsg);\n        if (msg) {\n            msg.classList.add('d-none');\n        }\n    }\n\n    /**\n     * Initialize category components from existing DOM.\n     */\n    _initializeCategoryComponents() {\n        const categoryElements = this.element.querySelectorAll('[data-region=\"resource-category\"]');\n        const state = this.reactive.state;\n\n        categoryElements.forEach(categoryEl => {\n            const categoryId = parseInt(categoryEl.dataset.categoryid);\n            const category = state.categories.get(categoryId);\n            if (category) {\n                // Component attaches to existing DOM element (no rendering).\n                const component = new ResourceCategory({\n                    element: this.element.querySelector('#mod-bookit-resource-table'),\n                    reactive: this.reactive,\n                    categoryData: category,\n                });\n                // Set existing DOM element.\n                component.categoryElement = categoryEl;\n                component._attachEventListeners();\n                // Initialize item components from existing DOM.\n                component._initItemsFromDOM();\n\n                this.categoryComponents.set(categoryId, component);\n            }\n        });\n    }\n\n    /**\n     * Render a new category component.\n     *\n     * @param {Object} categoryData - Category data\n     */\n    _renderCategory(categoryData) {\n        const tableEl = this.element.querySelector('#mod-bookit-resource-table');\n        if (!tableEl) {\n            return;\n        }\n\n        const component = new ResourceCategory({\n            element: tableEl,\n            reactive: this.reactive,\n            categoryData: categoryData,\n        });\n\n        this.categoryComponents.set(categoryData.id, component);\n    }\n}\n"],"names":["BaseComponent","target","element","document","querySelector","contextId","parseInt","dataset","contextid","categoriesArray","itemsArray","querySelectorAll","forEach","categoryEl","categoryRow","categoryData","id","categoryid","name","categoryName","textContent","trim","description","categoryDescription","sortorder","categorySortorder","push","itemEl","itemData","itemid","itemName","itemDescription","itemCategoryid","amount","itemAmount","amountirrelevant","itemAmountirrelevant","active","itemActive","itemSortorder","categories","items","this","reactive","resourceReactiveInstance","selectors","componentName","create","addCategoryBtn","addResourceBtn","tableView","categoryComponents","Map","stateReady","_initializeCategoryComponents","_attachEventListeners","getWatchers","watch","handler","_handleCategoryCreated","_handleCategoryUpdated","_handleCategoryDeleted","_handleItemCreated","_handleActiveToggle","_replaceRenderedItem","_renderCategory","component","get","update","remove","delete","checkbox","window","console","warn","checked","label","row","classList","toggle","event","fieldPart","action","split","item","state","amountCell","innerHTML","addBtn","addEventListener","e","preventDefault","_handleAddCategory","_handleAddResource","_attachTableViewEventListeners","async","closest","_handleToggleActive","_handleEditCategoryFromTable","_handleEditItemFromTable","button","categoryId","modalForm","ModalForm","formClass","moduleName","args","modalConfig","title","events","FORM_SUBMITTED","response","stateManager","processUpdates","detail","LOADED","modal","getRoot","find","on","Array","from","values","filter","length","errorTitle","errorMessage","alert","confirmTitle","confirmMessage","deleteText","deleteCancel","getFormNode","value","submitFormAjax","show","itemId","newActiveState","formData","roomids","formDataString","URLSearchParams","toString","call","methodname","formdata","form","then","JSON","parse","data","catch","error","_showNoCategoriesMessage","msg","noCategoriesMsg","_hideNoCategoriesMessage","add","categoryElements","category","ResourceCategory","categoryElement","_initItemsFromDOM","set","tableEl"],"mappings":"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"}