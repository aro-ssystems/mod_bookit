{"version":3,"file":"master_checklist_item.min.js","sources":["../src/master_checklist_item.js"],"sourcesContent":["import { BaseComponent } from 'core/reactive';\nimport { masterChecklistReactiveInstance } from 'mod_bookit/master_checklist_reactive';\nimport { SELECTORS } from 'mod_bookit/master_checklist_reactive';\nimport ModalForm from 'core_form/modalform';\nimport Templates from 'core/templates';\nimport {getString} from 'core/str';\n\nexport default class extends BaseComponent {\n\n    create(descriptor) {\n\n        window.console.log('create item component: ' + descriptor.element.dataset.bookitChecklistitemName);\n\n        const itemEditBtnSelector = 'EDIT_CHECKLISTITEM_BTN_' + descriptor.element.dataset.bookitChecklistitemId;\n\n        this.selectors[itemEditBtnSelector] = `#edit-checklistitem-${descriptor.element.dataset.bookitChecklistitemId}`;\n\n    }\n\n    static init(target, selectors) {\n        return new this({\n            element: document.querySelector(target),\n            reactive: masterChecklistReactiveInstance,\n            selectors: selectors || SELECTORS,\n        });\n    }\n\n    getWatchers() {\n        // window.console.log('GET WATCHERS');\n        return [\n            {watch: 'state:updated', handler: this._handleStateEvent},\n            // {watch: 'checklistcategories:created', handler: this._handleCategoryCreatedEvent},\n        ];\n    }\n\n    stateReady(state) {\n\n        // window.console.log('state ready');\n        // window.console.log(state);\n\n        // const name = state.masterchecklists.get(1).name;\n\n        // window.console.log(this.selectors.MASTER_CHECKLIST_TITLE);\n        window.console.log(this.selectors);\n\n        const itemEditBtnSelector = 'EDIT_CHECKLISTITEM_BTN_' + this.element.dataset.bookitChecklistitemId;\n\n        this.addEventListener(this.getElement(this.selectors[itemEditBtnSelector]), 'click', (e) => {\n            e.preventDefault();\n            window.console.log('EDIT CHECKLIST ITEM BUTTON CLICKED', e.currentTarget);\n            this._handleEditChecklistItemButtonClick(e);\n        });\n\n    }\n\n    _handleStateEvent(event) {\n        // window.console.log('handle state event');\n    }\n\n    async _handleEditChecklistItemButtonClick(event) {\n        window.console.log('handle edit checklist item button click');\n        window.console.log(event);\n        const modalForm = new ModalForm({\n            formClass: \"mod_bookit\\\\form\\\\edit_checklistitem_form\",\n            args: {\n                masterid: 1,\n                itemid: event.currentTarget.value,\n                categories: Array.from(this.reactive.state.checklistcategories.values()),\n            },\n            modalConfig: {\n                title: await getString('checklistitem', 'mod_bookit'),\n            },\n\n        });\n\n        modalForm.addEventListener(modalForm.events.FORM_SUBMITTED, (response) => {\n            this.reactive.stateManager.processUpdates(response.detail);\n        });\n\n        modalForm.show().then(() => {\n\n            const modalRoot = modalForm.modal.getRoot()[0];\n\n            const deleteButton = document.createElement('button');\n            deleteButton.type = 'button';\n            deleteButton.className = 'btn btn-danger';\n            deleteButton.textContent = 'Delete';\n\n            deleteButton.style.marginRight = 'auto';\n\n            const footer = modalRoot.querySelector('.modal-footer');\n            if (footer) {\n                footer.prepend(deleteButton);\n            }\n\n            deleteButton.addEventListener('click', (event) => {\n                // const form = modalForm.getForm();\n                // const categoryid = form.elements['id']?.value;\n                // if (confirm('Are you sure you want to delete this category?')) {\n                //     console.log('Deleting category with id:', categoryid);\n                //     modal.hide(); // Close modal manually\n                // }\n                modalForm.modal.destroy();\n            });\n        });\n    }\n\n\n    // _handleCategoryCreatedEvent(event) {\n    //     window.console.log('handle category created event');\n    //     window.console.log(event.element);\n\n    //     // TODO cats and/or items should be own components\n\n    //     Templates.renderForPromise('mod_bookit/bookit_checklist_category',\n    //         {\n    //             id: event.element.id,\n    //             name: event.element.name,\n    //             order: event.element.order\n    //         })\n    //         .then(({html, js}) => {\n    //             // Templates.appendNodeContents(this.getElement(this.selectors.TABLE_BODY), html, js);\n    //             Templates.appendNodeContents(this.getElement(this.selectors.TABLE), html, js);\n    //         })\n    //         .catch();\n    // }\n\n}"],"names":["BaseComponent","create","descriptor","window","console","log","element","dataset","bookitChecklistitemName","itemEditBtnSelector","bookitChecklistitemId","selectors","target","this","document","querySelector","reactive","masterChecklistReactiveInstance","SELECTORS","getWatchers","watch","handler","_handleStateEvent","stateReady","state","addEventListener","getElement","e","preventDefault","currentTarget","_handleEditChecklistItemButtonClick","event","modalForm","ModalForm","formClass","args","masterid","itemid","value","categories","Array","from","checklistcategories","values","modalConfig","title","events","FORM_SUBMITTED","response","stateManager","processUpdates","detail","show","then","modalRoot","modal","getRoot","deleteButton","createElement","type","className","textContent","style","marginRight","footer","prepend","destroy"],"mappings":"wgBAO6BA,wBAEzBC,OAAOC,YAEHC,OAAOC,QAAQC,IAAI,0BAA4BH,WAAWI,QAAQC,QAAQC,+BAEpEC,oBAAsB,0BAA4BP,WAAWI,QAAQC,QAAQG,2BAE9EC,UAAUF,mDAA8CP,WAAWI,QAAQC,QAAQG,mCAIhFE,OAAQD,kBACT,IAAIE,KAAK,CACZP,QAASQ,SAASC,cAAcH,QAChCI,SAAUC,2DACVN,UAAWA,WAAaO,uCAIhCC,oBAEW,CACH,CAACC,MAAO,gBAAiBC,QAASR,KAAKS,oBAK/CC,WAAWC,OAQPrB,OAAOC,QAAQC,IAAIQ,KAAKF,iBAElBF,oBAAsB,0BAA4BI,KAAKP,QAAQC,QAAQG,2BAExEe,iBAAiBZ,KAAKa,WAAWb,KAAKF,UAAUF,sBAAuB,SAAUkB,IAClFA,EAAEC,iBACFzB,OAAOC,QAAQC,IAAI,qCAAsCsB,EAAEE,oBACtDC,oCAAoCH,MAKjDL,kBAAkBS,kDAIwBA,OACtC5B,OAAOC,QAAQC,IAAI,2CACnBF,OAAOC,QAAQC,IAAI0B,aACbC,UAAY,IAAIC,mBAAU,CAC5BC,UAAW,4CACXC,KAAM,CACFC,SAAU,EACVC,OAAQN,MAAMF,cAAcS,MAC5BC,WAAYC,MAAMC,KAAK5B,KAAKG,SAASQ,MAAMkB,oBAAoBC,WAEnEC,YAAa,CACTC,YAAa,kBAAU,gBAAiB,iBAKhDb,UAAUP,iBAAiBO,UAAUc,OAAOC,gBAAiBC,gBACpDhC,SAASiC,aAAaC,eAAeF,SAASG,WAGvDnB,UAAUoB,OAAOC,MAAK,WAEZC,UAAYtB,UAAUuB,MAAMC,UAAU,GAEtCC,aAAe3C,SAAS4C,cAAc,UAC5CD,aAAaE,KAAO,SACpBF,aAAaG,UAAY,iBACzBH,aAAaI,YAAc,SAE3BJ,aAAaK,MAAMC,YAAc,aAE3BC,OAASV,UAAUvC,cAAc,iBACnCiD,QACAA,OAAOC,QAAQR,cAGnBA,aAAahC,iBAAiB,SAAUM,QAOpCC,UAAUuB,MAAMW"}