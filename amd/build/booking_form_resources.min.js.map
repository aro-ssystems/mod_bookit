{"version":3,"file":"booking_form_resources.min.js","sources":["../src/booking_form_resources.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Room-based resource filtering for booking form.\n *\n * @module     mod_bookit/booking_form_resources\n * @copyright  2026 ssystems GmbH <oss@ssystems.de>\n * @author     Andreas Rosenthal\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\ndefine([], function() {\n    'use strict';\n\n    /**\n     * Show a resource group.\n     *\n     * @param {Element} groupElement The resource group element\n     */\n    function showResource(groupElement) {\n        groupElement.style.display = '';\n    }\n\n    /**\n     * Hide a resource group.\n     *\n     * @param {Element} groupElement The resource group element\n     */\n    function hideResource(groupElement) {\n        groupElement.style.display = 'none';\n    }\n\n    /**\n     * Update visibility of resource category groups based on their content.\n     *\n     * @param {Element} modalRoot The modal root element\n     */\n    function updateCategoryVisibility(modalRoot) {\n        if (!modalRoot) {\n            return;\n        }\n\n        // Find all resource category fieldsets (groups).\n        // Category fieldsets have IDs like \"id_header_cat_1_*\", \"id_header_cat_2_*\", etc.\n        const categoryGroups = modalRoot.querySelectorAll('fieldset[id*=\"id_header_cat_\"]');\n\n        categoryGroups.forEach(fieldset => {\n            // Check if this category has any visible resources.\n            const resourceCheckboxes = fieldset.querySelectorAll('[data-resource-rooms]');\n            let hasVisibleResource = false;\n\n            resourceCheckboxes.forEach(checkbox => {\n                const display = window.getComputedStyle(checkbox).display;\n                if (display !== 'none') {\n                    hasVisibleResource = true;\n                }\n            });\n\n            // Hide the entire category if no resources are visible.\n            if (hasVisibleResource) {\n                fieldset.style.display = '';\n            } else {\n                fieldset.style.display = 'none';\n            }\n        });\n    }\n\n    /**\n     * Filter resources based on selected room.\n     *\n     * @param {Element} modalRoot The modal root element\n     * @param {number|string} selectedRoomId The selected room ID\n     */\n    function filterResourcesByRoom(modalRoot, selectedRoomId) {\n        if (!modalRoot) {\n            return;\n        }\n\n        const roomId = parseInt(selectedRoomId, 10);\n\n        // Find all resource groups with data-resource-rooms attribute.\n        const resourceGroups = modalRoot.querySelectorAll('[data-resource-rooms]');\n\n        resourceGroups.forEach(group => {\n            const roomsJson = group.getAttribute('data-resource-rooms');\n            if (!roomsJson) {\n                hideResource(group);\n                return;\n            }\n\n            try {\n                const rooms = JSON.parse(roomsJson);\n                if (Array.isArray(rooms) && rooms.includes(roomId)) {\n                    showResource(group);\n                } else {\n                    hideResource(group);\n                }\n            } catch (e) {\n                // Invalid JSON, hide the resource.\n                hideResource(group);\n            }\n        });\n\n        // After filtering individual resources, update category visibility.\n        updateCategoryVisibility(modalRoot);\n    }\n\n    /**\n     * Initialize resource filtering.\n     *\n     * @param {Element} modalRoot The modal root element containing the form\n     */\n    function init(modalRoot) {\n        if (!modalRoot) {\n            return;\n        }\n\n        // Find the room select element.\n        const roomSelect = modalRoot.querySelector('select[name=\"roomid\"]');\n        if (!roomSelect) {\n            return;\n        }\n\n        // Initially hide all resources (no room selected) and empty categories.\n        const resourceGroups = modalRoot.querySelectorAll('[data-resource-rooms]');\n        resourceGroups.forEach(group => hideResource(group));\n        updateCategoryVisibility(modalRoot);\n\n        // Listen for room changes.\n        roomSelect.addEventListener('change', function() {\n            const selectedRoomId = this.value;\n            if (selectedRoomId) {\n                filterResourcesByRoom(modalRoot, selectedRoomId);\n            } else {\n                // No room selected - hide all resources and categories.\n                resourceGroups.forEach(group => hideResource(group));\n                updateCategoryVisibility(modalRoot);\n            }\n        });\n\n        // If a room is already selected, filter immediately.\n        if (roomSelect.value) {\n            filterResourcesByRoom(modalRoot, roomSelect.value);\n        }\n    }\n\n    return {\n        init: init\n    };\n});\n"],"names":["define","hideResource","groupElement","style","display","updateCategoryVisibility","modalRoot","querySelectorAll","forEach","fieldset","resourceCheckboxes","hasVisibleResource","checkbox","window","getComputedStyle","filterResourcesByRoom","selectedRoomId","roomId","parseInt","group","roomsJson","getAttribute","rooms","JSON","parse","Array","isArray","includes","e","init","roomSelect","querySelector","resourceGroups","addEventListener","this","value"],"mappings":";;;;;;;;AAwBAA,2CAAO,IAAI,oBAiBEC,aAAaC,cAClBA,aAAaC,MAAMC,QAAU,gBAQxBC,yBAAyBC,eACzBA,iBAMkBA,UAAUC,iBAAiB,kCAEnCC,SAAQC,iBAEbC,mBAAqBD,SAASF,iBAAiB,6BACjDI,oBAAqB,EAEzBD,mBAAmBF,SAAQI,WAEP,SADAC,OAAOC,iBAAiBF,UAAUR,UAE9CO,oBAAqB,MAMzBF,SAASN,MAAMC,QADfO,mBACyB,GAEA,mBAW5BI,sBAAsBT,UAAWU,oBACjCV,uBAICW,OAASC,SAASF,eAAgB,IAGjBV,UAAUC,iBAAiB,yBAEnCC,SAAQW,cACbC,UAAYD,MAAME,aAAa,0BAChCD,oBAMKE,MAAQC,KAAKC,MAAMJ,WACrBK,MAAMC,QAAQJ,QAAUA,MAAMK,SAASV,QAC1BE,MAzEZhB,MAAMC,QAAU,GA2EjBH,aAAakB,OAEnB,MAAOS,GAEL3B,aAAakB,YAbblB,aAAakB,UAkBrBd,yBAAyBC,iBA0CtB,CACHuB,cAnCUvB,eACLA,uBAKCwB,WAAaxB,UAAUyB,cAAc,6BACtCD,wBAKCE,eAAiB1B,UAAUC,iBAAiB,yBAClDyB,eAAexB,SAAQW,OAASlB,aAAakB,SAC7Cd,yBAAyBC,WAGzBwB,WAAWG,iBAAiB,UAAU,iBAC5BjB,eAAiBkB,KAAKC,MACxBnB,eACAD,sBAAsBT,UAAWU,iBAGjCgB,eAAexB,SAAQW,OAASlB,aAAakB,SAC7Cd,yBAAyBC,eAK7BwB,WAAWK,OACXpB,sBAAsBT,UAAWwB,WAAWK"}