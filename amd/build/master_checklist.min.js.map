{"version":3,"file":"master_checklist.min.js","sources":["../src/master_checklist.js"],"sourcesContent":["import { BaseComponent } from 'core/reactive';\nimport ModalEvents from 'core/modal_events';\nimport ModalForm from 'core_form/modalform';\nimport Templates from 'core/templates';\n\nexport default class extends BaseComponent {\n\n    create(descriptor) {\n\n        window.console.log('create component: ' + descriptor.reactive.name);\n\n    }\n\n    getWatchers() {\n        window.console.log('GET WATCHERS');\n        return [\n            {watch: 'state:updated', handler: this._handleStateEvent},\n            {watch: 'checklistcategories:created', handler: this._handleCategoryCreatedEvent},\n        ];\n    }\n\n    stateReady(state) {\n\n        window.console.log('state ready');\n        window.console.log(state);\n\n        const name = state.masterchecklists.get(1).name;\n\n        window.console.log(this.selectors.MASTER_CHECKLIST_TITLE);\n\n        const titleElement = this.getElement(this.selectors.MASTER_CHECKLIST_TITLE);\n\n        window.console.log(titleElement);\n\n        titleElement.innerHTML = name;\n\n        this.addEventListener(this.getElement(this.selectors.ADD_CHECKLIST_ITEM_BUTTON), 'click', (e) => {\n            e.preventDefault();\n            window.console.log('ADD CHECKLIST ITEM BUTTON CLICKED');\n            this._handleAddChecklistItemButtonClick(e);\n        });\n\n        this.addEventListener(this.getElement(this.selectors.ADD_CHECKLIST_CATEGORY_BUTTON), 'click', (e) => {\n            e.preventDefault();\n            window.console.log('ADD CHECKLIST CATEGORY BUTTON CLICKED');\n            this._handleAddChecklistCategoryButtonClick(e);\n        });\n    }\n\n    _handleStateEvent(event) {\n        window.console.log('handle state event');\n    }\n\n    _handleAddChecklistItemButtonClick(event) {\n        window.console.log('handle add checklist item button click');\n\n        window.console.log(Array.from(this.reactive.state.checklistcategories.values()));\n\n        // TODO dont do this twice\n        const modalForm = new ModalForm({\n            formClass: \"mod_bookit\\\\form\\\\edit_checklistitem_form\",\n            args: {\n                masterid: 1,\n                categories: Array.from(this.reactive.state.checklistcategories.values()),\n            },\n            modalConfig: {\n                title: 'TITLE HERE', // TODO use lang string\n            },\n            // moduleName: 'mod_bookit/modal_checklistitem_form',\n        });\n\n        modalForm.show();\n    }\n\n    _handleAddChecklistCategoryButtonClick(event) {\n        window.console.log('handle add checklist category button click');\n        const modalForm = new ModalForm({\n            formClass: \"mod_bookit\\\\form\\\\edit_checklist_category_form\",\n            args: {\n                masterid: 1\n            },\n            modalConfig: {\n                title: 'Add Checklist Category', // TODO use lang string\n            },\n        });\n\n        modalForm.addEventListener(modalForm.events.FORM_SUBMITTED, (response) => {\n            this.reactive.stateManager.processUpdates(response.detail);\n\n\n            // Templates.renderForPromise('mod_bookit/bookit_checklist_category', {id: 34, name: 'New Category', order: 43})\n            // .then(({html, js}) => {\n            //     Templates.appendNodeContents(this.getElement(this.selectors.TABLE_BODY), html, js);\n            // })\n            // .catch();\n        });\n\n        modalForm.show();\n    }\n\n    _handleCategoryCreatedEvent(event) {\n        window.console.log('handle category created event');\n        window.console.log(event.element);\n\n        // TODO cats and/or items should be own components\n\n        Templates.renderForPromise('mod_bookit/bookit_checklist_category',\n            {\n                id: event.element.id,\n                name: event.element.name,\n                order: event.element.order\n            })\n            .then(({html, js}) => {\n                Templates.appendNodeContents(this.getElement(this.selectors.TABLE_BODY), html, js);\n            })\n            .catch();\n    }\n\n}"],"names":["BaseComponent","create","descriptor","window","console","log","reactive","name","getWatchers","watch","handler","this","_handleStateEvent","_handleCategoryCreatedEvent","stateReady","state","masterchecklists","get","selectors","MASTER_CHECKLIST_TITLE","titleElement","getElement","innerHTML","addEventListener","ADD_CHECKLIST_ITEM_BUTTON","e","preventDefault","_handleAddChecklistItemButtonClick","ADD_CHECKLIST_CATEGORY_BUTTON","_handleAddChecklistCategoryButtonClick","event","Array","from","checklistcategories","values","ModalForm","formClass","args","masterid","categories","modalConfig","title","show","modalForm","events","FORM_SUBMITTED","response","stateManager","processUpdates","detail","element","renderForPromise","id","order","then","_ref","html","js","appendNodeContents","TABLE_BODY","catch"],"mappings":"ugBAK6BA,wBAEzBC,OAAOC,YAEHC,OAAOC,QAAQC,IAAI,qBAAuBH,WAAWI,SAASC,MAIlEC,qBACIL,OAAOC,QAAQC,IAAI,gBACZ,CACH,CAACI,MAAO,gBAAiBC,QAASC,KAAKC,mBACvC,CAACH,MAAO,8BAA+BC,QAASC,KAAKE,8BAI7DC,WAAWC,OAEPZ,OAAOC,QAAQC,IAAI,eACnBF,OAAOC,QAAQC,IAAIU,aAEbR,KAAOQ,MAAMC,iBAAiBC,IAAI,GAAGV,KAE3CJ,OAAOC,QAAQC,IAAIM,KAAKO,UAAUC,8BAE5BC,aAAeT,KAAKU,WAAWV,KAAKO,UAAUC,wBAEpDhB,OAAOC,QAAQC,IAAIe,cAEnBA,aAAaE,UAAYf,UAEpBgB,iBAAiBZ,KAAKU,WAAWV,KAAKO,UAAUM,2BAA4B,SAAUC,IACvFA,EAAEC,iBACFvB,OAAOC,QAAQC,IAAI,0CACdsB,mCAAmCF,WAGvCF,iBAAiBZ,KAAKU,WAAWV,KAAKO,UAAUU,+BAAgC,SAAUH,IAC3FA,EAAEC,iBACFvB,OAAOC,QAAQC,IAAI,8CACdwB,uCAAuCJ,MAIpDb,kBAAkBkB,OACd3B,OAAOC,QAAQC,IAAI,sBAGvBsB,mCAAmCG,OAC/B3B,OAAOC,QAAQC,IAAI,0CAEnBF,OAAOC,QAAQC,IAAI0B,MAAMC,KAAKrB,KAAKL,SAASS,MAAMkB,oBAAoBC,WAGpD,IAAIC,mBAAU,CAC5BC,UAAW,4CACXC,KAAM,CACFC,SAAU,EACVC,WAAYR,MAAMC,KAAKrB,KAAKL,SAASS,MAAMkB,oBAAoBC,WAEnEM,YAAa,CACTC,MAAO,gBAKLC,OAGdb,uCAAuCC,OACnC3B,OAAOC,QAAQC,IAAI,oDACbsC,UAAY,IAAIR,mBAAU,CAC5BC,UAAW,iDACXC,KAAM,CACFC,SAAU,GAEdE,YAAa,CACTC,MAAO,4BAIfE,UAAUpB,iBAAiBoB,UAAUC,OAAOC,gBAAiBC,gBACpDxC,SAASyC,aAAaC,eAAeF,SAASG,WAUvDN,UAAUD,OAGd7B,4BAA4BiB,OACxB3B,OAAOC,QAAQC,IAAI,iCACnBF,OAAOC,QAAQC,IAAIyB,MAAMoB,4BAIfC,iBAAiB,uCACvB,CACIC,GAAItB,MAAMoB,QAAQE,GAClB7C,KAAMuB,MAAMoB,QAAQ3C,KACpB8C,MAAOvB,MAAMoB,QAAQG,QAExBC,MAAKC,WAACC,KAACA,KAADC,GAAOA,4BACAC,mBAAmB/C,KAAKU,WAAWV,KAAKO,UAAUyC,YAAaH,KAAMC,OAElFG"}