define("mod_bookit/resource_category",["exports","core/reactive","core/templates","core_form/modalform","core/str","core/notification","./resource_item"],(function(_exports,_reactive,_templates,_modalform,_str,_notification,_resource_item){function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}
/**
   * Resource category reactive component.
   *
   * @module mod_bookit/resource_category
   * @copyright   2026 ssystems GmbH <oss@ssystems.de>
   * @author      Andreas Rosenthal
   * @license     http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
   */Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.default=void 0,_templates=_interopRequireDefault(_templates),_modalform=_interopRequireDefault(_modalform),_notification=_interopRequireDefault(_notification),_resource_item=_interopRequireDefault(_resource_item);class ResourceCategory extends _reactive.BaseComponent{static get componentName(){return"mod_bookit/resource_category"}create(_ref){let{element:element,categoryData:categoryData}=_ref;this.categoryData=categoryData,this.categoryElement=null,this.itemComponents=new Map,this.parentElement=element,this._render()}getWatchers(){return[{watch:"items:created",handler:this._handleItemCreated},{watch:"items:updated",handler:this._handleItemUpdated},{watch:"items:deleted",handler:this._handleItemDeleted}]}async _render(){const context={...this.categoryData,resources:[]},html=await _templates.default.render("mod_bookit/resource_category_card",context),wrapper=document.createElement("div");wrapper.innerHTML=html.trim(),this.categoryElement=wrapper.firstChild,this.parentElement.appendChild(this.categoryElement),this._renderItems(),this._attachEventListeners()}_renderItems(){if(!this.categoryElement)return;const itemsContainer=this.categoryElement.querySelector('[data-region="items-container"]');if(!itemsContainer)return;itemsContainer.innerHTML="",this.itemComponents.clear();const state=this.reactive.state,items=Array.from(state.items.values()).filter((item=>item.categoryid===this.categoryData.id)).sort(((a,b)=>a.sortorder-b.sortorder));items.forEach((itemData=>{const itemComponent=new _resource_item.default({element:itemsContainer,reactive:this.reactive,itemData:itemData});this.itemComponents.set(itemData.id,itemComponent)})),this._updateNoItemsMessage(0===items.length)}_updateNoItemsMessage(show){const msg=this.categoryElement.querySelector('[data-region="no-items"]');msg&&(show?msg.classList.remove("d-none"):msg.classList.add("d-none"))}_handleItemCreated(_ref2){let{element:element}=_ref2;element.categoryid===this.categoryData.id&&this._renderItems()}_handleItemUpdated(_ref3){let{element:element}=_ref3;const hadItem=this.itemComponents.has(element.id),shouldHaveItem=element.categoryid===this.categoryData.id;if(hadItem!==shouldHaveItem)this._renderItems();else if(shouldHaveItem){const component=this.itemComponents.get(element.id);component&&component.update(element)}}_handleItemDeleted(_ref4){let{element:element}=_ref4;const component=this.itemComponents.get(element.id);if(component){component.remove(),this.itemComponents.delete(element.id);const state=this.reactive.state,remainingItems=Array.from(state.items.values()).filter((item=>item.categoryid===this.categoryData.id));this._updateNoItemsMessage(0===remainingItems.length)}}_attachEventListeners(){if(!this.categoryElement)return;const addBtn=this.categoryElement.querySelector('[data-action="add-item"]');addBtn&&addBtn.addEventListener("click",(e=>{e.preventDefault(),this._handleAddItem()}));const editBtn=this.categoryElement.querySelector('[data-action="edit-category"]');editBtn&&editBtn.addEventListener("click",(e=>{e.preventDefault(),this._handleEdit()}))}async _handleAddItem(){const modalForm=new _modalform.default({formClass:"mod_bookit\\form\\edit_resource_form",args:{categoryid:this.categoryData.id},modalConfig:{title:await(0,_str.get_string)("resources:add_resource","mod_bookit")}});modalForm.addEventListener(modalForm.events.FORM_SUBMITTED,(e=>{this.reactive.dispatch("createItem",e.detail)})),modalForm.show()}async _handleEdit(){const modalForm=new _modalform.default({formClass:"mod_bookit\\form\\edit_resource_category_form",moduleName:"mod_bookit/modal_delete_save_cancel",args:{id:this.categoryData.id},modalConfig:{title:await(0,_str.get_string)("resources:edit_category","mod_bookit")}});modalForm.addEventListener(modalForm.events.FORM_SUBMITTED,(e=>{this.reactive.stateManager.processUpdates(e.detail)})),modalForm.addEventListener(modalForm.events.LOADED,(()=>{modalForm.modal.getRoot().find('button[data-action="delete"]').on("click",(async e=>{e.preventDefault();const confirmTitle=await(0,_str.get_string)("confirm","core"),confirmMessage=await(0,_str.get_string)("areyousure","core"),deleteText=await(0,_str.get_string)("delete","core");_notification.default.deleteCancel(confirmTitle,confirmMessage,deleteText,(()=>{modalForm.getFormNode().querySelector('input[name="action"]').value="delete",modalForm.submitFormAjax()}))}))})),modalForm.show()}update(newData){this.categoryData=newData;const header=this.categoryElement.querySelector("h5");header&&(header.textContent=newData.name);const desc=this.categoryElement.querySelector(".text-muted");desc&&(desc.textContent=newData.description||"")}remove(){this.itemComponents.forEach((component=>component.remove())),this.itemComponents.clear(),this.categoryElement&&this.categoryElement.parentNode&&this.categoryElement.parentNode.removeChild(this.categoryElement)}}return _exports.default=ResourceCategory,_exports.default}));

//# sourceMappingURL=resource_category.min.js.map