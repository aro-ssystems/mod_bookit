define("mod_bookit/resource_category",["exports","core/reactive","core/templates","core_form/modalform","core/str","core/notification","./resource_item","./resource_reactive"],(function(_exports,_reactive,_templates,_modalform,_str,_notification,_resource_item,_resource_reactive){function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}
/**
   * Resource category reactive component.
   *
   * @module mod_bookit/resource_category
   * @copyright   2026 ssystems GmbH <oss@ssystems.de>
   * @author      Andreas Rosenthal
   * @license     http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
   */Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.default=void 0,_templates=_interopRequireDefault(_templates),_modalform=_interopRequireDefault(_modalform),_notification=_interopRequireDefault(_notification),_resource_item=_interopRequireDefault(_resource_item);class ResourceCategory extends _reactive.BaseComponent{static get componentName(){return"mod_bookit/resource_category"}create(_ref){let{element:element,categoryData:categoryData}=_ref;this.categoryData=categoryData,this.categoryElement=null,this.itemComponents=new Map,this.parentElement=element}getWatchers(){return[{watch:"items:created",handler:this._handleItemCreated},{watch:"items.categoryid:updated",handler:this._handleItemCategoryChanged},{watch:"items:deleted",handler:this._handleItemDeleted}]}async _render(){const categoryRowHtml=await _templates.default.render("mod_bookit/resource_category_row",this.categoryData),tbody=document.createElement("tbody");tbody.dataset.region="resource-category",tbody.dataset.categoryid=this.categoryData.id,tbody.dataset.categoryName=this.categoryData.name,tbody.dataset.categoryDescription=this.categoryData.description||"",tbody.dataset.categorySortorder=this.categoryData.sortorder||0,tbody.innerHTML=categoryRowHtml.trim(),this.categoryElement=tbody,this.parentElement.appendChild(this.categoryElement),await this._renderItems(),this._attachEventListeners()}async _renderItems(){if(!this.categoryElement)return;const categoryRow=this.categoryElement.querySelector('[data-region="resource-category-row"]');this.categoryElement.innerHTML="",categoryRow&&this.categoryElement.appendChild(categoryRow),this.itemComponents.clear();const state=this.reactive.state,items=Array.from(state.items.values()).filter((item=>item.categoryid===this.categoryData.id)).sort(((a,b)=>a.sortorder-b.sortorder));for(const itemData of items){const itemComponent=new _resource_item.default({element:this.categoryElement,reactive:this.reactive,itemData:itemData});await itemComponent._render(),this.itemComponents.set(itemData.id,itemComponent)}}_initItemsFromDOM(){if(!this.categoryElement)return;const state=this.reactive.state;this.categoryElement.querySelectorAll("tr[data-itemid]").forEach((itemRow=>{const itemId=parseInt(itemRow.dataset.bookitItemId),itemData=state.items.get(itemId);if(itemData&&itemData.categoryid===this.categoryData.id){const itemComponent=new _resource_item.default({element:itemRow,reactive:this.reactive,selectors:_resource_reactive.SELECTORS});this.itemComponents.set(itemData.id,itemComponent)}}))}async _handleItemCreated(_ref2){let{element:element}=_ref2;element.categoryid===this.categoryData.id&&await this._renderItems()}async _handleItemCategoryChanged(_ref3){let{element:element}=_ref3;this.itemComponents.has(element.id)!==(element.categoryid===this.categoryData.id)&&await this._renderItems()}_handleItemDeleted(_ref4){let{element:element}=_ref4;const component=this.itemComponents.get(element.id);component&&(component.remove(),this.itemComponents.delete(element.id))}_attachEventListeners(){if(!this.categoryElement)return;const addBtn=this.categoryElement.querySelector('[data-action="add-item"]');addBtn&&addBtn.addEventListener("click",(e=>{e.preventDefault(),this._handleAddItem()}));const editBtn=this.categoryElement.querySelector('[data-action="edit-category"]');editBtn&&editBtn.addEventListener("click",(e=>{e.preventDefault(),this._handleEdit()}))}async _handleAddItem(){const modalForm=new _modalform.default({formClass:"mod_bookit\\form\\edit_resource_form",args:{categoryid:this.categoryData.id},modalConfig:{title:await(0,_str.get_string)("resources:add_resource","mod_bookit")}});modalForm.addEventListener(modalForm.events.FORM_SUBMITTED,(e=>{this.reactive.dispatch("createItem",e.detail)})),modalForm.show()}async _handleEdit(){const modalForm=new _modalform.default({formClass:"mod_bookit\\form\\edit_resource_category_form",moduleName:"mod_bookit/modal_delete_save_cancel",args:{id:this.categoryData.id},modalConfig:{title:await(0,_str.get_string)("resources:edit_category","mod_bookit")}});modalForm.addEventListener(modalForm.events.FORM_SUBMITTED,(e=>{this.reactive.stateManager.processUpdates(e.detail)})),modalForm.addEventListener(modalForm.events.LOADED,(()=>{modalForm.modal.getRoot().find('button[data-action="delete"]').on("click",(async e=>{e.preventDefault();const state=this.reactive.state;if(Array.from(state.items.values()).filter((item=>item.categoryid===this.categoryData.id)).length>0){const errorTitle=await(0,_str.get_string)("error","core"),errorMessage=await(0,_str.get_string)("resources:category_has_resources","mod_bookit");return void _notification.default.alert(errorTitle,errorMessage)}const confirmTitle=await(0,_str.get_string)("confirm","core"),confirmMessage=await(0,_str.get_string)("areyousure","core"),deleteText=await(0,_str.get_string)("delete","core");_notification.default.deleteCancel(confirmTitle,confirmMessage,deleteText,(()=>{modalForm.getFormNode().querySelector('input[name="action"]').value="delete",modalForm.submitFormAjax()}))}))})),modalForm.show()}update(newData){this.categoryData=newData;const categoryRow=this.categoryElement.querySelector('[data-region="resource-category-row"]');categoryRow&&_templates.default.render("mod_bookit/resource_category_row",newData).then((html=>{const wrapper=document.createElement("tbody");wrapper.innerHTML=html.trim();const newRow=wrapper.firstChild;return categoryRow.parentNode.replaceChild(newRow,categoryRow),this._attachEventListeners(),!0})).catch((error=>{window.console.error("Error updating category row:",error)}))}remove(){this.itemComponents.forEach((component=>component.remove())),this.itemComponents.clear(),this.categoryElement&&this.categoryElement.parentNode&&this.categoryElement.parentNode.removeChild(this.categoryElement)}}return _exports.default=ResourceCategory,_exports.default}));

//# sourceMappingURL=resource_category.min.js.map