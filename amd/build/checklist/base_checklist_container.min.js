define("mod_bookit/checklist/base_checklist_container",["exports","core/reactive","core_form/modalform","core/str"],(function(_exports,_reactive,_modalform,_str){var obj;
/**
   * Base checklist container component.
   *
   * Abstract base class for checklist-style components providing common functionality:
   * - Reactive state management
   * - Category/item hierarchy
   * - Modal form handling
   * - Event listeners and watchers
   * - Config-driven specialization
   *
   * @module mod_bookit/checklist/base_checklist_container
   * @copyright   2026 ssystems GmbH <oss@ssystems.de>
   * @author      Andreas Rosenthal
   * @license     http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
   */Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.default=void 0,_modalform=(obj=_modalform)&&obj.__esModule?obj:{default:obj};class BaseChecklistContainer extends _reactive.BaseComponent{create(){var _config$selectors,_config$selectors2,_config$selectors3;const config=this.getConfig();this.selectors={addCategoryBtn:(null===(_config$selectors=config.selectors)||void 0===_config$selectors?void 0:_config$selectors.addCategoryBtn)||"#add-category-btn",addItemBtn:(null===(_config$selectors2=config.selectors)||void 0===_config$selectors2?void 0:_config$selectors2.addItemBtn)||"#add-item-btn",tableView:(null===(_config$selectors3=config.selectors)||void 0===_config$selectors3?void 0:_config$selectors3.tableView)||".mod-bookit-table-view",...config.selectors||{}},this.categoryComponents=new Map,this.strings={},this._cacheStrings()}stateReady(){this._initializeCategoryComponents(),this._attachEventListeners(),this._initializeCustomControls&&this._initializeCustomControls()}getWatchers(){const config=this.getConfig(),categoriesKey=config.categoriesStateKey||"categories",itemsKey=config.itemsStateKey||"items",baseWatchers=[{watch:"".concat(categoriesKey,":created"),handler:this._handleCategoryCreated},{watch:"".concat(categoriesKey,".name:updated"),handler:this._handleCategoryUpdated},{watch:"".concat(categoriesKey,".description:updated"),handler:this._handleCategoryUpdated},{watch:"".concat(categoriesKey,":deleted"),handler:this._handleCategoryDeleted},{watch:"".concat(itemsKey,":created"),handler:this._handleItemCreated},{watch:"".concat(itemsKey,".name:updated"),handler:this._replaceRenderedItem},{watch:"".concat(itemsKey,".description:updated"),handler:this._replaceRenderedItem}];return this._getCustomWatchers?[...baseWatchers,...this._getCustomWatchers()]:baseWatchers}getConfig(){throw new Error("getConfig() must be implemented by specialization")}getCategoryComponent(){throw new Error("getCategoryComponent() must be implemented by specialization")}_initializeCategoryComponents(){const config=this.getConfig(),categoriesKey=config.categoriesStateKey||"categories",categories=this.reactive.state[categoriesKey];categories&&categories.forEach(((category,categoryId)=>{const categoryRegion=config.categoryRegion||"checklist-category",categoryElement=this.getElement('[data-region="'.concat(categoryRegion,'"][data-categoryid="').concat(categoryId,'"]'));if(categoryElement){const instance=new(this.getCategoryComponent())({element:categoryElement,reactive:this.reactive});this.categoryComponents.set(categoryId,instance)}}))}_attachEventListeners(){const addCategoryBtn=this.getElement(this.selectors.addCategoryBtn);addCategoryBtn&&this.addEventListener(addCategoryBtn,"click",this._handleAddCategoryClick.bind(this));const addItemBtn=this.getElement(this.selectors.addItemBtn);addItemBtn&&this.addEventListener(addItemBtn,"click",this._handleAddItemClick.bind(this))}async _handleCategoryCreated(_ref){let{element:element}=_ref;await this._renderCategory(element)}_handleCategoryUpdated(_ref2){let{element:element}=_ref2;const component=this.categoryComponents.get(element.id);component&&component._updateCategoryRow(element)}_handleCategoryDeleted(_ref3){let{element:element}=_ref3;const component=this.categoryComponents.get(element.id);component&&(component.unregister(),this.categoryComponents.delete(element.id));const categoryElement=this.getElement('[data-region="checklist-category"][data-categoryid="'.concat(element.id,'"]'));categoryElement&&categoryElement.remove()}_handleItemCreated(_ref4){let{element:element}=_ref4;const component=this.categoryComponents.get(element.categoryid);component&&component._handleItemCreated({element:element})}_replaceRenderedItem(_ref5){let{element:element}=_ref5;const component=this.categoryComponents.get(element.categoryid);component&&component._replaceRenderedItem({element:element})}async _renderCategory(categoryData){const tableView=this.getElement(this.selectors.tableView);if(!tableView)return;if(this._renderCategoryCustom)return void await this._renderCategoryCustom(categoryData,tableView);const CategoryComponent=this.getCategoryComponent(),tempDiv=document.createElement("div");tempDiv.innerHTML='\n            <tbody data-region="checklist-category" data-categoryid="'.concat(categoryData.id,'">\n                <tr data-region="checklist-category-row">\n                    <td colspan="100">').concat(categoryData.name,"</td>\n                </tr>\n            </tbody>\n        ");const categoryElement=tempDiv.firstElementChild;tableView.appendChild(categoryElement);const instance=new CategoryComponent({element:categoryElement,reactive:this.reactive});this.categoryComponents.set(categoryData.id,instance)}async _handleAddCategoryClick(event){event.preventDefault();const config=this.getConfig(),contextId=this.selectors.contextId,modalForm=new _modalform.default({formClass:config.categoryModalForm,args:{id:0,contextid:contextId},modalConfig:{title:await(0,_str.get_string)("addcategory","mod_bookit")},returnFocus:event.currentTarget});modalForm.addEventListener(modalForm.events.FORM_SUBMITTED,(e=>{const response=e.detail;"success"===response.result&&this.reactive.dispatch("categoriesUpdated",{fields:response.data})})),modalForm.show()}async _handleAddItemClick(event){event.preventDefault();const config=this.getConfig(),contextId=this.selectors.contextId,modalForm=new _modalform.default({formClass:config.itemModalForm,args:{id:0,contextid:contextId},modalConfig:{title:await(0,_str.get_string)("add".concat(config.itemType),"mod_bookit")},returnFocus:event.currentTarget});modalForm.addEventListener(modalForm.events.FORM_SUBMITTED,(e=>{const response=e.detail;"success"===response.result&&this.reactive.dispatch("itemsUpdated",{fields:response.data})})),modalForm.show()}_cacheStrings(){(0,_str.get_string)("active","core").then((str=>(this.strings.active=str,str))).catch((()=>{this.strings.active="Active"})),(0,_str.get_string)("inactive","core").then((str=>(this.strings.inactive=str,str))).catch((()=>{this.strings.inactive="Inactive"}))}}return _exports.default=BaseChecklistContainer,_exports.default}));

//# sourceMappingURL=base_checklist_container.min.js.map