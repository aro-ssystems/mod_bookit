{"version":3,"file":"base_checklist_mutations.min.js","sources":["../../src/checklist/base_checklist_mutations.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Base checklist mutations class.\n *\n * Provides common mutation functions for CRUD operations on checklist-style reactive stores.\n * Can be extended by specializations to add domain-specific mutations.\n *\n * @module mod_bookit/checklist/base_checklist_mutations\n * @copyright   2026 ssystems GmbH <oss@ssystems.de>\n * @author      Andreas Rosenthal\n * @license     http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\n/**\n * Base checklist mutations class.\n *\n * Provides standard mutations for categories and items.\n * Specializations can extend this class to add domain-specific mutations.\n *\n * Usage:\n * ```\n * import BaseChecklistMutations from 'mod_bookit/checklist/base_checklist_mutations';\n *\n * export default class ResourceMutations extends BaseChecklistMutations {\n *     constructor() {\n *         super('categories', 'items');\n *     }\n *\n *     // Add domain-specific mutations\n *     itemsActiveToggled(stateManager, data) {\n *         // Custom logic\n *     }\n * }\n * ```\n */\nexport default class BaseChecklistMutations {\n    /**\n     * Constructor.\n     *\n     * @param {string} categoriesKey - State key for categories (default: 'categories')\n     * @param {string} itemsKey - State key for items (default: 'items')\n     */\n    constructor(categoriesKey = 'categories', itemsKey = 'items') {\n        this.categoriesKey = categoriesKey;\n        this.itemsKey = itemsKey;\n    }\n\n    /**\n     * Placeholder method for state events.\n     */\n    checklistStateEvent() {\n        // This method is intentionally empty - it's a placeholder for state events.\n    }\n\n    /**\n     * Handle category created (called by processUpdates for action: 'create').\n     *\n     * @param {Object} stateManager - The reactive state manager\n     * @param {Object} data - Data with fields object\n     */\n    categoriesCreated(stateManager, data) {\n        const state = stateManager.state;\n\n        stateManager.setReadOnly(false);\n\n        state[this.categoriesKey].set(data.fields.id, {\n            id: data.fields.id,\n            name: data.fields.name,\n            description: data.fields.description || '',\n            sortorder: data.fields.sortorder || 0,\n        });\n\n        stateManager.setReadOnly(true);\n    }\n\n    /**\n     * Handle category updated (called by processUpdates for action: 'put').\n     *\n     * @param {Object} stateManager - The reactive state manager\n     * @param {Object} data - Data with fields object\n     */\n    categoriesUpdated(stateManager, data) {\n        const state = stateManager.state;\n\n        stateManager.setReadOnly(false);\n\n        const existing = state[this.categoriesKey].get(data.fields.id) || {};\n        state[this.categoriesKey].set(data.fields.id, {\n            ...existing,\n            id: data.fields.id,\n            name: data.fields.name,\n            description: data.fields.description || '',\n            sortorder: data.fields.sortorder || existing.sortorder || 0,\n        });\n\n        stateManager.setReadOnly(true);\n    }\n\n    /**\n     * Handle category deletion (called by processUpdates for action: 'delete').\n     *\n     * @param {Object} stateManager - The reactive state manager\n     * @param {Object} data - Data with fields object containing id\n     */\n    categoriesDeleted(stateManager, data) {\n        const state = stateManager.state;\n\n        stateManager.setReadOnly(false);\n\n        // Delete all items in this category first\n        const itemsToDelete = [];\n        state[this.itemsKey].forEach((item, id) => {\n            if (item.categoryid === data.fields.id) {\n                itemsToDelete.push(id);\n            }\n        });\n        itemsToDelete.forEach(id => state[this.itemsKey].delete(id));\n\n        // Delete the category\n        state[this.categoriesKey].delete(data.fields.id);\n\n        stateManager.setReadOnly(true);\n    }\n\n    /**\n     * Handle item created (called by processUpdates for action: 'create').\n     *\n     * @param {Object} stateManager - The reactive state manager\n     * @param {Object} data - Data with fields object\n     */\n    itemsCreated(stateManager, data) {\n        const state = stateManager.state;\n\n        stateManager.setReadOnly(false);\n\n        state[this.itemsKey].set(data.fields.id, {\n            id: data.fields.id,\n            name: data.fields.name,\n            description: data.fields.description || '',\n            categoryid: data.fields.categoryid,\n            sortorder: data.fields.sortorder || 0,\n            ...this._getItemFields(data.fields),\n        });\n\n        stateManager.setReadOnly(true);\n    }\n\n    /**\n     * Handle item updated (called by processUpdates for action: 'put').\n     *\n     * @param {Object} stateManager - The reactive state manager\n     * @param {Object} data - Data with fields object\n     */\n    itemsUpdated(stateManager, data) {\n        const state = stateManager.state;\n\n        stateManager.setReadOnly(false);\n\n        const existing = state[this.itemsKey].get(data.fields.id) || {};\n        state[this.itemsKey].set(data.fields.id, {\n            ...existing,\n            id: data.fields.id,\n            name: data.fields.name,\n            description: data.fields.description || '',\n            categoryid: data.fields.categoryid,\n            sortorder: data.fields.sortorder || existing.sortorder || 0,\n            ...this._getItemFields(data.fields),\n        });\n\n        stateManager.setReadOnly(true);\n    }\n\n    /**\n     * Handle item deletion (called by processUpdates for action: 'delete').\n     *\n     * @param {Object} stateManager - The reactive state manager\n     * @param {Object} data - Data with fields object containing id\n     */\n    itemsDeleted(stateManager, data) {\n        const state = stateManager.state;\n\n        stateManager.setReadOnly(false);\n\n        state[this.itemsKey].delete(data.fields.id);\n\n        stateManager.setReadOnly(true);\n    }\n\n    /**\n     * Extract domain-specific item fields.\n     *\n     * Can be overridden by specializations to add domain-specific fields.\n     *\n     * @param {Object} fields - All fields from the data\n     * @return {Object} Domain-specific fields\n     */\n    _getItemFields(fields) { // eslint-disable-line no-unused-vars\n        // Base implementation returns empty object\n        // Specializations can override to add fields like:\n        // return {\n        //     active: Boolean(fields.active),\n        //     amount: fields.amount || 0,\n        //     duedate: fields.duedate || null,\n        // };\n        return {};\n    }\n\n    /**\n     * Extract domain-specific category fields.\n     *\n     * Can be overridden by specializations to add domain-specific fields.\n     *\n     * @param {Object} fields - All fields from the data\n     * @return {Object} Domain-specific fields\n     */\n    _getCategoryFields(fields) { // eslint-disable-line no-unused-vars\n        // Base implementation returns empty object\n        // Specializations can override to add domain-specific fields\n        return {};\n    }\n}\n"],"names":["constructor","categoriesKey","itemsKey","checklistStateEvent","categoriesCreated","stateManager","data","state","setReadOnly","this","set","fields","id","name","description","sortorder","categoriesUpdated","existing","get","categoriesDeleted","itemsToDelete","forEach","item","categoryid","push","delete","itemsCreated","_getItemFields","itemsUpdated","itemsDeleted","_getCategoryFields"],"mappings":";;;;;;;;;;;;MAwDIA,kBAAYC,qEAAgB,aAAcC,gEAAW,aAC5CD,cAAgBA,mBAChBC,SAAWA,SAMpBC,uBAUAC,kBAAkBC,aAAcC,YACtBC,MAAQF,aAAaE,MAE3BF,aAAaG,aAAY,GAEzBD,MAAME,KAAKR,eAAeS,IAAIJ,KAAKK,OAAOC,GAAI,CAC1CA,GAAIN,KAAKK,OAAOC,GAChBC,KAAMP,KAAKK,OAAOE,KAClBC,YAAaR,KAAKK,OAAOG,aAAe,GACxCC,UAAWT,KAAKK,OAAOI,WAAa,IAGxCV,aAAaG,aAAY,GAS7BQ,kBAAkBX,aAAcC,YACtBC,MAAQF,aAAaE,MAE3BF,aAAaG,aAAY,SAEnBS,SAAWV,MAAME,KAAKR,eAAeiB,IAAIZ,KAAKK,OAAOC,KAAO,GAClEL,MAAME,KAAKR,eAAeS,IAAIJ,KAAKK,OAAOC,GAAI,IACvCK,SACHL,GAAIN,KAAKK,OAAOC,GAChBC,KAAMP,KAAKK,OAAOE,KAClBC,YAAaR,KAAKK,OAAOG,aAAe,GACxCC,UAAWT,KAAKK,OAAOI,WAAaE,SAASF,WAAa,IAG9DV,aAAaG,aAAY,GAS7BW,kBAAkBd,aAAcC,YACtBC,MAAQF,aAAaE,MAE3BF,aAAaG,aAAY,SAGnBY,cAAgB,GACtBb,MAAME,KAAKP,UAAUmB,SAAQ,CAACC,KAAMV,MAC5BU,KAAKC,aAAejB,KAAKK,OAAOC,IAChCQ,cAAcI,KAAKZ,OAG3BQ,cAAcC,SAAQT,IAAML,MAAME,KAAKP,UAAUuB,OAAOb,MAGxDL,MAAME,KAAKR,eAAewB,OAAOnB,KAAKK,OAAOC,IAE7CP,aAAaG,aAAY,GAS7BkB,aAAarB,aAAcC,YACjBC,MAAQF,aAAaE,MAE3BF,aAAaG,aAAY,GAEzBD,MAAME,KAAKP,UAAUQ,IAAIJ,KAAKK,OAAOC,GAAI,CACrCA,GAAIN,KAAKK,OAAOC,GAChBC,KAAMP,KAAKK,OAAOE,KAClBC,YAAaR,KAAKK,OAAOG,aAAe,GACxCS,WAAYjB,KAAKK,OAAOY,WACxBR,UAAWT,KAAKK,OAAOI,WAAa,KACjCN,KAAKkB,eAAerB,KAAKK,UAGhCN,aAAaG,aAAY,GAS7BoB,aAAavB,aAAcC,YACjBC,MAAQF,aAAaE,MAE3BF,aAAaG,aAAY,SAEnBS,SAAWV,MAAME,KAAKP,UAAUgB,IAAIZ,KAAKK,OAAOC,KAAO,GAC7DL,MAAME,KAAKP,UAAUQ,IAAIJ,KAAKK,OAAOC,GAAI,IAClCK,SACHL,GAAIN,KAAKK,OAAOC,GAChBC,KAAMP,KAAKK,OAAOE,KAClBC,YAAaR,KAAKK,OAAOG,aAAe,GACxCS,WAAYjB,KAAKK,OAAOY,WACxBR,UAAWT,KAAKK,OAAOI,WAAaE,SAASF,WAAa,KACvDN,KAAKkB,eAAerB,KAAKK,UAGhCN,aAAaG,aAAY,GAS7BqB,aAAaxB,aAAcC,YACjBC,MAAQF,aAAaE,MAE3BF,aAAaG,aAAY,GAEzBD,MAAME,KAAKP,UAAUuB,OAAOnB,KAAKK,OAAOC,IAExCP,aAAaG,aAAY,GAW7BmB,eAAehB,cAQJ,GAWXmB,mBAAmBnB,cAGR"}