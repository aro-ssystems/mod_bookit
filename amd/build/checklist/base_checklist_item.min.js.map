{"version":3,"file":"base_checklist_item.min.js","sources":["../../src/checklist/base_checklist_item.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Base checklist item component.\n *\n * Abstract base class for item components providing common functionality:\n * - Edit/delete modal form handling\n * - Event listeners\n * - Config-driven specialization\n *\n * @module mod_bookit/checklist/base_checklist_item\n * @copyright   2026 ssystems GmbH <oss@ssystems.de>\n * @author      Andreas Rosenthal\n * @license     http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\nimport {BaseComponent} from 'core/reactive';\nimport Templates from 'core/templates';\nimport ModalForm from 'core_form/modalform';\nimport {get_string as getString} from 'core/str';\n\n/**\n * Base checklist item component.\n *\n * Specializations must implement:\n * - getConfig(): Return configuration object\n *\n * Optional overrides:\n * - _updateRow(itemData): Custom row update logic\n * - _getCustomWatchers(): Add custom state watchers\n */\nexport default class BaseChecklistItem extends BaseComponent {\n    /**\n     * Create component.\n     *\n     * @param {Object} descriptor - Component descriptor\n     */\n    create(descriptor) {\n        const itemId = descriptor.element.dataset.itemid || descriptor.element.dataset.bookitItemId;\n        if (itemId) {\n            const itemEditBtnSelector = this._getEditButtonSelector(itemId);\n            this.selectors[itemEditBtnSelector] = `#edit-item-${itemId}`;\n        }\n\n        // Store item data if provided\n        this.itemData = descriptor.itemData;\n    }\n\n    /**\n     * Get state watchers.\n     *\n     * @return {Array} Array of watcher definitions\n     */\n    getWatchers() {\n        const customWatchers = this._getCustomWatchers ? this._getCustomWatchers() : [];\n        return [...customWatchers];\n    }\n\n    /**\n     * Get configuration object.\n     *\n     * Must be implemented by specializations.\n     *\n     * @return {Object} Configuration object with:\n     *   - itemsStateKey: State key for items (default: 'items')\n     *   - itemType: Name of item type (e.g., 'resource', 'checklistitem')\n     *   - itemModalForm: Full class name for item modal form\n     *   - templates: Object with template names\n     */\n    getConfig() {\n        throw new Error('getConfig() must be implemented by specialization');\n    }\n\n    /**\n     * Initialize state ready.\n     */\n    stateReady() {\n        this._attachEventListeners();\n    }\n\n    /**\n     * Get the selector key for the edit button.\n     *\n     * @param {string} itemId - The item ID\n     * @returns {string} The selector key\n     */\n    _getEditButtonSelector(itemId) {\n        return 'EDIT_ITEM_BTN_' + itemId;\n    }\n\n    /**\n     * Attach event listeners.\n     */\n    _attachEventListeners() {\n        // Edit button\n        const itemId = this.element.dataset.itemid || this.element.dataset.bookitItemId;\n        if (itemId) {\n            const itemEditBtnSelector = this._getEditButtonSelector(itemId);\n            const editBtn = this.getElement(this.selectors[itemEditBtnSelector]);\n            if (editBtn) {\n                this.addEventListener(editBtn, 'click', this._handleEdit.bind(this));\n            }\n        }\n\n        // Allow specializations to add more listeners\n        if (this._attachCustomEventListeners) {\n            this._attachCustomEventListeners();\n        }\n    }\n\n    /**\n     * Handle edit button click.\n     *\n     * @param {Event} event - Click event\n     */\n    async _handleEdit(event) {\n        event.preventDefault();\n\n        const config = this.getConfig();\n        const itemId = event.currentTarget.value || event.currentTarget.dataset.itemid;\n\n        const modalForm = new ModalForm({\n            formClass: config.itemModalForm,\n            args: {\n                id: parseInt(itemId),\n            },\n            modalConfig: {\n                title: await getString(`edit${config.itemType}`, 'mod_bookit'),\n            },\n            returnFocus: event.currentTarget,\n        });\n\n        modalForm.addEventListener(modalForm.events.FORM_SUBMITTED, (e) => {\n            const response = e.detail;\n\n            // Handle processUpdates format (array of updates)\n            if (Array.isArray(response)) {\n                this.reactive.stateManager.processUpdates(response);\n\n                // Check if item was deleted\n                if (response[0]?.action === 'delete') {\n                    this.reactive.dispatch('itemDeleted', {id: parseInt(response[0].fields.id)});\n                    this.remove();\n                    return;\n                }\n            } else if (response.result === 'success') {\n                // Handle direct result format\n                if (response.action === 'delete') {\n                    this.reactive.dispatch('itemsDeleted', {fields: response.data});\n                    this.remove();\n                } else {\n                    this.reactive.dispatch('itemsUpdated', {fields: response.data});\n                }\n            }\n        });\n\n        modalForm.show();\n    }\n\n    /**\n     * Update row with new data.\n     *\n     * Can be overridden by specializations for custom update logic.\n     *\n     * @param {Object} itemData - Updated item data\n     */\n    _updateRow(itemData) {\n        this.itemData = itemData;\n\n        // Update dataset\n        if (this.element) {\n            this.element.dataset.itemName = itemData.name || '';\n            this.element.dataset.itemDescription = itemData.description || '';\n            this.element.dataset.itemSortorder = itemData.sortorder || 0;\n        }\n\n        // Update visible content - specializations should override this\n        // for more specific updates\n        const nameCell = this.element.querySelector('[data-field=\"item-name\"]');\n        if (nameCell) {\n            nameCell.textContent = itemData.name;\n        }\n\n        const descCell = this.element.querySelector('[data-field=\"item-description\"]');\n        if (descCell) {\n            descCell.textContent = itemData.description || '';\n        }\n    }\n\n    /**\n     * Remove element from DOM.\n     */\n    remove() {\n        if (this.element && this.element.parentNode) {\n            this.element.parentNode.removeChild(this.element);\n        }\n    }\n\n    /**\n     * Render item (for dynamic creation).\n     *\n     * Can be overridden by specializations.\n     */\n    async _render() {\n        const config = this.getConfig();\n        const template = config.templates?.itemRow || 'mod_bookit/checklist_item_row';\n\n        const html = await Templates.render(template, this.itemData);\n        const tempDiv = document.createElement('div');\n        tempDiv.innerHTML = html.trim();\n        const itemElement = tempDiv.firstElementChild;\n\n        if (this.element.tagName === 'TBODY') {\n            // Append to category tbody\n            this.element.appendChild(itemElement);\n        } else {\n            // Replace element\n            this.element.parentNode.replaceChild(itemElement, this.element);\n        }\n\n        this.element = itemElement;\n        this._attachEventListeners();\n    }\n}\n"],"names":["BaseChecklistItem","BaseComponent","create","descriptor","itemId","element","dataset","itemid","bookitItemId","itemEditBtnSelector","this","_getEditButtonSelector","selectors","itemData","getWatchers","_getCustomWatchers","getConfig","Error","stateReady","_attachEventListeners","editBtn","getElement","addEventListener","_handleEdit","bind","_attachCustomEventListeners","event","preventDefault","config","currentTarget","value","modalForm","ModalForm","formClass","itemModalForm","args","id","parseInt","modalConfig","title","itemType","returnFocus","events","FORM_SUBMITTED","e","response","detail","Array","isArray","reactive","stateManager","processUpdates","action","dispatch","fields","remove","result","data","show","_updateRow","itemName","name","itemDescription","description","itemSortorder","sortorder","nameCell","querySelector","textContent","descCell","parentNode","removeChild","template","templates","itemRow","html","Templates","render","tempDiv","document","createElement","innerHTML","trim","itemElement","firstElementChild","tagName","appendChild","replaceChild"],"mappings":";;;;;;;;;;;;;uLA4CqBA,0BAA0BC,wBAM3CC,OAAOC,kBACGC,OAASD,WAAWE,QAAQC,QAAQC,QAAUJ,WAAWE,QAAQC,QAAQE,gBAC3EJ,OAAQ,OACFK,oBAAsBC,KAAKC,uBAAuBP,aACnDQ,UAAUH,0CAAqCL,aAInDS,SAAWV,WAAWU,SAQ/BC,oBAEW,IADgBJ,KAAKK,mBAAqBL,KAAKK,qBAAuB,IAejFC,kBACU,IAAIC,MAAM,qDAMpBC,kBACSC,wBASTR,uBAAuBP,cACZ,iBAAmBA,OAM9Be,8BAEUf,OAASM,KAAKL,QAAQC,QAAQC,QAAUG,KAAKL,QAAQC,QAAQE,gBAC/DJ,OAAQ,OACFK,oBAAsBC,KAAKC,uBAAuBP,QAClDgB,QAAUV,KAAKW,WAAWX,KAAKE,UAAUH,sBAC3CW,cACKE,iBAAiBF,QAAS,QAASV,KAAKa,YAAYC,KAAKd,OAKlEA,KAAKe,kCACAA,gDASKC,OACdA,MAAMC,uBAEAC,OAASlB,KAAKM,YACdZ,OAASsB,MAAMG,cAAcC,OAASJ,MAAMG,cAAcvB,QAAQC,OAElEwB,UAAY,IAAIC,mBAAU,CAC5BC,UAAWL,OAAOM,cAClBC,KAAM,CACFC,GAAIC,SAASjC,SAEjBkC,YAAa,CACTC,YAAa,iCAAiBX,OAAOY,UAAY,eAErDC,YAAaf,MAAMG,gBAGvBE,UAAUT,iBAAiBS,UAAUW,OAAOC,gBAAiBC,UACnDC,SAAWD,EAAEE,yBAGfC,MAAMC,QAAQH,mBACTI,SAASC,aAAaC,eAAeN,UAGd,+BAAxBA,SAAS,2CAAIO,oBACRH,SAASI,SAAS,cAAe,CAACjB,GAAIC,SAASQ,SAAS,GAAGS,OAAOlB,gBAClEmB,aAGkB,YAApBV,SAASW,SAEQ,WAApBX,SAASO,aACJH,SAASI,SAAS,eAAgB,CAACC,OAAQT,SAASY,YACpDF,eAEAN,SAASI,SAAS,eAAgB,CAACC,OAAQT,SAASY,WAKrE1B,UAAU2B,OAUdC,WAAW9C,eACFA,SAAWA,SAGZH,KAAKL,eACAA,QAAQC,QAAQsD,SAAW/C,SAASgD,MAAQ,QAC5CxD,QAAQC,QAAQwD,gBAAkBjD,SAASkD,aAAe,QAC1D1D,QAAQC,QAAQ0D,cAAgBnD,SAASoD,WAAa,SAKzDC,SAAWxD,KAAKL,QAAQ8D,cAAc,4BACxCD,WACAA,SAASE,YAAcvD,SAASgD,YAG9BQ,SAAW3D,KAAKL,QAAQ8D,cAAc,mCACxCE,WACAA,SAASD,YAAcvD,SAASkD,aAAe,IAOvDR,SACQ7C,KAAKL,SAAWK,KAAKL,QAAQiE,iBACxBjE,QAAQiE,WAAWC,YAAY7D,KAAKL,qDAWvCmE,oCADS9D,KAAKM,YACIyD,gEAAWC,UAAW,gCAExCC,WAAaC,mBAAUC,OAAOL,SAAU9D,KAAKG,UAC7CiE,QAAUC,SAASC,cAAc,OACvCF,QAAQG,UAAYN,KAAKO,aACnBC,YAAcL,QAAQM,kBAEC,UAAzB1E,KAAKL,QAAQgF,aAERhF,QAAQiF,YAAYH,kBAGpB9E,QAAQiE,WAAWiB,aAAaJ,YAAazE,KAAKL,cAGtDA,QAAU8E,iBACVhE"}