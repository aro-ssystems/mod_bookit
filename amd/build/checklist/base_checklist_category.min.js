define("mod_bookit/checklist/base_checklist_category",["exports","core/reactive","core_form/modalform","core/str","core/notification"],(function(_exports,_reactive,_modalform,_str,_notification){function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}
/**
   * Base checklist category component.
   *
   * Abstract base class for category components providing common functionality:
   * - Item management and rendering
   * - Modal form handling
   * - Event listeners for add/edit/delete actions
   * - Config-driven specialization
   *
   * @module mod_bookit/checklist/base_checklist_category
   * @copyright   2026 ssystems GmbH <oss@ssystems.de>
   * @author      Andreas Rosenthal
   * @license     http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
   */Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.default=void 0,_modalform=_interopRequireDefault(_modalform),_notification=_interopRequireDefault(_notification);class BaseChecklistCategory extends _reactive.BaseComponent{create(_ref){let{element:element}=_ref;this.parentElement=element,this.categoryElement=null,this.itemComponents=new Map;const categoryId=parseInt(element.dataset.categoryid),categoriesKey=this.getConfig().categoriesStateKey||"categories";this.categoryData=this.reactive.state[categoriesKey].get(categoryId)}getWatchers(){const itemsKey=this.getConfig().itemsStateKey||"items",baseWatchers=[{watch:"".concat(itemsKey,":created"),handler:this._handleItemCreated},{watch:"".concat(itemsKey,".categoryid:updated"),handler:this._handleItemCategoryChanged},{watch:"".concat(itemsKey,":deleted"),handler:this._handleItemDeleted}];return this._getCustomWatchers?[...baseWatchers,...this._getCustomWatchers()]:baseWatchers}getConfig(){throw new Error("getConfig() must be implemented by specialization")}getItemComponent(){throw new Error("getItemComponent() must be implemented by specialization")}stateReady(){this.categoryElement=this.element,this._initItemsFromDOM(),this._attachEventListeners()}_updateCategoryRow(categoryData){if(this.categoryData=categoryData,!this.categoryElement)return;this.categoryElement.dataset.categoryName=categoryData.name,this.categoryElement.dataset.categoryDescription=categoryData.description||"",this.categoryElement.dataset.categorySortorder=categoryData.sortorder||0;const categoryRow=this.categoryElement.querySelector('[data-region="checklist-category-row"]');if(categoryRow){const nameCell=categoryRow.querySelector('[data-field="category-name"]');nameCell&&(nameCell.textContent=categoryData.name)}}_initItemsFromDOM(){if(!this.categoryElement)return;const itemsKey=this.getConfig().itemsStateKey||"items",state=this.reactive.state;this.categoryElement.querySelectorAll('[data-region="checklist-item-row"]').forEach((itemElement=>{const itemId=parseInt(itemElement.dataset.itemid),itemData=state[itemsKey].get(itemId);if(itemData&&itemData.categoryid===this.categoryData.id){const itemComponent=new(this.getItemComponent())({element:itemElement,reactive:this.reactive});this.itemComponents.set(itemData.id,itemComponent)}}))}async _renderItems(){if(!this.categoryElement)return;const itemsKey=this.getConfig().itemsStateKey||"items",categoryRow=this.categoryElement.querySelector('[data-region="checklist-category-row"]');this.categoryElement.innerHTML="",categoryRow&&this.categoryElement.appendChild(categoryRow),this.itemComponents.clear();const state=this.reactive.state,items=Array.from(state[itemsKey].values()).filter((item=>item.categoryid===this.categoryData.id)).sort(((a,b)=>a.sortorder-b.sortorder));for(const itemData of items){const itemComponent=new(this.getItemComponent())({element:this.categoryElement,reactive:this.reactive,itemData:itemData});itemComponent._render&&await itemComponent._render(),this.itemComponents.set(itemData.id,itemComponent)}}async _handleItemCreated(_ref2){let{element:element}=_ref2;element.categoryid===this.categoryData.id&&await this._renderItems()}async _handleItemCategoryChanged(_ref3){let{element:element}=_ref3;this.itemComponents.has(element.id)!==(element.categoryid===this.categoryData.id)&&await this._renderItems()}_handleItemDeleted(_ref4){let{element:element}=_ref4;const component=this.itemComponents.get(element.id);component&&(component.unregister&&component.unregister(),this.itemComponents.delete(element.id));const itemElement=this.categoryElement.querySelector('[data-region="checklist-item-row"][data-itemid="'.concat(element.id,'"]'));itemElement&&itemElement.remove()}_replaceRenderedItem(_ref5){let{element:element}=_ref5;const component=this.itemComponents.get(element.id);component&&component._updateRow&&component._updateRow(element)}_attachEventListeners(){if(!this.categoryElement)return;const addBtn=this.categoryElement.querySelector('[data-action="add-item"]');addBtn&&this.addEventListener(addBtn,"click",this._handleAddItem.bind(this));const editBtn=this.categoryElement.querySelector('[data-action="edit-category"]');editBtn&&this.addEventListener(editBtn,"click",this._handleEdit.bind(this));const deleteBtn=this.categoryElement.querySelector('[data-action="delete-category"]');deleteBtn&&this.addEventListener(deleteBtn,"click",this._handleDelete.bind(this))}async _handleAddItem(event){event.preventDefault();const config=this.getConfig(),modalForm=new _modalform.default({formClass:config.itemModalForm,args:{id:0,categoryid:this.categoryData.id},modalConfig:{title:await(0,_str.get_string)("add".concat(config.itemType),"mod_bookit")},returnFocus:event.currentTarget});modalForm.addEventListener(modalForm.events.FORM_SUBMITTED,(e=>{const response=e.detail;"success"===response.result&&this.reactive.dispatch("itemsUpdated",{fields:response.data})})),modalForm.show()}async _handleEdit(event){event.preventDefault();const config=this.getConfig(),modalForm=new _modalform.default({formClass:config.categoryModalForm,args:{id:this.categoryData.id},modalConfig:{title:await(0,_str.get_string)("editcategory","mod_bookit")},returnFocus:event.currentTarget});modalForm.addEventListener(modalForm.events.FORM_SUBMITTED,(e=>{const response=e.detail;"success"===response.result&&this.reactive.dispatch("categoriesUpdated",{fields:response.data})})),modalForm.show()}async _handleDelete(event){event.preventDefault();await _notification.default.confirm(await(0,_str.get_string)("confirm","core"),await(0,_str.get_string)("deletecategory_confirm","mod_bookit"),await(0,_str.get_string)("delete","core"),await(0,_str.get_string)("cancel","core"))&&this.reactive.dispatch("categoriesDeleted",{fields:{id:this.categoryData.id}})}}return _exports.default=BaseChecklistCategory,_exports.default}));

//# sourceMappingURL=base_checklist_category.min.js.map