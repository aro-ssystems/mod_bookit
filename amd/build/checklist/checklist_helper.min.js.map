{"version":3,"file":"checklist_helper.min.js","sources":["../../src/checklist/checklist_helper.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Checklist helper utilities.\n *\n * Shared utility functions for checklist-style components.\n *\n * @module mod_bookit/checklist/checklist_helper\n * @copyright   2026 ssystems GmbH <oss@ssystems.de>\n * @author      Andreas Rosenthal\n * @license     http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\n/**\n * Parse JSON from dataset attribute safely.\n *\n * @param {string} jsonString - JSON string to parse\n * @param {*} defaultValue - Default value if parsing fails\n * @return {*} Parsed value or default\n */\nexport const parseDatasetJson = (jsonString, defaultValue = []) => {\n    if (!jsonString) {\n        return defaultValue;\n    }\n\n    try {\n        const parsed = JSON.parse(jsonString);\n        if (Array.isArray(defaultValue) && !Array.isArray(parsed)) {\n            return defaultValue;\n        }\n        return parsed;\n    } catch (e) {\n        window.console.warn('Failed to parse JSON:', e, jsonString);\n        return defaultValue;\n    }\n};\n\n/**\n * Extract category data from DOM element.\n *\n * @param {HTMLElement} element - Category element\n * @return {Object} Category data\n */\nexport const extractCategoryData = (element) => {\n    const categoryRow = element.querySelector('[data-region=\"checklist-category-row\"]');\n    return {\n        id: parseInt(element.dataset.categoryid),\n        name: element.dataset.categoryName || categoryRow?.textContent.trim() || '',\n        description: element.dataset.categoryDescription || '',\n        sortorder: parseInt(element.dataset.categorySortorder) || 0,\n    };\n};\n\n/**\n * Extract item data from DOM element.\n *\n * @param {HTMLElement} element - Item element\n * @param {Object} additionalFields - Additional field extractors\n * @return {Object} Item data\n */\nexport const extractItemData = (element, additionalFields = {}) => {\n    const baseData = {\n        id: parseInt(element.dataset.itemid || element.dataset.bookitItemId),\n        name: element.dataset.itemName || '',\n        description: element.dataset.itemDescription || '',\n        categoryid: parseInt(element.dataset.itemCategoryid || element.dataset.categoryid),\n        sortorder: parseInt(element.dataset.itemSortorder) || 0,\n    };\n\n    // Apply additional field extractors\n    Object.keys(additionalFields).forEach(key => {\n        const extractor = additionalFields[key];\n        if (typeof extractor === 'function') {\n            baseData[key] = extractor(element);\n        } else if (typeof extractor === 'string') {\n            // Extractor is a dataset key\n            baseData[key] = element.dataset[extractor];\n        }\n    });\n\n    return baseData;\n};\n\n/**\n * Initialize categories and items from DOM.\n *\n * @param {HTMLElement} containerElement - Container element\n * @param {Object} config - Configuration object\n * @param {string} config.categoryRegion - Category region selector\n * @param {string} config.itemRegion - Item region selector\n * @param {Object} config.itemFields - Additional item field extractors\n * @return {Object} Object with categories and items arrays\n */\nexport const initializeFromDOM = (containerElement, config) => {\n    const categoriesArray = [];\n    const itemsArray = [];\n\n    const categoryElements = containerElement.querySelectorAll(\n        `[data-region=\"${config.categoryRegion || 'checklist-category'}\"]`\n    );\n\n    categoryElements.forEach(categoryEl => {\n        // Extract category data\n        const categoryData = extractCategoryData(categoryEl);\n        categoriesArray.push(categoryData);\n\n        // Extract items for this category\n        const itemElements = categoryEl.querySelectorAll(\n            `[data-region=\"${config.itemRegion || 'checklist-item-row'}\"]`\n        );\n\n        itemElements.forEach(itemEl => {\n            const itemData = extractItemData(itemEl, config.itemFields || {});\n            itemsArray.push(itemData);\n        });\n    });\n\n    return {\n        categories: categoriesArray,\n        items: itemsArray,\n    };\n};\n\n/**\n * Debounce function execution.\n *\n * @param {Function} func - Function to debounce\n * @param {number} wait - Wait time in milliseconds\n * @return {Function} Debounced function\n */\nexport const debounce = (func, wait) => {\n    let timeout;\n    return function executedFunction(...args) {\n        const later = () => {\n            clearTimeout(timeout);\n            func(...args);\n        };\n        clearTimeout(timeout);\n        timeout = setTimeout(later, wait);\n    };\n};\n\n/**\n * Get nested property safely.\n *\n * @param {Object} obj - Object to get property from\n * @param {string} path - Property path (e.g., 'a.b.c')\n * @param {*} defaultValue - Default value if property not found\n * @return {*} Property value or default\n */\nexport const getNestedProperty = (obj, path, defaultValue = undefined) => {\n    const keys = path.split('.');\n    let result = obj;\n\n    for (const key of keys) {\n        if (result === null || result === undefined) {\n            return defaultValue;\n        }\n        result = result[key];\n    }\n\n    return result !== undefined ? result : defaultValue;\n};\n\n/**\n * Format date for display.\n *\n * @param {number} timestamp - Unix timestamp\n * @param {string} locale - Locale string\n * @return {string} Formatted date\n */\nexport const formatDate = (timestamp, locale = 'en-US') => {\n    if (!timestamp) {\n        return '';\n    }\n\n    const date = new Date(timestamp * 1000);\n    return date.toLocaleDateString(locale);\n};\n\n/**\n * Format datetime for display.\n *\n * @param {number} timestamp - Unix timestamp\n * @param {string} locale - Locale string\n * @return {string} Formatted datetime\n */\nexport const formatDateTime = (timestamp, locale = 'en-US') => {\n    if (!timestamp) {\n        return '';\n    }\n\n    const date = new Date(timestamp * 1000);\n    return date.toLocaleString(locale);\n};\n\n/**\n * Sort array of objects by sortorder field.\n *\n * @param {Array} array - Array to sort\n * @return {Array} Sorted array\n */\nexport const sortBySortorder = (array) => {\n    return array.sort((a, b) => {\n        const aOrder = a.sortorder || 0;\n        const bOrder = b.sortorder || 0;\n        return aOrder - bOrder;\n    });\n};\n\n/**\n * Filter items by category ID.\n *\n * @param {Array} items - Items array\n * @param {number} categoryId - Category ID\n * @return {Array} Filtered items\n */\nexport const filterItemsByCategory = (items, categoryId) => {\n    return items.filter(item => item.categoryid === categoryId);\n};\n\n/**\n * Group items by category ID.\n *\n * @param {Array} items - Items array\n * @return {Map} Map of categoryId -> items array\n */\nexport const groupItemsByCategory = (items) => {\n    const groups = new Map();\n\n    items.forEach(item => {\n        if (!groups.has(item.categoryid)) {\n            groups.set(item.categoryid, []);\n        }\n        groups.get(item.categoryid).push(item);\n    });\n\n    return groups;\n};\n"],"names":["jsonString","defaultValue","parsed","JSON","parse","Array","isArray","e","window","console","warn","extractCategoryData","element","categoryRow","querySelector","id","parseInt","dataset","categoryid","name","categoryName","textContent","trim","description","categoryDescription","sortorder","categorySortorder","extractItemData","additionalFields","baseData","itemid","bookitItemId","itemName","itemDescription","itemCategoryid","itemSortorder","Object","keys","forEach","key","extractor","containerElement","config","categoriesArray","itemsArray","querySelectorAll","categoryRegion","categoryEl","categoryData","push","itemRegion","itemEl","itemData","itemFields","categories","items","func","wait","timeout","args","later","clearTimeout","setTimeout","obj","path","undefined","split","result","timestamp","locale","date","Date","toLocaleDateString","toLocaleString","array","sort","a","b","categoryId","filter","item","groups","Map","has","set","get"],"mappings":"kcAiCgC,SAACA,gBAAYC,oEAAe,OACnDD,kBACMC,uBAIDC,OAASC,KAAKC,MAAMJ,mBACtBK,MAAMC,QAAQL,gBAAkBI,MAAMC,QAAQJ,QACvCD,aAEJC,OACT,MAAOK,UACLC,OAAOC,QAAQC,KAAK,wBAAyBH,EAAGP,YACzCC,qBAUFU,oBAAuBC,gBAC1BC,YAAcD,QAAQE,cAAc,gDACnC,CACHC,GAAIC,SAASJ,QAAQK,QAAQC,YAC7BC,KAAMP,QAAQK,QAAQG,eAAgBP,MAAAA,mBAAAA,YAAaQ,YAAYC,SAAU,GACzEC,YAAaX,QAAQK,QAAQO,qBAAuB,GACpDC,UAAWT,SAASJ,QAAQK,QAAQS,oBAAsB,2DAWrDC,gBAAkB,SAACf,aAASgB,wEAAmB,SAClDC,SAAW,CACbd,GAAIC,SAASJ,QAAQK,QAAQa,QAAUlB,QAAQK,QAAQc,cACvDZ,KAAMP,QAAQK,QAAQe,UAAY,GAClCT,YAAaX,QAAQK,QAAQgB,iBAAmB,GAChDf,WAAYF,SAASJ,QAAQK,QAAQiB,gBAAkBtB,QAAQK,QAAQC,YACvEO,UAAWT,SAASJ,QAAQK,QAAQkB,gBAAkB,UAI1DC,OAAOC,KAAKT,kBAAkBU,SAAQC,YAC5BC,UAAYZ,iBAAiBW,KACV,mBAAdC,UACPX,SAASU,KAAOC,UAAU5B,SACE,iBAAd4B,YAEdX,SAASU,KAAO3B,QAAQK,QAAQuB,eAIjCX,8EAasB,CAACY,iBAAkBC,gBAC1CC,gBAAkB,GAClBC,WAAa,UAEMH,iBAAiBI,yCACrBH,OAAOI,gBAAkB,4BAG7BR,SAAQS,mBAEfC,aAAerC,oBAAoBoC,YACzCJ,gBAAgBM,KAAKD,cAGAD,WAAWF,yCACXH,OAAOQ,YAAc,4BAG7BZ,SAAQa,eACXC,SAAWzB,gBAAgBwB,OAAQT,OAAOW,YAAc,IAC9DT,WAAWK,KAAKG,gBAIjB,CACHE,WAAYX,gBACZY,MAAOX,+BAWS,CAACY,KAAMC,YACvBC,eACG,yCAA6BC,6CAAAA,iCAC1BC,MAAQ,KACVC,aAAaH,SACbF,QAAQG,OAEZE,aAAaH,SACbA,QAAUI,WAAWF,MAAOH,mCAYH,SAACM,IAAKC,UAAM/D,yEAAegE,QAClD5B,KAAO2B,KAAKE,MAAM,SACpBC,OAASJ,QAER,MAAMxB,OAAOF,KAAM,IAChB8B,MAAAA,cACOlE,aAEXkE,OAASA,OAAO5B,iBAGF0B,IAAXE,OAAuBA,OAASlE,kCAUjB,SAACmE,eAAWC,8DAAS,YACtCD,gBACM,SAGLE,KAAO,IAAIC,KAAiB,IAAZH,kBACfE,KAAKE,mBAAmBH,iCAUL,SAACD,eAAWC,8DAAS,YAC1CD,gBACM,SAGLE,KAAO,IAAIC,KAAiB,IAAZH,kBACfE,KAAKG,eAAeJ,kCASCK,OACrBA,MAAMC,MAAK,CAACC,EAAGC,KACHD,EAAEnD,WAAa,IACfoD,EAAEpD,WAAa,oCAYD,CAAC8B,MAAOuB,aAClCvB,MAAMwB,QAAOC,MAAQA,KAAK9D,aAAe4D,2CASfvB,cAC3B0B,OAAS,IAAIC,WAEnB3B,MAAMjB,SAAQ0C,OACLC,OAAOE,IAAIH,KAAK9D,aACjB+D,OAAOG,IAAIJ,KAAK9D,WAAY,IAEhC+D,OAAOI,IAAIL,KAAK9D,YAAY+B,KAAK+B,SAG9BC"}