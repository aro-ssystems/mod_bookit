{"version":3,"file":"resource_filter.min.js","sources":["../src/resource_filter.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Resource filter component for multi-select button groups.\n *\n * @module mod_bookit/resource_filter\n * @copyright   2026 ssystems GmbH <oss@ssystems.de>\n * @author      Andreas Rosenthal\n * @license     http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\nexport default class ResourceFilter {\n    /**\n     * Constructor\n     *\n     * @param {string} selector - Selector for the filter container\n     */\n    constructor(selector) {\n        this.container = document.querySelector(selector);\n        if (!this.container) {\n            return;\n        }\n\n        this.selectedRooms = new Set();\n        this.initEventListeners();\n    }\n\n    /**\n     * Initialize event listeners for filter buttons\n     */\n    initEventListeners() {\n        const filterGroup = this.container.querySelector('[data-filter=\"room\"]');\n        if (!filterGroup) {\n            return;\n        }\n\n        filterGroup.addEventListener('click', (e) => {\n            if (!e.target.matches('button') && !e.target.closest('button')) {\n                return;\n            }\n\n            const button = e.target.closest('button');\n            this.toggleButton(button);\n            this.applyFilter();\n        });\n    }\n\n    /**\n     * Toggle button state\n     *\n     * @param {HTMLElement} button - Button element to toggle\n     */\n    toggleButton(button) {\n        const value = button.dataset.value;\n        const isPressed = button.getAttribute('aria-pressed') === 'true';\n        const icon = button.querySelector('.filter-icon');\n\n        if (isPressed) {\n            // Deselect: Show plus icon, unselected color\n            button.style.backgroundColor = button.dataset.colorUnselected;\n            button.setAttribute('aria-pressed', 'false');\n            if (icon) {\n                icon.textContent = '+';\n            }\n            this.selectedRooms.delete(value);\n        } else {\n            // Select: Show checkmark icon, selected color\n            button.style.backgroundColor = button.dataset.colorSelected;\n            button.setAttribute('aria-pressed', 'true');\n            if (icon) {\n                icon.textContent = 'âœ“';\n            }\n            this.selectedRooms.add(value);\n        }\n    }\n\n    /**\n     * Apply the current filter to the resource table\n     */\n    applyFilter() {\n        const allCategories = document.querySelectorAll('[data-region=\"resource-category\"]');\n\n        if (this.selectedRooms.size === 0) {\n            allCategories.forEach(category => {\n                category.style.display = '';\n            });\n            return;\n        }\n\n        allCategories.forEach(category => {\n            const resourceRows = category.querySelectorAll('[data-region=\"resource-row\"]');\n\n            let hasVisibleResources = false;\n\n            resourceRows.forEach(row => {\n                const resourceRooms = this.getResourceRooms(row);\n\n                if (this.hasMatchingRoom(resourceRooms)) {\n                    row.style.display = '';\n                    hasVisibleResources = true;\n                } else {\n                    row.style.display = 'none';\n                }\n            });\n\n            if (hasVisibleResources || resourceRows.length === 0) {\n                category.style.display = '';\n            } else {\n                category.style.display = 'none';\n            }\n        });\n    }\n\n    /**\n     * Get room IDs for a resource row\n     *\n     * @param {HTMLElement} row - Resource row element\n     * @return {Array} Array of room IDs\n     */\n    getResourceRooms(row) {\n        const roomsData = row.dataset.rooms;\n        if (!roomsData) {\n            return [];\n        }\n\n        try {\n            return JSON.parse(roomsData);\n        } catch (e) {\n            return [];\n        }\n    }\n\n    /**\n     * Check if resource has any matching room\n     *\n     * @param {Array} resourceRooms - Array of room IDs\n     * @return {boolean} True if any room matches\n     */\n    hasMatchingRoom(resourceRooms) {\n        if (resourceRooms.length === 0) {\n            return true;\n        }\n\n        return resourceRooms.some(roomId =>\n            this.selectedRooms.has(String(roomId))\n        );\n    }\n}\n\n/**\n * Initialize the resource filter\n *\n * @param {string} selector - Selector for the filter container\n * @return {ResourceFilter} Filter instance\n */\nexport const init = (selector) => {\n    return new ResourceFilter(selector);\n};\n"],"names":["ResourceFilter","constructor","selector","container","document","querySelector","this","selectedRooms","Set","initEventListeners","filterGroup","addEventListener","e","target","matches","closest","button","toggleButton","applyFilter","value","dataset","isPressed","getAttribute","icon","style","backgroundColor","colorUnselected","setAttribute","textContent","delete","colorSelected","add","allCategories","querySelectorAll","size","forEach","category","resourceRows","hasVisibleResources","row","resourceRooms","getResourceRooms","hasMatchingRoom","display","length","roomsData","rooms","JSON","parse","some","roomId","has","String"],"mappings":";;;;;;;;;MAwBqBA,eAMjBC,YAAYC,eACHC,UAAYC,SAASC,cAAcH,UACnCI,KAAKH,iBAILI,cAAgB,IAAIC,SACpBC,sBAMTA,2BACUC,YAAcJ,KAAKH,UAAUE,cAAc,wBAC5CK,aAILA,YAAYC,iBAAiB,SAAUC,QAC9BA,EAAEC,OAAOC,QAAQ,YAAcF,EAAEC,OAAOE,QAAQ,uBAI/CC,OAASJ,EAAEC,OAAOE,QAAQ,eAC3BE,aAAaD,aACbE,iBASbD,aAAaD,cACHG,MAAQH,OAAOI,QAAQD,MACvBE,UAAoD,SAAxCL,OAAOM,aAAa,gBAChCC,KAAOP,OAAOX,cAAc,gBAE9BgB,WAEAL,OAAOQ,MAAMC,gBAAkBT,OAAOI,QAAQM,gBAC9CV,OAAOW,aAAa,eAAgB,SAChCJ,OACAA,KAAKK,YAAc,UAElBrB,cAAcsB,OAAOV,SAG1BH,OAAOQ,MAAMC,gBAAkBT,OAAOI,QAAQU,cAC9Cd,OAAOW,aAAa,eAAgB,QAChCJ,OACAA,KAAKK,YAAc,UAElBrB,cAAcwB,IAAIZ,QAO/BD,oBACUc,cAAgB5B,SAAS6B,iBAAiB,qCAEhB,IAA5B3B,KAAKC,cAAc2B,KAOvBF,cAAcG,SAAQC,iBACZC,aAAeD,SAASH,iBAAiB,oCAE3CK,qBAAsB,EAE1BD,aAAaF,SAAQI,YACXC,cAAgBlC,KAAKmC,iBAAiBF,KAExCjC,KAAKoC,gBAAgBF,gBACrBD,IAAIf,MAAMmB,QAAU,GACpBL,qBAAsB,GAEtBC,IAAIf,MAAMmB,QAAU,UAIxBL,qBAA+C,IAAxBD,aAAaO,OACpCR,SAASZ,MAAMmB,QAAU,GAEzBP,SAASZ,MAAMmB,QAAU,UAzB7BX,cAAcG,SAAQC,WAClBA,SAASZ,MAAMmB,QAAU,MAmCrCF,iBAAiBF,WACPM,UAAYN,IAAInB,QAAQ0B,UACzBD,gBACM,cAIAE,KAAKC,MAAMH,WACpB,MAAOjC,SACE,IAUf8B,gBAAgBF,sBACiB,IAAzBA,cAAcI,QAIXJ,cAAcS,MAAKC,QACtB5C,KAAKC,cAAc4C,IAAIC,OAAOF,iEAWrBhD,UACV,IAAIF,eAAeE"}