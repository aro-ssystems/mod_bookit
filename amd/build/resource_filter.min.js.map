{"version":3,"file":"resource_filter.min.js","sources":["../src/resource_filter.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Resource filter component for multi-select button groups.\n *\n * @module mod_bookit/resource_filter\n * @copyright   2026 ssystems GmbH <oss@ssystems.de>\n * @author      Andreas Rosenthal\n * @license     http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\ndefine([], function() {\n\n    class ResourceFilter {\n        /**\n         * Constructor\n         *\n         * @param {string} selector - Selector for the filter container\n         */\n        constructor(selector) {\n            this.container = document.querySelector(selector);\n            if (!this.container) {\n                return;\n            }\n\n            this.selectedRooms = new Set();\n            this.initEventListeners();\n        }\n\n    /**\n     * Initialize event listeners for filter buttons\n     */\n    initEventListeners() {\n        const selectedRow = this.container.querySelector('[data-row=\"selected\"]');\n        const unselectedRow = this.container.querySelector('[data-row=\"unselected\"]');\n\n        if (!selectedRow || !unselectedRow) {\n            return;\n        }\n\n        // Event delegation on both rows\n        [selectedRow, unselectedRow].forEach(row => {\n            row.addEventListener('click', (e) => {\n                if (!e.target.matches('button') && !e.target.closest('button')) {\n                    return;\n                }\n\n                const button = e.target.closest('button');\n                this.toggleButton(button, selectedRow, unselectedRow);\n                this.applyFilter();\n            });\n        });\n    }\n\n    /**\n     * Toggle button state and move between rows\n     *\n     * @param {HTMLElement} button - Button element to toggle\n     * @param {HTMLElement} selectedRow - Selected row container\n     * @param {HTMLElement} unselectedRow - Unselected row container\n     */\n    toggleButton(button, selectedRow, unselectedRow) {\n        const value = button.dataset.value;\n        const isPressed = button.getAttribute('aria-pressed') === 'true';\n        const icon = button.querySelector('.filter-icon');\n        const filterSection = button.closest('.filter-section');\n        const hiddenSelect = filterSection ? filterSection.querySelector('select[multiple]') : null;\n\n        if (isPressed) {\n            // Deselect: Move to unselected row, show plus, unselected color\n            button.style.backgroundColor = button.dataset.colorUnselected;\n            button.setAttribute('aria-pressed', 'false');\n            if (icon) {\n                icon.textContent = '+';\n            }\n            this.selectedRooms.delete(value);\n            unselectedRow.appendChild(button);\n\n            // Update hidden select\n            if (hiddenSelect) {\n                const option = hiddenSelect.querySelector(`option[value=\"${value}\"]`);\n                if (option) {\n                    option.selected = false;\n                }\n            }\n        } else {\n            // Select: Move to selected row, show checkmark, selected color\n            button.style.backgroundColor = button.dataset.colorSelected;\n            button.setAttribute('aria-pressed', 'true');\n            if (icon) {\n                icon.textContent = 'âœ“';\n            }\n            this.selectedRooms.add(value);\n            selectedRow.appendChild(button);\n\n            // Update hidden select\n            if (hiddenSelect) {\n                const option = hiddenSelect.querySelector(`option[value=\"${value}\"]`);\n                if (option) {\n                    option.selected = true;\n                }\n            }\n        }\n    }\n\n    /**\n     * Apply the current filter to the resource table\n     */\n    applyFilter() {\n        const allCategories = document.querySelectorAll('[data-region=\"resource-category\"]');\n\n        if (this.selectedRooms.size === 0) {\n            allCategories.forEach(category => {\n                category.style.display = '';\n            });\n            return;\n        }\n\n        allCategories.forEach(category => {\n            const resourceRows = category.querySelectorAll('[data-region=\"resource-row\"]');\n\n            let hasVisibleResources = false;\n\n            resourceRows.forEach(row => {\n                const resourceRooms = this.getResourceRooms(row);\n\n                if (this.hasMatchingRoom(resourceRooms)) {\n                    row.style.display = '';\n                    hasVisibleResources = true;\n                } else {\n                    row.style.display = 'none';\n                }\n            });\n\n            if (hasVisibleResources || resourceRows.length === 0) {\n                category.style.display = '';\n            } else {\n                category.style.display = 'none';\n            }\n        });\n    }\n\n    /**\n     * Get room IDs for a resource row\n     *\n     * @param {HTMLElement} row - Resource row element\n     * @return {Array} Array of room IDs\n     */\n    getResourceRooms(row) {\n        const roomsData = row.dataset.rooms;\n        if (!roomsData) {\n            return [];\n        }\n\n        try {\n            return JSON.parse(roomsData);\n        } catch (e) {\n            return [];\n        }\n    }\n\n    /**\n     * Check if resource has any matching room\n     *\n     * @param {Array} resourceRooms - Array of room IDs\n     * @return {boolean} True if any room matches\n     */\n    hasMatchingRoom(resourceRooms) {\n        if (resourceRooms.length === 0) {\n            return true;\n        }\n\n        return resourceRooms.some(roomId =>\n            this.selectedRooms.has(String(roomId))\n        );\n        }\n    }\n\n    /**\n     * Initialize the resource filter\n     *\n     * @param {string} selector - Selector for the filter container\n     * @return {ResourceFilter} Filter instance\n     */\n    return {\n        init: function(selector) {\n            return new ResourceFilter(selector);\n        }\n    };\n});\n"],"names":["define","ResourceFilter","constructor","selector","container","document","querySelector","this","selectedRooms","Set","initEventListeners","selectedRow","unselectedRow","forEach","row","addEventListener","e","target","matches","closest","button","toggleButton","applyFilter","value","dataset","isPressed","getAttribute","icon","filterSection","hiddenSelect","style","backgroundColor","colorUnselected","setAttribute","textContent","delete","appendChild","option","selected","colorSelected","add","allCategories","querySelectorAll","size","category","resourceRows","hasVisibleResources","resourceRooms","getResourceRooms","hasMatchingRoom","display","length","roomsData","rooms","JSON","parse","some","roomId","has","String","init"],"mappings":";;;;;;;;AAwBAA,oCAAO,IAAI,iBAEDC,eAMFC,YAAYC,eACHC,UAAYC,SAASC,cAAcH,UACnCI,KAAKH,iBAILI,cAAgB,IAAIC,SACpBC,sBAMbA,2BACUC,YAAcJ,KAAKH,UAAUE,cAAc,yBAC3CM,cAAgBL,KAAKH,UAAUE,cAAc,2BAE9CK,aAAgBC,gBAKpBD,YAAaC,eAAeC,SAAQC,MACjCA,IAAIC,iBAAiB,SAAUC,QACtBA,EAAEC,OAAOC,QAAQ,YAAcF,EAAEC,OAAOE,QAAQ,uBAI/CC,OAASJ,EAAEC,OAAOE,QAAQ,eAC3BE,aAAaD,OAAQT,YAAaC,oBAClCU,oBAYjBD,aAAaD,OAAQT,YAAaC,qBACxBW,MAAQH,OAAOI,QAAQD,MACvBE,UAAoD,SAAxCL,OAAOM,aAAa,gBAChCC,KAAOP,OAAOd,cAAc,gBAC5BsB,cAAgBR,OAAOD,QAAQ,mBAC/BU,aAAeD,cAAgBA,cAActB,cAAc,oBAAsB,QAEnFmB,cAEAL,OAAOU,MAAMC,gBAAkBX,OAAOI,QAAQQ,gBAC9CZ,OAAOa,aAAa,eAAgB,SAChCN,OACAA,KAAKO,YAAc,UAElB1B,cAAc2B,OAAOZ,OAC1BX,cAAcwB,YAAYhB,QAGtBS,aAAc,OACRQ,OAASR,aAAavB,sCAA+BiB,aACvDc,SACAA,OAAOC,UAAW,YAK1BlB,OAAOU,MAAMC,gBAAkBX,OAAOI,QAAQe,cAC9CnB,OAAOa,aAAa,eAAgB,QAChCN,OACAA,KAAKO,YAAc,UAElB1B,cAAcgC,IAAIjB,OACvBZ,YAAYyB,YAAYhB,QAGpBS,aAAc,OACRQ,OAASR,aAAavB,sCAA+BiB,aACvDc,SACAA,OAAOC,UAAW,IASlChB,oBACUmB,cAAgBpC,SAASqC,iBAAiB,qCAEhB,IAA5BnC,KAAKC,cAAcmC,KAOvBF,cAAc5B,SAAQ+B,iBACZC,aAAeD,SAASF,iBAAiB,oCAE3CI,qBAAsB,EAE1BD,aAAahC,SAAQC,YACXiC,cAAgBxC,KAAKyC,iBAAiBlC,KAExCP,KAAK0C,gBAAgBF,gBACrBjC,IAAIgB,MAAMoB,QAAU,GACpBJ,qBAAsB,GAEtBhC,IAAIgB,MAAMoB,QAAU,UAIxBJ,qBAA+C,IAAxBD,aAAaM,OACpCP,SAASd,MAAMoB,QAAU,GAEzBN,SAASd,MAAMoB,QAAU,UAzB7BT,cAAc5B,SAAQ+B,WAClBA,SAASd,MAAMoB,QAAU,MAmCrCF,iBAAiBlC,WACPsC,UAAYtC,IAAIU,QAAQ6B,UACzBD,gBACM,cAIAE,KAAKC,MAAMH,WACpB,MAAOpC,SACE,IAUfiC,gBAAgBF,sBACiB,IAAzBA,cAAcI,QAIXJ,cAAcS,MAAKC,QACtBlD,KAAKC,cAAckD,IAAIC,OAAOF,kBAW/B,CACHG,KAAM,SAASzD,iBACJ,IAAIF,eAAeE"}