define("mod_bookit/master_checklist_item",["exports","core/reactive","mod_bookit/master_checklist_reactive","core_form/modalform","core/templates","core/str","core/ajax"],(function(_exports,_reactive,_master_checklist_reactive,_modalform,_templates,_str,_ajax){function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.default=void 0,_modalform=_interopRequireDefault(_modalform),_templates=_interopRequireDefault(_templates),_ajax=_interopRequireDefault(_ajax);class _default extends _reactive.BaseComponent{create(descriptor){window.console.log("create item component: "+descriptor.element.dataset.bookitChecklistitemTitle);const itemEditBtnSelector="EDIT_CHECKLISTITEM_BTN_"+descriptor.element.dataset.bookitChecklistitemId;this.selectors[itemEditBtnSelector]="#edit-checklistitem-".concat(descriptor.element.dataset.bookitChecklistitemId);const itemTitleSelector="ITEM_TITLE_"+descriptor.element.dataset.bookitChecklistitemId;this.selectors[itemTitleSelector]='td[data-bookit-checklistitem-tabledata-title-id="'.concat(descriptor.element.dataset.bookitChecklistitemId,'"]');const itemRoomSelector="ITEM_ROOM_"+descriptor.element.dataset.bookitChecklistitemId;this.selectors[itemRoomSelector]='td[data-bookit-checklistitem-tabledata-roomid-id="'.concat(descriptor.element.dataset.bookitChecklistitemId,'"]');const itemRoleSelector="ITEM_ROLE_"+descriptor.element.dataset.bookitChecklistitemId;this.selectors[itemRoleSelector]='td[data-bookit-checklistitem-tabledata-roleid-id="'.concat(descriptor.element.dataset.bookitChecklistitemId,'"]')}static init(target,selectors){return new this({element:document.querySelector(target),reactive:_master_checklist_reactive.masterChecklistReactiveInstance,selectors:selectors||_master_checklist_reactive.SELECTORS})}getWatchers(){return[]}stateReady(state){this.dragdrop=new _reactive.DragDrop(this);const itemEditBtnSelector="EDIT_CHECKLISTITEM_BTN_"+this.element.dataset.bookitChecklistitemId;this.addEventListener(this.getElement(this.selectors[itemEditBtnSelector]),"click",(e=>{e.preventDefault(),window.console.log("EDIT CHECKLIST ITEM BUTTON CLICKED",e.currentTarget),this._handleEditChecklistItemButtonClick(e)}))}destroy(){void 0!==this.dragdrop&&this.dragdrop.unregister()}validateDropData(dropdata){return!0}drop(dropdata,event){dropdata.targetId=this.element.dataset.bookitChecklistitemId,dropdata.targetParentId=this.element.dataset.bookitChecklistitemCategoryid,window.console.log("whoops you dropped this on an item",dropdata),this.reactive.dispatch("reOrderCategoryItems",dropdata);const itemObject=this.reactive.state.checklistitems.get(dropdata.id),itemElement=document.getElementById("bookit-master-checklist-item-".concat(itemObject.id));dropdata.parentId!==dropdata.targetParentId&&(itemElement.dataset.bookitChecklistitemCategoryid=dropdata.targetParentId),this.element.parentNode.insertBefore(itemElement,this.element.nextElementSibling)}showDropZone(dropdata,event){const root=document.querySelector("html"),primaryColor=getComputedStyle(root).getPropertyValue("--primary");window.console.log("primary color: ",primaryColor),this.element.style.boxShadow="0px -5px 0px 0px ".concat(primaryColor," inset"),this.element.style.transition="box-shadow 0.1s ease"}hideDropZone(dropdata,event){this.element.style.boxShadow="",this.element.style.backgroundBlendMode="",this.element.style.transition=""}async _handleEditChecklistItemButtonClick(event){window.console.log("handle edit checklist item button click"),window.console.log(event);const modalForm=new _modalform.default({formClass:"mod_bookit\\form\\edit_checklistitem_form",moduleName:"mod_bookit/modal_delete_save_cancel",args:{masterid:1,itemid:event.currentTarget.value,categories:Array.from(this.reactive.state.checklistcategories.values())},modalConfig:{title:await(0,_str.getString)("checklistitem","mod_bookit")}});modalForm.addEventListener(modalForm.events.FORM_SUBMITTED,(response=>{window.console.log("EDIT ITEM FORM SUBMITTED - RESPONSE:"),window.console.log(response),this.reactive.stateManager.processUpdates(response.detail);const parentId=parseInt(this.element.dataset.bookitChecklistitemCategoryid),updatedParentId=parseInt(response.detail[0].fields.categoryid);if(parentId!==updatedParentId){const targetParentCategoryObject=this.reactive.state.checklistcategories.get(response.detail[0].fields.categoryid);window.console.log("TARGET PARENT ITEMS",targetParentCategoryObject.items);const lastItemOfParentCategoryId=[...targetParentCategoryObject.items].pop(),data={id:parseInt(this.element.dataset.bookitChecklistitemId),type:"item",parentId:parentId,targetId:lastItemOfParentCategoryId,targetParentId:updatedParentId};window.console.log("item has changed parent - DISPATCHING REORDER EVENT"),window.console.log("data for reOrderCategoryItems ind item edit btn handler",data),this.reactive.dispatch("reOrderCategoryItems",data),this.element.dataset.bookitChecklistitemCategoryid=data.targetParentId;document.getElementById("bookit-master-checklist-tbody-category-".concat(data.targetParentId)).append(this.element)}})),modalForm.addEventListener(modalForm.events.LOADED,(response=>{window.console.log("FORM LOADED"),window.console.log(response);const deleteButton=modalForm.modal.getRoot().find('button[data-action="delete"]');window.console.log("DELETE BUTTON",deleteButton),deleteButton.on("click",(e=>{window.console.log("DELETE CHECKLIST ITEM BUTTON CLICKED",e.currentTarget),window.console.log("DELETE ITEM "+this.element.dataset.bookitChecklistitemId),modalForm.getFormNode().querySelector('input[name="action"]').value="delete",modalForm.submitFormAjax()}))})),modalForm.show()}}return _exports.default=_default,_exports.default}));

//# sourceMappingURL=master_checklist_item.min.js.map