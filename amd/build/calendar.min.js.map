{"version":3,"file":"calendar.min.js","sources":["../src/calendar.js"],"sourcesContent":["import {getString} from 'core/str';\nimport ModalForm from 'core_form/modalform';\nimport {prefetchStrings} from 'core/prefetch';\n\nconst theGlobalProperty = (globalPropertyName) => {\n    return new Promise((resolve) => {\n       const innerWait = () => {\n           if (!window[globalPropertyName]) {\n               setTimeout(innerWait, 20);\n           }\n           resolve();\n       };\n       innerWait();\n    });\n};\n\n/**\n * Initializes the calendar.\n * @param {int} cmid\n * @param {string} eventsource\n * @param {array} capabilities\n * @param {string} lang\n * @param {array} config\n * @returns {Promise<void>}\n */\nexport async function init(cmid, eventsource, capabilities, lang, config) {\n    await theGlobalProperty('EventCalendar');\n\n    // Set textcolor.\n    let textcolor = '#ffffff';\n    if (Object.hasOwn(config, 'textcolor')) {\n        textcolor = config.textcolor;\n        console.log('textcolor set to '+textcolor);\n    }\n\n    // Define toolbarbuttons.\n    let toolbarbuttons = 'prev,next today';\n    if (capabilities.addevent) {\n        toolbarbuttons = 'prev,next today, addButton';\n        console.log(capabilities);\n    }\n\n    // String variables.\n    prefetchStrings('mod_bookit', ['addbooking']);\n    prefetchStrings('core', ['today', 'month', 'week']);\n    prefetchStrings('calendar', ['day', 'upcomingevents']);\n    const str_request_booking   = await getString('addbooking', 'mod_bookit');\n    const str_today             = await getString('today');\n    const str_month             = await getString('month');\n    const str_week              = await getString('week');\n    const str_day               = await getString('day', 'calendar');\n    const str_list              = await getString('upcomingevents', 'calendar');\n    /*const str_request_booking = 'XXX';\n    const str_today             = 'XXX';\n    const str_month             = 'XXX';\n    const str_week              = 'XXX';\n    const str_day               = 'XXX';\n    const str_list              = 'XXX';*/\n\n    // Define viewtype.\n    let viewType = 'timeGridWeek';\n    if (window.screen.width <= 1000) {\n        viewType = 'listWeek';\n    }\n\n    var calendar;\n\n    calendar = new window.EventCalendar(document.getElementById('ec'), {\n        locale: lang,\n        view: viewType,\n        firstDay: 1,\n        scrollTime: '09:00:00',\n        slotMinTime: '07:00:00',\n        dayMaxEvents: true,\n        nowIndicator: true,\n        selectable: false,\n        eventTextColor: textcolor,\n        eventBackgroundColor: '#035AA3',\n        eventStartEditable: false,\n        eventDurationEditable: false,\n        buttonText: function (text) {\n            text.today = str_today;\n            text.dayGridMonth = str_month;\n            text.timeGridWeek = str_week;\n            text.timeGridDay = str_day;\n            text.listWeek = str_list;\n            return text;\n        },\n        customButtons: {\n            addButton: {\n                text: str_request_booking,\n                click: function() {\n                    const modalForm = new ModalForm({\n                        formClass: \"mod_bookit\\\\form\\\\edit_event_form\",\n                        args: {\n                            cmid: cmid,\n                        },\n                        modalConfig: {title: getString('edit_event', 'mod_bookit')},\n                    });\n                    modalForm.addEventListener(modalForm.events.FORM_SUBMITTED, () => {\n                        calendar.refetchEvents();\n                    });\n                    modalForm.show();\n                }\n            }\n        },\n        dateClick: function(info) {\n            let d = new Date();\n            let dateoff = new Date(d.setMinutes(d.getMinutes() - d.getTimezoneOffset()));\n            let startdate = info.dateStr;\n            if (capabilities.addevent && startdate > dateoff.toISOString()) {\n                const modalForm = new ModalForm({\n                    formClass: \"mod_bookit\\\\form\\\\edit_event_form\",\n                    args: {\n                        cmid: cmid,\n                        startdate: startdate,\n                    },\n                    modalConfig: {title: getString('edit_event', 'mod_bookit')},\n                });\n                modalForm.addEventListener(modalForm.events.FORM_SUBMITTED, () => {\n                    calendar.refetchEvents();\n                });\n                modalForm.show();\n            }\n        },\n        eventClick: function (info) {\n            let id = info.event.id;\n\n            console.log(info);\n            console.log(\"cmid: \"+cmid);\n            console.log(\"id: \"+id);\n            console.log(\"extendedProps reserved: \"+info.event.extendedProps.reserved);\n\n            if (!info.event.extendedProps.reserved) {\n                const modalForm = new ModalForm({\n                    formClass: \"mod_bookit\\\\form\\\\edit_event_form\",\n                    args: {\n                        cmid: cmid,\n                        id: id,\n                    },\n                    modalConfig: {title: getString('edit_event', 'mod_bookit')},\n                });\n                modalForm.addEventListener(modalForm.events.FORM_SUBMITTED, () => {\n                    calendar.refetchEvents();\n                });\n                modalForm.show();\n\n\n\n                if (!capabilities.addevent) {\n                    // @TODO: this is hacky... :-/\n                    setTimeout(disableButtons, 500);\n                }\n            }\n        },\n        headerToolbar: {\n            start: toolbarbuttons,\n            center: 'title',\n            end: 'dayGridMonth,timeGridWeek,timeGridDay,listWeek'\n        },\n        resources: [],\n        eventSources: [\n            {\n                url: eventsource,\n            },\n        ],\n        views: {\n            timeGridWeek: {pointer: true},\n            resourceTimeGridWeek: {pointer: true},\n            resourceTimelineWeek: {\n                pointer: true,\n                slotMinTime: '09:00',\n                slotMaxTime: '21:00',\n                slotWidth: 80,\n                resources: []\n            }\n        },\n    });\n}\n\n/**\n * Disable the save button\n */\nfunction disableButtons() {\n    console.log(\"Disable save button\");\n    document.querySelectorAll('button[data-action=\"save\"]').forEach(el => el.setAttribute('disabled', true));\n}\n"],"names":["cmid","eventsource","capabilities","lang","config","globalPropertyName","Promise","resolve","innerWait","window","setTimeout","textcolor","Object","hasOwn","console","log","toolbarbuttons","addevent","str_request_booking","str_today","str_month","str_week","str_day","str_list","viewType","screen","width","calendar","EventCalendar","document","getElementById","locale","view","firstDay","scrollTime","slotMinTime","dayMaxEvents","nowIndicator","selectable","eventTextColor","eventBackgroundColor","eventStartEditable","eventDurationEditable","buttonText","text","today","dayGridMonth","timeGridWeek","timeGridDay","listWeek","customButtons","addButton","click","modalForm","ModalForm","formClass","args","modalConfig","title","addEventListener","events","FORM_SUBMITTED","refetchEvents","show","dateClick","info","d","Date","dateoff","setMinutes","getMinutes","getTimezoneOffset","startdate","dateStr","toISOString","eventClick","id","event","extendedProps","reserved","disableButtons","headerToolbar","start","center","end","resources","eventSources","url","views","pointer","resourceTimeGridWeek","resourceTimelineWeek","slotMaxTime","slotWidth","querySelectorAll","forEach","el","setAttribute"],"mappings":"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"}