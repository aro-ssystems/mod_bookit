{"version":3,"file":"calendar.min.js","sources":["../src/calendar.js"],"sourcesContent":["import {get_string as getString} from 'core/str';\nimport ModalForm from 'core_form/modalform';\nimport Prefetch from 'core/prefetch';\nimport Log from 'core/log';\nimport {call as fetchMany} from 'core/ajax';\n\n/**\n * Holt die Konfiguration vom Server\n * @returns {Promise<Object>}\n */\nasync function getConfig() {\n    try {\n        const response = await fetchMany([{\n            methodname: 'mod_bookit_get_config',\n            args: {}\n        }])[0];\n        return response;\n    } catch (error) {\n        Log.error('Fehler beim Abrufen der Konfiguration:', error);\n        throw error;\n    }\n}\n\nconst theGlobalProperty = (globalPropertyName) => {\n    return new Promise((resolve) => {\n       const innerWait = () => {\n           if (!window[globalPropertyName]) {\n               setTimeout(innerWait, 20);\n           }\n           resolve();\n       };\n       innerWait();\n    });\n};\n\n/**\n * Initializes the calendar.\n * @param {int} cmid\n * @param {string} moduleinstanceid\n * @param {string} eventsource\n * @param {string} lang\n * @returns {Promise<void>}\n */\nexport async function init(cmid, moduleinstanceid, eventsource, lang) {\n    await theGlobalProperty('EventCalendar');\n\n    // String variables.\n    Prefetch.prefetchString('mod_bookit', ['addbooking']);\n    Prefetch.prefetchString('core', ['today', 'month', 'week']);\n    Prefetch.prefetchString('core_calendar', ['day', 'upcomingevents']);\n    const str_request_booking   = await getString('addbooking', 'mod_bookit');\n    const str_today             = await getString('today');\n    const str_month             = await getString('month');\n    const str_week              = await getString('week');\n    const str_day               = await getString('day', 'core_calendar');\n    const str_list              = await getString('upcomingevents', 'core_calendar');\n\n    let viewType = 'timeGridWeek';\n    if (window.screen.width <= 1000) {\n        viewType = 'listWeek';\n    }\n\n    var calendar;\n    const config = await getConfig();\n\n    calendar = new window.EventCalendar(document.getElementById('ec'), {\n        locale: lang,\n        view: viewType,\n        firstDay: 1,\n        scrollTime: '09:00:00',\n        slotMinTime: `${String(config.min_time_hour).padStart(2, '0')}:${String(config.min_time_minute).padStart(2, '0')}:00`,\n        slotMaxTime: `${String(config.max_time_hour).padStart(2, '0')}:${String(config.max_time_minute).padStart(2, '0')}:00`,\n        defaultTimedEventDuration: `${config.default_duration}:00`,\n        dayMaxEvents: true,\n        nowIndicator: true,\n        selectable: false,\n        eventStartEditable: false,\n        eventDurationEditable: false,\n        buttonText: function (text) {\n            text.today = str_today;\n            text.dayGridMonth = str_month;\n            text.timeGridWeek = str_week;\n            text.timeGridDay = str_day;\n            text.listWeek = str_list;\n            return text;\n        },\n        customButtons: {\n            addButton: {\n                text: str_request_booking,\n                click: function() {\n                    const modalForm = new ModalForm({\n                        formClass: \"mod_bookit\\\\form\\\\edit_event_form\",\n                        args: {\n                            cmid: cmid,\n                            config: config\n                        },\n                        modalConfig: {title: getString('edit_event', 'mod_bookit')},\n                    });\n                    modalForm.addEventListener(modalForm.events.FORM_SUBMITTED, () => {\n                        calendar.refetchEvents();\n                    });\n                    modalForm.show();\n                }\n            }\n        },\n        dateClick: function(info) {\n            Log.debug('Date clicked:', info.date);\n            Log.debug('Date string:', info.dateStr);\n            let startdate = info.dateStr;\n            const modalForm = new ModalForm({\n                formClass: \"mod_bookit\\\\form\\\\edit_event_form\",\n                args: {\n                    cmid: cmid,\n                    startdate: startdate,\n                    config: config\n                },\n                modalConfig: {title: getString('edit_event', 'mod_bookit')},\n            });\n            modalForm.addEventListener(modalForm.events.FORM_SUBMITTED, () => {\n                calendar.refetchEvents();\n            });\n            modalForm.show();\n        },\n        eventClick: function (info) {\n            let id = info.event.id;\n            let title = info.event.title;\n\n            Log.debug('Event clicked:', info);\n            Log.debug('CMID:', cmid);\n            Log.debug('Event ID:', id);\n            Log.debug('Event title:', title);\n\n            if (\"reserved\" != title.toLowerCase()) {\n                const modalForm = new ModalForm({\n                    formClass: \"mod_bookit\\\\form\\\\edit_event_form\",\n                    args: {\n                        cmid: cmid,\n                        id: id,\n                        config: config\n                    },\n                    modalConfig: {title: getString('edit_event', 'mod_bookit')},\n                });\n                modalForm.addEventListener(modalForm.events.FORM_SUBMITTED, () => {\n                    calendar.refetchEvents();\n                });\n                modalForm.show();\n            }\n        },\n        headerToolbar: {\n            start: 'prev,next today, addButton',\n            center: 'title',\n            end: 'dayGridMonth,timeGridWeek,timeGridDay,listWeek'\n        },\n        resources: [],\n        eventSources: [\n            {\n                url: eventsource,\n            },\n        ],\n        views: {\n            timeGridWeek: {pointer: true},\n            resourceTimeGridWeek: {pointer: true},\n            resourceTimelineWeek: {\n                pointer: true,\n                slotMinTime: '09:00',\n                slotMaxTime: '21:00',\n                slotWidth: 80,\n                resources: []\n            }\n        },\n    });\n}\n"],"names":["cmid","moduleinstanceid","eventsource","lang","globalPropertyName","Promise","resolve","innerWait","window","setTimeout","prefetchString","str_request_booking","str_today","str_month","str_week","str_day","str_list","viewType","screen","width","calendar","config","methodname","args","error","getConfig","EventCalendar","document","getElementById","locale","view","firstDay","scrollTime","slotMinTime","String","min_time_hour","padStart","min_time_minute","slotMaxTime","max_time_hour","max_time_minute","defaultTimedEventDuration","default_duration","dayMaxEvents","nowIndicator","selectable","eventStartEditable","eventDurationEditable","buttonText","text","today","dayGridMonth","timeGridWeek","timeGridDay","listWeek","customButtons","addButton","click","modalForm","ModalForm","formClass","modalConfig","title","addEventListener","events","FORM_SUBMITTED","refetchEvents","show","dateClick","info","debug","date","dateStr","startdate","eventClick","id","event","toLowerCase","headerToolbar","start","center","end","resources","eventSources","url","views","pointer","resourceTimeGridWeek","resourceTimelineWeek","slotWidth"],"mappings":"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"}