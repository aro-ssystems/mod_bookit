{"version":3,"file":"calendar.min.js","sources":["../src/calendar.js"],"sourcesContent":["import {get_string as getString} from 'core/str';\nimport ModalForm from 'core_form/modalform';\nimport Prefetch from 'core/prefetch';\n\nconst theGlobalProperty = (globalPropertyName) => {\n    return new Promise((resolve) => {\n       const innerWait = () => {\n           if (!window[globalPropertyName]) {\n               setTimeout(innerWait, 20);\n           }\n           resolve();\n       };\n       innerWait();\n    });\n};\n\n/**\n * Initializes the calendar.\n * @param {int} cmid\n * @param {string} moduleinstanceid\n * @param {string} eventsource\n * @param {string} lang\n * @returns {Promise<void>}\n */\nexport async function init(cmid, moduleinstanceid, eventsource, lang) {\n    Prefetch.prefetchString('mod_bookit', 'addbooking');\n    await theGlobalProperty('EventCalendar');\n    const str_request_booking = await getString('addbooking', 'mod_bookit');\n    const str_today = await getString('today');\n    const str_month = await getString('month');\n    const str_week = await getString('week');\n    const str_day = await getString('day', 'calendar');\n    const str_list = await getString('upcomingevents', 'calendar');\n\n    let viewType = 'timeGridWeek';\n    if (window.screen.width <= 1000) {\n        viewType = 'listWeek';\n    }\n\n    var calendar;\n\n    calendar = new window.EventCalendar(document.getElementById('ec'), {\n        locale: lang,\n        view: viewType,\n        firstDay: 1,\n        buttonText: function (text) {\n            text.today = str_today;\n            text.dayGridMonth = str_month;\n            text.timeGridWeek = str_week;\n            text.timeGridDay = str_day;\n            text.listWeek = str_list;\n            return text;\n        },\n        customButtons: {\n            addButton: {\n                text: str_request_booking,\n                click: function() {\n                    const modalForm = new ModalForm({\n                                    formClass: \"mod_bookit\\\\form\\\\edit_event_form\",\n                                    args: {\n                                        cmid: cmid,\n                                    },\n                                    modalConfig: {title: getString('edit_event', 'mod_bookit')},\n                                });\n                                modalForm.addEventListener(modalForm.events.FORM_SUBMITTED, () => {\n                                    calendar.refetchEvents();\n                                });\n                                modalForm.show();\n                }\n            }\n        },\n        dateClick: function(info) {\n            console.log(info.date);\n            console.log(info.dateStr);\n            let startdate = info.dateStr;\n            const modalForm = new ModalForm({\n                formClass: \"mod_bookit\\\\form\\\\edit_event_form\",\n                args: {\n                    cmid: cmid,\n                    startdate: startdate,\n                },\n                modalConfig: {title: getString('edit_event', 'mod_bookit')},\n            });\n            modalForm.addEventListener(modalForm.events.FORM_SUBMITTED, () => {\n                calendar.refetchEvents();\n            });\n            modalForm.show();\n        },\n        eventClick: function (info) {\n            let id = info.event.id;\n\n            console.log(info);\n            console.log(\"cmid: \"+cmid);\n            console.log(\"id: \"+id);\n\n            const modalForm = new ModalForm({\n                formClass: \"mod_bookit\\\\form\\\\edit_event_form\",\n                args: {\n                    cmid: cmid,\n                    id: id,\n                },\n                modalConfig: {title: getString('edit_event', 'mod_bookit')},\n            });\n            modalForm.addEventListener(modalForm.events.FORM_SUBMITTED, () => {\n                calendar.refetchEvents();\n            });\n            modalForm.show();\n        },\n        headerToolbar: {\n            start: 'prev,next today, addButton',\n            center: 'title',\n            end: 'dayGridMonth,timeGridWeek,timeGridDay,listWeek'\n        },\n        resources: [],\n        eventSources: [\n            {\n                url: eventsource,\n            },\n        ],\n        scrollTime: '09:00:00',\n        slotMinTime: '07:00:00',\n        views: {\n            timeGridWeek: {pointer: true},\n            resourceTimeGridWeek: {pointer: true},\n            resourceTimelineWeek: {\n                pointer: true,\n                slotMinTime: '09:00',\n                slotMaxTime: '21:00',\n                slotWidth: 80,\n                resources: []\n            }\n        },\n        dayMaxEvents: true,\n        nowIndicator: true,\n        selectable: true,\n        eventStartEditable: false,\n        eventDurationEditable: false,\n    });\n}\n"],"names":["cmid","moduleinstanceid","eventsource","lang","prefetchString","globalPropertyName","Promise","resolve","innerWait","window","setTimeout","str_request_booking","str_today","str_month","str_week","str_day","str_list","viewType","screen","width","calendar","EventCalendar","document","getElementById","locale","view","firstDay","buttonText","text","today","dayGridMonth","timeGridWeek","timeGridDay","listWeek","customButtons","addButton","click","modalForm","ModalForm","formClass","args","modalConfig","title","addEventListener","events","FORM_SUBMITTED","refetchEvents","show","dateClick","info","console","log","date","dateStr","startdate","eventClick","id","event","headerToolbar","start","center","end","resources","eventSources","url","scrollTime","slotMinTime","views","pointer","resourceTimeGridWeek","resourceTimelineWeek","slotMaxTime","slotWidth","dayMaxEvents","nowIndicator","selectable","eventStartEditable","eventDurationEditable"],"mappings":"+SAwB2BA,KAAMC,iBAAkBC,YAAaC,wBACnDC,eAAe,aAAc,oBArBfC,mBAsBC,gBArBjB,IAAIC,SAASC,gBACXC,UAAY,KACTC,OAAOJ,qBACRK,WAAWF,UAAW,IAE1BD,WAEJC,gBARoBH,IAAAA,yBAuBjBM,0BAA4B,mBAAU,aAAc,cACpDC,gBAAkB,mBAAU,SAC5BC,gBAAkB,mBAAU,SAC5BC,eAAiB,mBAAU,QAC3BC,cAAgB,mBAAU,MAAO,YACjCC,eAAiB,mBAAU,iBAAkB,gBAE/CC,SAAW,eACXR,OAAOS,OAAOC,OAAS,MACvBF,SAAW,gBAGXG,SAEJA,SAAW,IAAIX,OAAOY,cAAcC,SAASC,eAAe,MAAO,CAC/DC,OAAQrB,KACRsB,KAAMR,SACNS,SAAU,EACVC,WAAY,SAAUC,aAClBA,KAAKC,MAAQjB,UACbgB,KAAKE,aAAejB,UACpBe,KAAKG,aAAejB,SACpBc,KAAKI,YAAcjB,QACnBa,KAAKK,SAAWjB,SACTY,MAEXM,cAAe,CACXC,UAAW,CACPP,KAAMjB,oBACNyB,MAAO,iBACGC,UAAY,IAAIC,mBAAU,CAChBC,UAAW,oCACXC,KAAM,CACFxC,KAAMA,MAEVyC,YAAa,CAACC,OAAO,mBAAU,aAAc,iBAEjDL,UAAUM,iBAAiBN,UAAUO,OAAOC,gBAAgB,KACxDzB,SAAS0B,mBAEbT,UAAUU,UAIlCC,UAAW,SAASC,MAChBC,QAAQC,IAAIF,KAAKG,MACjBF,QAAQC,IAAIF,KAAKI,aACbC,UAAYL,KAAKI,cACfhB,UAAY,IAAIC,mBAAU,CAC5BC,UAAW,oCACXC,KAAM,CACFxC,KAAMA,KACNsD,UAAWA,WAEfb,YAAa,CAACC,OAAO,mBAAU,aAAc,iBAEjDL,UAAUM,iBAAiBN,UAAUO,OAAOC,gBAAgB,KACxDzB,SAAS0B,mBAEbT,UAAUU,QAEdQ,WAAY,SAAUN,UACdO,GAAKP,KAAKQ,MAAMD,GAEpBN,QAAQC,IAAIF,MACZC,QAAQC,IAAI,SAASnD,MACrBkD,QAAQC,IAAI,OAAOK,UAEbnB,UAAY,IAAIC,mBAAU,CAC5BC,UAAW,oCACXC,KAAM,CACFxC,KAAMA,KACNwD,GAAIA,IAERf,YAAa,CAACC,OAAO,mBAAU,aAAc,iBAEjDL,UAAUM,iBAAiBN,UAAUO,OAAOC,gBAAgB,KACxDzB,SAAS0B,mBAEbT,UAAUU,QAEdW,cAAe,CACXC,MAAO,6BACPC,OAAQ,QACRC,IAAK,kDAETC,UAAW,GACXC,aAAc,CACV,CACIC,IAAK9D,cAGb+D,WAAY,WACZC,YAAa,WACbC,MAAO,CACHpC,aAAc,CAACqC,SAAS,GACxBC,qBAAsB,CAACD,SAAS,GAChCE,qBAAsB,CAClBF,SAAS,EACTF,YAAa,QACbK,YAAa,QACbC,UAAW,GACXV,UAAW,KAGnBW,cAAc,EACdC,cAAc,EACdC,YAAY,EACZC,oBAAoB,EACpBC,uBAAuB"}