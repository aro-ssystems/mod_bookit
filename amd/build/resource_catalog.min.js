define("mod_bookit/resource_catalog",["exports","core/reactive","./resource_reactive","./resource_category","core_form/modalform","core/str","core/notification"],(function(_exports,_reactive,_resource_reactive,_resource_category,_modalform,_str,_notification){function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}
/**
   * Resource catalog reactive component.
   *
   * @module mod_bookit/resource_catalog
   * @copyright   2026 ssystems GmbH <oss@ssystems.de>
   * @author      Andreas Rosenthal
   * @license     http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
   */Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.default=void 0,_resource_category=_interopRequireDefault(_resource_category),_modalform=_interopRequireDefault(_modalform),_notification=_interopRequireDefault(_notification);class _default extends _reactive.BaseComponent{static init(target){const element=document.querySelector(target);if(!element)return null;const contextId=parseInt(element.dataset.contextid),categoriesArray=[],itemsArray=[];return element.querySelectorAll('[data-region="resource-category"]').forEach((categoryEl=>{const categoryData={id:parseInt(categoryEl.dataset.categoryid),name:categoryEl.dataset.categoryName,description:categoryEl.dataset.categoryDescription||"",sortorder:parseInt(categoryEl.dataset.categorySortorder)||0};categoriesArray.push(categoryData);categoryEl.querySelectorAll('[data-region="resource-item"]').forEach((itemEl=>{const itemData={id:parseInt(itemEl.dataset.itemid),name:itemEl.dataset.itemName,description:itemEl.dataset.itemDescription||"",categoryid:parseInt(itemEl.dataset.itemCategoryid),amount:parseInt(itemEl.dataset.itemAmount)||0,amountirrelevant:"true"===itemEl.dataset.itemAmountirrelevant,sortorder:parseInt(itemEl.dataset.itemSortorder)||0};itemsArray.push(itemData)}))})),(0,_resource_reactive.initResourceReactive)({categories:categoriesArray,items:itemsArray}),new this({element:element,reactive:_resource_reactive.resourceReactiveInstance,selectors:{contextId:contextId}})}static get componentName(){return"mod_bookit/resource_catalog"}create(){this.selectors.categoriesContainer="#mod-bookit-resource-categories",this.selectors.noCategoriesMsg="#mod-bookit-no-categories",this.selectors.addCategoryBtn="#add-category-btn",this.selectors.viewModeTable="#view-mode-table",this.selectors.viewModeCards="#view-mode-cards",this.selectors.tableView="#mod-bookit-resource-table-view",this.selectors.cardView="#mod-bookit-resource-card-view",this.categoryComponents=new Map,this.currentView="table"}stateReady(state){if(this._initializeExistingComponents(state),this._attachEventListeners(),window.localStorage){const savedView=window.localStorage.getItem("bookit_resources_view_mode");!savedView||"table"!==savedView&&"cards"!==savedView||this._switchView(savedView)}}_initializeExistingComponents(state){Array.from(state.categories.values()).forEach((categoryData=>{const categoryEl=document.getElementById("resource-category-".concat(categoryData.id));if(categoryEl){const categoryComponent=new _resource_category.default({element:categoryEl.parentElement,reactive:this.reactive,categoryData:categoryData,existingElement:categoryEl});this.categoryComponents.set(categoryData.id,categoryComponent)}}))}getWatchers(){return[{watch:"categories:created",handler:this._handleCategoryCreated},{watch:"categories:updated",handler:this._handleCategoryUpdated},{watch:"categories:deleted",handler:this._handleCategoryDeleted}]}_handleCategoryCreated(){const state=this.reactive.state;this._renderCategories(state)}_renderCategories(state){const container=document.querySelector(this.selectors.categoriesContainer);if(!container)return;const categories=Array.from(state.categories.values()).sort(((a,b)=>a.sortorder-b.sortorder));container.innerHTML="",this.categoryComponents.clear(),0!==categories.length?(this._hideNoCategoriesMessage(),categories.forEach((categoryData=>{const categoryComponent=new _resource_category.default({element:container,reactive:this.reactive,categoryData:categoryData});this.categoryComponents.set(categoryData.id,categoryComponent)}))):this._showNoCategoriesMessage()}_handleCategoryUpdated(_ref){let{element:element}=_ref;const component=this.categoryComponents.get(element.id);component&&component.update(element)}_handleCategoryDeleted(_ref2){let{element:element}=_ref2;const component=this.categoryComponents.get(element.id);component&&(component.remove(),this.categoryComponents.delete(element.id));0===this.reactive.state.categories.size&&this._showNoCategoriesMessage()}_attachEventListeners(){const addBtn=document.querySelector(this.selectors.addCategoryBtn);addBtn&&addBtn.addEventListener("click",(e=>{e.preventDefault(),this._handleAddCategory()}));const tableModeBtn=document.querySelector(this.selectors.viewModeTable),cardsModeBtn=document.querySelector(this.selectors.viewModeCards);tableModeBtn&&tableModeBtn.addEventListener("click",(()=>{this._switchView("table")})),cardsModeBtn&&cardsModeBtn.addEventListener("click",(()=>{this._switchView("cards")})),this._attachTableViewEventListeners()}_attachTableViewEventListeners(){const tableView=document.querySelector(this.selectors.tableView);tableView&&tableView.addEventListener("click",(async e=>{const target=e.target.closest("button[data-action]");if(!target)return;const action=target.dataset.action;switch(e.preventDefault(),action){case"edit-category":await this._handleEditCategoryFromTable(target);break;case"delete-category":await this._handleDeleteCategoryFromTable(target);break;case"edit-item":await this._handleEditItemFromTable(target);break;case"delete-item":await this._handleDeleteItemFromTable(target)}}))}async _handleEditCategoryFromTable(button){const categoryId=parseInt(button.dataset.categoryId);if(!this.reactive.state.categories.get(categoryId))return;const modalForm=new _modalform.default({formClass:"mod_bookit\\form\\edit_resource_category_form",args:{id:categoryId},modalConfig:{title:await(0,_str.get_string)("resources:edit_category","mod_bookit")}});modalForm.addEventListener(modalForm.events.FORM_SUBMITTED,(e=>{this.reactive.stateManager.processUpdates(e.detail)})),modalForm.show()}async _handleDeleteCategoryFromTable(button){const categoryId=parseInt(button.dataset.categoryId),category=this.reactive.state.categories.get(categoryId);if(!category)return;const confirmMsg=await(0,_str.get_string)("resources:confirm_delete_category","mod_bookit",category.name);_notification.default.confirm(await(0,_str.get_string)("confirm","core"),confirmMsg,await(0,_str.get_string)("yes","core"),await(0,_str.get_string)("no","core"),(()=>{this.reactive.dispatch("deleteCategory",categoryId)}))}async _handleEditItemFromTable(button){const itemId=parseInt(button.dataset.itemId);if(!this.reactive.state.items.get(itemId))return;const modalForm=new _modalform.default({formClass:"mod_bookit\\form\\edit_resource_form",args:{id:itemId},modalConfig:{title:await(0,_str.get_string)("resources:edit_resource","mod_bookit")}});modalForm.addEventListener(modalForm.events.FORM_SUBMITTED,(e=>{this.reactive.stateManager.processUpdates(e.detail)})),modalForm.show()}async _handleDeleteItemFromTable(button){const itemId=parseInt(button.dataset.itemId),item=this.reactive.state.items.get(itemId);if(!item)return;const confirmMsg=await(0,_str.get_string)("resources:confirm_delete_resource","mod_bookit",item.name);_notification.default.confirm(await(0,_str.get_string)("confirm","core"),confirmMsg,await(0,_str.get_string)("yes","core"),await(0,_str.get_string)("no","core"),(()=>{this.reactive.dispatch("deleteItem",itemId)}))}async _handleAddCategory(){const modalForm=new _modalform.default({formClass:"mod_bookit\\form\\edit_resource_category_form",args:{contextid:this.selectors.contextId},modalConfig:{title:await(0,_str.get_string)("resources:add_category","mod_bookit")}});modalForm.addEventListener(modalForm.events.FORM_SUBMITTED,(e=>{this.reactive.dispatch("createCategory",e.detail)})),modalForm.show()}_showNoCategoriesMessage(){const msg=document.querySelector(this.selectors.noCategoriesMsg);msg&&msg.classList.remove("d-none")}_hideNoCategoriesMessage(){const msg=document.querySelector(this.selectors.noCategoriesMsg);msg&&msg.classList.add("d-none")}_switchView(mode){if(this.currentView===mode)return;const tableView=document.querySelector(this.selectors.tableView),cardView=document.querySelector(this.selectors.cardView),tableModeBtn=document.querySelector(this.selectors.viewModeTable),cardsModeBtn=document.querySelector(this.selectors.viewModeCards);tableView&&cardView&&tableModeBtn&&cardsModeBtn&&("table"===mode?(tableView.classList.remove("d-none"),cardView.classList.add("d-none"),tableModeBtn.classList.add("active"),cardsModeBtn.classList.remove("active"),this.currentView="table"):"cards"===mode&&(cardView.classList.remove("d-none"),tableView.classList.add("d-none"),cardsModeBtn.classList.add("active"),tableModeBtn.classList.remove("active"),this.currentView="cards"),window.localStorage&&window.localStorage.setItem("bookit_resources_view_mode",mode))}}return _exports.default=_default,_exports.default}));

//# sourceMappingURL=resource_catalog.min.js.map