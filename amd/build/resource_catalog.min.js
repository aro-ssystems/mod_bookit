define("mod_bookit/resource_catalog",["exports","core/reactive","./resource_reactive","./resource_category","core_form/modalform","core/str"],(function(_exports,_reactive,_resource_reactive,_resource_category,_modalform,_str){function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}
/**
   * Resource catalog reactive component.
   *
   * @module mod_bookit/resource_catalog
   * @copyright   2026 ssystems GmbH <oss@ssystems.de>
   * @author      Andreas Rosenthal
   * @license     http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
   */Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.default=void 0,_resource_category=_interopRequireDefault(_resource_category),_modalform=_interopRequireDefault(_modalform);class _default extends _reactive.BaseComponent{static init(target,selectors){const categories=JSON.parse(selectors.categoriesJson),categoriesArray=[],itemsArray=[];return categories.forEach((category=>{categoriesArray.push({id:category.id,name:category.name,description:category.description,sortorder:category.sortorder}),category.resources&&Array.isArray(category.resources)&&category.resources.forEach((resource=>{itemsArray.push({id:resource.id,name:resource.name,description:resource.description,categoryid:category.id,amount:resource.amount,amountirrelevant:resource.amountirrelevant,sortorder:resource.sortorder})}))})),(0,_resource_reactive.initResourceReactive)({categories:categoriesArray,items:itemsArray}),new this({element:document.querySelector(target),reactive:_resource_reactive.resourceReactiveInstance,selectors:selectors})}static get componentName(){return"mod_bookit/resource_catalog"}create(){this.selectors.categoriesContainer="#mod-bookit-resource-categories",this.selectors.spinner="#mod-bookit-resource-spinner",this.selectors.content="#mod-bookit-resource-content",this.selectors.noCategoriesMsg="#mod-bookit-no-categories",this.selectors.addCategoryBtn="#add-category-btn",this.categoryComponents=new Map}stateReady(state){this._renderCategories(state),this._attachEventListeners(),this._hideSpinner(),this._showContent()}getWatchers(){return[{watch:"categories:created",handler:this._handleCategoryCreated},{watch:"categories:updated",handler:this._handleCategoryUpdated},{watch:"categories:deleted",handler:this._handleCategoryDeleted}]}_renderCategories(state){const container=document.querySelector(this.selectors.categoriesContainer);if(!container)return;const categories=Array.from(state.categories.values()).sort(((a,b)=>a.sortorder-b.sortorder));container.innerHTML="",this.categoryComponents.clear(),0!==categories.length?(this._hideNoCategoriesMessage(),categories.forEach((categoryData=>{const categoryComponent=new _resource_category.default({element:container,reactive:this.reactive,categoryData:categoryData});this.categoryComponents.set(categoryData.id,categoryComponent)}))):this._showNoCategoriesMessage()}_handleCategoryCreated(){const state=this.reactive.state;this._renderCategories(state)}_handleCategoryUpdated(_ref){let{element:element}=_ref;const component=this.categoryComponents.get(element.id);component&&component.update(element)}_handleCategoryDeleted(_ref2){let{element:element}=_ref2;const component=this.categoryComponents.get(element.id);component&&(component.remove(),this.categoryComponents.delete(element.id));0===this.reactive.state.categories.size&&this._showNoCategoriesMessage()}_attachEventListeners(){const addBtn=document.querySelector(this.selectors.addCategoryBtn);addBtn&&addBtn.addEventListener("click",(e=>{e.preventDefault(),this._handleAddCategory()}))}async _handleAddCategory(){const modalForm=new _modalform.default({formClass:"mod_bookit\\form\\edit_resource_category_form",args:{contextid:this.selectors.contextId},modalConfig:{title:await(0,_str.get_string)("resources:add_category","mod_bookit")}});modalForm.addEventListener(modalForm.events.FORM_SUBMITTED,(e=>{this.reactive.dispatch("createCategory",e.detail)})),modalForm.show()}_hideSpinner(){const spinner=document.querySelector(this.selectors.spinner);spinner&&spinner.classList.add("d-none")}_showContent(){const content=document.querySelector(this.selectors.content);content&&(content.classList.remove("d-none"),content.classList.add("d-block"))}_showNoCategoriesMessage(){const msg=document.querySelector(this.selectors.noCategoriesMsg);msg&&msg.classList.remove("d-none")}_hideNoCategoriesMessage(){const msg=document.querySelector(this.selectors.noCategoriesMsg);msg&&msg.classList.add("d-none")}}return _exports.default=_default,_exports.default}));

//# sourceMappingURL=resource_catalog.min.js.map