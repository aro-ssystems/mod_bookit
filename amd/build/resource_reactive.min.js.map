{"version":3,"file":"resource_reactive.min.js","sources":["../src/resource_reactive.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Reactive store for resource catalog.\n *\n * @module mod_bookit/resource_reactive\n * @copyright   2026 ssystems GmbH <oss@ssystems.de>\n * @author      Andreas Rosenthal\n * @license     http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\nimport {Reactive} from 'core/reactive';\nimport ModalForm from 'core_form/modalform';\n\n/**\n * Mutations for resource catalog.\n */\nclass ResourceMutations {\n    /**\n     * Prepare initial state.\n     *\n     * @param {Object} stateManager - State manager\n     * @param {Object} data - Initial data {categories, items}\n     */\n    prepareState(stateManager, data) {\n        const state = stateManager.state;\n\n        // Initialize maps.\n        if (!state.categories) {\n            state.categories = new Map();\n        }\n        if (!state.items) {\n            state.items = new Map();\n        }\n\n        // Load categories.\n        if (data.categories) {\n            data.categories.forEach(category => {\n                state.categories.set(category.id, {\n                    ...category,\n                    id: parseInt(category.id, 10),\n                });\n            });\n        }\n\n        // Load items.\n        if (data.items) {\n            data.items.forEach(item => {\n                state.items.set(item.id, {\n                    ...item,\n                    id: parseInt(item.id, 10),\n                    categoryid: parseInt(item.categoryid, 10),\n                });\n            });\n        }\n    }\n\n    /**\n     * Reorder items within or between categories.\n     *\n     * Pattern: Wie master_checklist_mutations.js\n     *\n     * @param {Object} stateManager - State manager\n     * @param {Object} data - {id, targetId, parentId, targetParentId}\n     */\n    reOrderCategoryItems(stateManager, data) {\n        const state = stateManager.state;\n\n        stateManager.setReadOnly(false);\n\n        // Item moved to different category.\n        if (data.parentId !== data.targetParentId) {\n            const sourceCategory = state.categories.get(data.parentId);\n            const targetCategory = state.categories.get(data.targetParentId);\n\n            if (!sourceCategory.items || !Array.isArray(sourceCategory.items)) {\n                sourceCategory.items = [];\n            }\n\n            if (!targetCategory.items || !Array.isArray(targetCategory.items)) {\n                targetCategory.items = [];\n            }\n\n            const idToMove = parseInt(data.id, 10);\n            const targetId = parseInt(data.targetId, 10);\n\n            // Remove from source.\n            sourceCategory.items = sourceCategory.items.filter(item => item !== idToMove);\n\n            // Add to target.\n            const targetItems = [...targetCategory.items];\n            const existingTargetIndex = targetItems.indexOf(idToMove);\n\n            if (existingTargetIndex === -1) {\n                const targetIndex = targetItems.indexOf(targetId);\n\n                if (targetIndex !== -1) {\n                    targetItems.splice(targetIndex + 1, 0, idToMove);\n                } else {\n                    targetItems.push(idToMove);\n                }\n            }\n\n            targetCategory.items = targetItems;\n\n            // Update item's categoryid.\n            const targetItem = state.items.get(idToMove);\n            if (targetItem) {\n                targetItem.categoryid = parseInt(targetCategory.id, 10);\n            }\n\n        } else {\n            // Item moved within same category.\n            const category = state.categories.get(data.targetParentId);\n\n            if (!category.items || !Array.isArray(category.items)) {\n                category.items = [];\n            }\n\n            const currentItems = [...category.items];\n            const idToMove = parseInt(data.id, 10);\n            const targetId = parseInt(data.targetId, 10);\n\n            const currentIndex = currentItems.indexOf(idToMove);\n\n            if (currentIndex === -1) {\n                currentItems.push(idToMove);\n            }\n\n            const targetIndex = currentItems.indexOf(targetId);\n\n            if (targetIndex !== -1 && currentIndex !== -1) {\n                currentItems.splice(currentIndex, 1);\n                const newTargetIndex = currentItems.indexOf(targetId);\n                currentItems.splice(newTargetIndex + 1, 0, idToMove);\n            } else if (currentIndex !== -1) {\n                currentItems.splice(currentIndex, 1);\n                currentItems.push(idToMove);\n            }\n\n            category.items = currentItems;\n        }\n\n        stateManager.setReadOnly(true);\n\n        // Persist state changes via ModalForm.\n        const categoriesToUpdate = [];\n\n        categoriesToUpdate.push(data.targetParentId);\n\n        if (data.parentId !== data.targetParentId) {\n            categoriesToUpdate.push(data.parentId);\n        }\n\n        // Update each affected category.\n        categoriesToUpdate.forEach(categoryId => {\n            const category = state.categories.get(categoryId);\n            const formDataObj = {\n                id: category.id,\n                name: category.name,\n                description: category.description || '',\n                items: category.items || [], // Reordered items\n                action: 'put',\n            };\n\n            const mutationData = {\n                formData: formDataObj,\n                formType: 'category'\n            };\n\n            this._callDynamicForm(stateManager, mutationData, false);\n        });\n    }\n\n    /**\n     * Reorder categories.\n     *\n     * Pattern: Wie master_checklist_mutations.js\n     *\n     * @param {Object} stateManager - State manager\n     * @param {Object} data - {id, targetId, parentId}\n     */\n    reOrderCategories(stateManager, data) {\n        const state = stateManager.state;\n\n        // Build category order array.\n        let categoryOrder = Array.from(state.categories.keys()).sort((a, b) => {\n            const catA = state.categories.get(a);\n            const catB = state.categories.get(b);\n            return (catA.sortorder || 0) - (catB.sortorder || 0);\n        });\n\n        const idToMove = parseInt(data.id, 10);\n        const targetId = parseInt(data.targetId, 10);\n\n        // Remove from current position.\n        categoryOrder = categoryOrder.filter(id => id !== idToMove);\n\n        // Insert after target.\n        const targetIndex = categoryOrder.indexOf(targetId);\n\n        if (targetIndex !== -1) {\n            categoryOrder.splice(targetIndex + 1, 0, idToMove);\n        } else {\n            categoryOrder.push(idToMove);\n        }\n\n        // Build comma-separated string.\n        const updatedCategoryOrder = categoryOrder.join(',');\n\n        // Persist via ModalForm.\n        const formDataObj = {\n            id: 0, // Special marker for \"catalog\" level update\n            categoryorder: updatedCategoryOrder,\n            action: 'put',\n        };\n\n        data.formData = formDataObj;\n        data.formType = 'category';\n\n        this._callDynamicForm(stateManager, data);\n    }\n\n    /**\n     * Create category (opens ModalForm).\n     *\n     * @param {Object} stateManager - State manager\n     * @param {Object} data - Form submission data\n     */\n    createCategory(stateManager, data) {\n        // Data comes from FORM_SUBMITTED event.\n        // Process and add to state.\n        stateManager.setReadOnly(false);\n\n        const newCategory = {\n            id: parseInt(data.id, 10),\n            name: data.name,\n            description: data.description || '',\n            sortorder: data.sortorder || 0,\n            active: data.active !== undefined ? data.active : true,\n            items: [],\n        };\n\n        stateManager.state.categories.set(newCategory.id, newCategory);\n\n        stateManager.setReadOnly(true);\n    }\n\n    /**\n     * Update category.\n     *\n     * @param {Object} stateManager - State manager\n     * @param {Object} data - Form submission data\n     */\n    updateCategory(stateManager, data) {\n        stateManager.setReadOnly(false);\n\n        const category = stateManager.state.categories.get(parseInt(data.id, 10));\n\n        if (category) {\n            category.name = data.name;\n            category.description = data.description || '';\n            category.sortorder = data.sortorder || category.sortorder;\n            category.active = data.active !== undefined ? data.active : category.active;\n        }\n\n        stateManager.setReadOnly(true);\n    }\n\n    /**\n     * Delete category.\n     *\n     * @param {Object} stateManager - State manager\n     * @param {number} categoryId - Category ID\n     */\n    deleteCategory(stateManager, categoryId) {\n        stateManager.setReadOnly(false);\n\n        const category = stateManager.state.categories.get(categoryId);\n\n        // Delete all items in category.\n        if (category && category.items) {\n            category.items.forEach(itemId => {\n                stateManager.state.items.delete(itemId);\n            });\n        }\n\n        // Delete category.\n        stateManager.state.categories.delete(categoryId);\n\n        stateManager.setReadOnly(true);\n    }\n\n    /**\n     * Create item (opens ModalForm).\n     *\n     * @param {Object} stateManager - State manager\n     * @param {Object} data - Form submission data\n     */\n    createItem(stateManager, data) {\n        stateManager.setReadOnly(false);\n\n        const newItem = {\n            id: parseInt(data.id, 10),\n            categoryid: parseInt(data.categoryid, 10),\n            name: data.name,\n            description: data.description || '',\n            amount: data.amount || 0,\n            amountirrelevant: data.amountirrelevant !== undefined ? data.amountirrelevant : false,\n            sortorder: data.sortorder || 0,\n            active: data.active !== undefined ? data.active : true,\n        };\n\n        stateManager.state.items.set(newItem.id, newItem);\n\n        // Add to category items array.\n        const category = stateManager.state.categories.get(newItem.categoryid);\n        if (category) {\n            if (!category.items) {\n                category.items = [];\n            }\n            category.items.push(newItem.id);\n        }\n\n        stateManager.setReadOnly(true);\n    }\n\n    /**\n     * Update item.\n     *\n     * @param {Object} stateManager - State manager\n     * @param {Object} data - Form submission data\n     */\n    updateItem(stateManager, data) {\n        stateManager.setReadOnly(false);\n\n        const item = stateManager.state.items.get(parseInt(data.id, 10));\n\n        if (item) {\n            const oldCategoryId = item.categoryid;\n            const newCategoryId = parseInt(data.categoryid, 10);\n\n            item.name = data.name;\n            item.description = data.description || '';\n            item.amount = data.amount || 0;\n            item.amountirrelevant = data.amountirrelevant !== undefined ? data.amountirrelevant : false;\n            item.sortorder = data.sortorder || item.sortorder;\n            item.active = data.active !== undefined ? data.active : item.active;\n            item.categoryid = newCategoryId;\n\n            // If category changed, update items arrays.\n            if (oldCategoryId !== newCategoryId) {\n                const oldCategory = stateManager.state.categories.get(oldCategoryId);\n                const newCategory = stateManager.state.categories.get(newCategoryId);\n\n                if (oldCategory && oldCategory.items) {\n                    oldCategory.items = oldCategory.items.filter(id => id !== item.id);\n                }\n\n                if (newCategory) {\n                    if (!newCategory.items) {\n                        newCategory.items = [];\n                    }\n                    newCategory.items.push(item.id);\n                }\n            }\n        }\n\n        stateManager.setReadOnly(true);\n    }\n\n    /**\n     * Delete item.\n     *\n     * @param {Object} stateManager - State manager\n     * @param {number} itemId - Item ID\n     */\n    deleteItem(stateManager, itemId) {\n        stateManager.setReadOnly(false);\n\n        const item = stateManager.state.items.get(itemId);\n\n        if (item) {\n            // Remove from category items array.\n            const category = stateManager.state.categories.get(item.categoryid);\n            if (category && category.items) {\n                category.items = category.items.filter(id => id !== itemId);\n            }\n\n            // Delete item.\n            stateManager.state.items.delete(itemId);\n        }\n\n        stateManager.setReadOnly(true);\n    }\n\n    /**\n     * Call dynamic form for persistence.\n     *\n     * Pattern: Wie master_checklist_mutations.js\n     *\n     * @param {Object} stateManager - State manager\n     * @param {Object} data - {formData, formType}\n     * @param {boolean} showModal - Whether to show modal (default: false)\n     * @private\n     */\n    _callDynamicForm(stateManager, data, showModal = false) {\n        const formClass = this._getFormClass(data.formType);\n\n        const modalForm = new ModalForm({\n            formClass: formClass,\n            args: data.formData,\n            modalConfig: {\n                title: '', // Not shown if not modal\n            },\n            saveButtonText: '', // Not relevant for silent submission\n        });\n\n        if (!showModal) {\n            // Submit form silently (no modal shown).\n            return modalForm.processNoSubmitButton().then(() => {\n                // Form submitted successfully.\n                window.console.log('Form submitted:', data.formType, data.formData);\n                return true;\n            }).catch((error) => {\n                window.console.error('Form submission failed:', error);\n                throw error;\n            });\n        }\n        // Show modal.\n        modalForm.show();\n        return Promise.resolve();\n    }\n\n    /**\n     * Get form class name based on type.\n     *\n     * @param {string} formType - Form type ('category' or 'item')\n     * @return {string} Form class name\n     * @private\n     */\n    _getFormClass(formType) {\n        switch (formType) {\n            case 'category':\n                return 'mod_bookit\\\\form\\\\edit_resource_category_form';\n            case 'item':\n                return 'mod_bookit\\\\form\\\\edit_resource_form';\n            default:\n                throw new Error(`Unknown form type: ${formType}`);\n        }\n    }\n}\n\n/**\n * Create reactive store for resources.\n *\n * @param {Object} initialData - {categories, items}\n * @return {Object} Reactive store instance\n */\nexport const createResourceReactive = (initialData) => {\n    const mutations = new ResourceMutations();\n\n    const reactive = new Reactive({\n        name: 'mod_bookit-resource_catalog',\n        eventName: 'resourceCatalogUpdated',\n        // eslint-disable-next-line no-empty-function\n        eventDispatch: () => {},\n        mutations: mutations,\n        state: {\n            categories: new Map(),\n            items: new Map(),\n        },\n    });\n\n    reactive.stateReady.then(() => {\n        // Initial state setup.\n        mutations.prepareState(reactive, initialData);\n        return true;\n    }).catch((error) => {\n        window.console.error('Error initializing reactive state:', error);\n        throw error;\n    });\n\n    return reactive;\n};\n"],"names":["ResourceMutations","prepareState","stateManager","data","state","categories","Map","items","forEach","category","set","id","parseInt","item","categoryid","reOrderCategoryItems","setReadOnly","parentId","targetParentId","sourceCategory","get","targetCategory","Array","isArray","idToMove","targetId","filter","targetItems","indexOf","targetIndex","splice","push","targetItem","currentItems","currentIndex","newTargetIndex","categoriesToUpdate","categoryId","mutationData","formData","name","description","action","formType","_callDynamicForm","reOrderCategories","categoryOrder","from","keys","sort","a","b","catA","catB","sortorder","formDataObj","categoryorder","join","createCategory","newCategory","active","undefined","updateCategory","deleteCategory","itemId","delete","createItem","newItem","amount","amountirrelevant","updateItem","oldCategoryId","newCategoryId","oldCategory","deleteItem","showModal","formClass","this","_getFormClass","modalForm","ModalForm","args","modalConfig","title","saveButtonText","show","Promise","resolve","processNoSubmitButton","then","window","console","log","catch","error","Error","initialData","mutations","reactive","Reactive","eventName","eventDispatch","stateReady"],"mappings":";;;;;;;;wKA8BMA,kBAOFC,aAAaC,aAAcC,YACjBC,MAAQF,aAAaE,MAGtBA,MAAMC,aACPD,MAAMC,WAAa,IAAIC,KAEtBF,MAAMG,QACPH,MAAMG,MAAQ,IAAID,KAIlBH,KAAKE,YACLF,KAAKE,WAAWG,SAAQC,WACpBL,MAAMC,WAAWK,IAAID,SAASE,GAAI,IAC3BF,SACHE,GAAIC,SAASH,SAASE,GAAI,SAMlCR,KAAKI,OACLJ,KAAKI,MAAMC,SAAQK,OACfT,MAAMG,MAAMG,IAAIG,KAAKF,GAAI,IAClBE,KACHF,GAAIC,SAASC,KAAKF,GAAI,IACtBG,WAAYF,SAASC,KAAKC,WAAY,SActDC,qBAAqBb,aAAcC,YACzBC,MAAQF,aAAaE,SAE3BF,aAAac,aAAY,GAGrBb,KAAKc,WAAad,KAAKe,eAAgB,OACjCC,eAAiBf,MAAMC,WAAWe,IAAIjB,KAAKc,UAC3CI,eAAiBjB,MAAMC,WAAWe,IAAIjB,KAAKe,gBAE5CC,eAAeZ,OAAUe,MAAMC,QAAQJ,eAAeZ,SACvDY,eAAeZ,MAAQ,IAGtBc,eAAed,OAAUe,MAAMC,QAAQF,eAAed,SACvDc,eAAed,MAAQ,UAGrBiB,SAAWZ,SAAST,KAAKQ,GAAI,IAC7Bc,SAAWb,SAAST,KAAKsB,SAAU,IAGzCN,eAAeZ,MAAQY,eAAeZ,MAAMmB,QAAOb,MAAQA,OAASW,iBAG9DG,YAAc,IAAIN,eAAed,WAGV,IAFDoB,YAAYC,QAAQJ,UAEhB,OACtBK,YAAcF,YAAYC,QAAQH,WAEnB,IAAjBI,YACAF,YAAYG,OAAOD,YAAc,EAAG,EAAGL,UAEvCG,YAAYI,KAAKP,UAIzBH,eAAed,MAAQoB,kBAGjBK,WAAa5B,MAAMG,MAAMa,IAAII,UAC/BQ,aACAA,WAAWlB,WAAaF,SAASS,eAAeV,GAAI,SAGrD,OAEGF,SAAWL,MAAMC,WAAWe,IAAIjB,KAAKe,gBAEtCT,SAASF,OAAUe,MAAMC,QAAQd,SAASF,SAC3CE,SAASF,MAAQ,UAGf0B,aAAe,IAAIxB,SAASF,OAC5BiB,SAAWZ,SAAST,KAAKQ,GAAI,IAC7Bc,SAAWb,SAAST,KAAKsB,SAAU,IAEnCS,aAAeD,aAAaL,QAAQJ,WAEpB,IAAlBU,cACAD,aAAaF,KAAKP,cAKD,IAFDS,aAAaL,QAAQH,YAEG,IAAlBS,aAAqB,CAC3CD,aAAaH,OAAOI,aAAc,SAC5BC,eAAiBF,aAAaL,QAAQH,UAC5CQ,aAAaH,OAAOK,eAAiB,EAAG,EAAGX,eAClB,IAAlBU,eACPD,aAAaH,OAAOI,aAAc,GAClCD,aAAaF,KAAKP,WAGtBf,SAASF,MAAQ0B,aAGrB/B,aAAac,aAAY,SAGnBoB,mBAAqB,GAE3BA,mBAAmBL,KAAK5B,KAAKe,gBAEzBf,KAAKc,WAAad,KAAKe,gBACvBkB,mBAAmBL,KAAK5B,KAAKc,UAIjCmB,mBAAmB5B,SAAQ6B,mBACjB5B,SAAWL,MAAMC,WAAWe,IAAIiB,YAShCC,aAAe,CACjBC,SATgB,CAChB5B,GAAIF,SAASE,GACb6B,KAAM/B,SAAS+B,KACfC,YAAahC,SAASgC,aAAe,GACrClC,MAAOE,SAASF,OAAS,GACzBmC,OAAQ,OAKRC,SAAU,iBAGTC,iBAAiB1C,aAAcoC,cAAc,MAY1DO,kBAAkB3C,aAAcC,YACtBC,MAAQF,aAAaE,UAGvB0C,cAAgBxB,MAAMyB,KAAK3C,MAAMC,WAAW2C,QAAQC,MAAK,CAACC,EAAGC,WACvDC,KAAOhD,MAAMC,WAAWe,IAAI8B,GAC5BG,KAAOjD,MAAMC,WAAWe,IAAI+B,UAC1BC,KAAKE,WAAa,IAAMD,KAAKC,WAAa,YAGhD9B,SAAWZ,SAAST,KAAKQ,GAAI,IAC7Bc,SAAWb,SAAST,KAAKsB,SAAU,IAGzCqB,cAAgBA,cAAcpB,QAAOf,IAAMA,KAAOa,iBAG5CK,YAAciB,cAAclB,QAAQH,WAErB,IAAjBI,YACAiB,cAAchB,OAAOD,YAAc,EAAG,EAAGL,UAEzCsB,cAAcf,KAAKP,gBAOjB+B,YAAc,CAChB5C,GAAI,EACJ6C,cALyBV,cAAcW,KAAK,KAM5Cf,OAAQ,OAGZvC,KAAKoC,SAAWgB,YAChBpD,KAAKwC,SAAW,gBAEXC,iBAAiB1C,aAAcC,MASxCuD,eAAexD,aAAcC,MAGzBD,aAAac,aAAY,SAEnB2C,YAAc,CAChBhD,GAAIC,SAAST,KAAKQ,GAAI,IACtB6B,KAAMrC,KAAKqC,KACXC,YAAatC,KAAKsC,aAAe,GACjCa,UAAWnD,KAAKmD,WAAa,EAC7BM,YAAwBC,IAAhB1D,KAAKyD,QAAuBzD,KAAKyD,OACzCrD,MAAO,IAGXL,aAAaE,MAAMC,WAAWK,IAAIiD,YAAYhD,GAAIgD,aAElDzD,aAAac,aAAY,GAS7B8C,eAAe5D,aAAcC,MACzBD,aAAac,aAAY,SAEnBP,SAAWP,aAAaE,MAAMC,WAAWe,IAAIR,SAAST,KAAKQ,GAAI,KAEjEF,WACAA,SAAS+B,KAAOrC,KAAKqC,KACrB/B,SAASgC,YAActC,KAAKsC,aAAe,GAC3ChC,SAAS6C,UAAYnD,KAAKmD,WAAa7C,SAAS6C,UAChD7C,SAASmD,YAAyBC,IAAhB1D,KAAKyD,OAAuBzD,KAAKyD,OAASnD,SAASmD,QAGzE1D,aAAac,aAAY,GAS7B+C,eAAe7D,aAAcmC,YACzBnC,aAAac,aAAY,SAEnBP,SAAWP,aAAaE,MAAMC,WAAWe,IAAIiB,YAG/C5B,UAAYA,SAASF,OACrBE,SAASF,MAAMC,SAAQwD,SACnB9D,aAAaE,MAAMG,MAAM0D,OAAOD,WAKxC9D,aAAaE,MAAMC,WAAW4D,OAAO5B,YAErCnC,aAAac,aAAY,GAS7BkD,WAAWhE,aAAcC,MACrBD,aAAac,aAAY,SAEnBmD,QAAU,CACZxD,GAAIC,SAAST,KAAKQ,GAAI,IACtBG,WAAYF,SAAST,KAAKW,WAAY,IACtC0B,KAAMrC,KAAKqC,KACXC,YAAatC,KAAKsC,aAAe,GACjC2B,OAAQjE,KAAKiE,QAAU,EACvBC,sBAA4CR,IAA1B1D,KAAKkE,kBAAiClE,KAAKkE,iBAC7Df,UAAWnD,KAAKmD,WAAa,EAC7BM,YAAwBC,IAAhB1D,KAAKyD,QAAuBzD,KAAKyD,QAG7C1D,aAAaE,MAAMG,MAAMG,IAAIyD,QAAQxD,GAAIwD,eAGnC1D,SAAWP,aAAaE,MAAMC,WAAWe,IAAI+C,QAAQrD,YACvDL,WACKA,SAASF,QACVE,SAASF,MAAQ,IAErBE,SAASF,MAAMwB,KAAKoC,QAAQxD,KAGhCT,aAAac,aAAY,GAS7BsD,WAAWpE,aAAcC,MACrBD,aAAac,aAAY,SAEnBH,KAAOX,aAAaE,MAAMG,MAAMa,IAAIR,SAAST,KAAKQ,GAAI,QAExDE,KAAM,OACA0D,cAAgB1D,KAAKC,WACrB0D,cAAgB5D,SAAST,KAAKW,WAAY,OAEhDD,KAAK2B,KAAOrC,KAAKqC,KACjB3B,KAAK4B,YAActC,KAAKsC,aAAe,GACvC5B,KAAKuD,OAASjE,KAAKiE,QAAU,EAC7BvD,KAAKwD,sBAA6CR,IAA1B1D,KAAKkE,kBAAiClE,KAAKkE,iBACnExD,KAAKyC,UAAYnD,KAAKmD,WAAazC,KAAKyC,UACxCzC,KAAK+C,YAAyBC,IAAhB1D,KAAKyD,OAAuBzD,KAAKyD,OAAS/C,KAAK+C,OAC7D/C,KAAKC,WAAa0D,cAGdD,gBAAkBC,cAAe,OAC3BC,YAAcvE,aAAaE,MAAMC,WAAWe,IAAImD,eAChDZ,YAAczD,aAAaE,MAAMC,WAAWe,IAAIoD,eAElDC,aAAeA,YAAYlE,QAC3BkE,YAAYlE,MAAQkE,YAAYlE,MAAMmB,QAAOf,IAAMA,KAAOE,KAAKF,MAG/DgD,cACKA,YAAYpD,QACboD,YAAYpD,MAAQ,IAExBoD,YAAYpD,MAAMwB,KAAKlB,KAAKF,MAKxCT,aAAac,aAAY,GAS7B0D,WAAWxE,aAAc8D,QACrB9D,aAAac,aAAY,SAEnBH,KAAOX,aAAaE,MAAMG,MAAMa,IAAI4C,WAEtCnD,KAAM,OAEAJ,SAAWP,aAAaE,MAAMC,WAAWe,IAAIP,KAAKC,YACpDL,UAAYA,SAASF,QACrBE,SAASF,MAAQE,SAASF,MAAMmB,QAAOf,IAAMA,KAAOqD,UAIxD9D,aAAaE,MAAMG,MAAM0D,OAAOD,QAGpC9D,aAAac,aAAY,GAa7B4B,iBAAiB1C,aAAcC,UAAMwE,wEAC3BC,UAAYC,KAAKC,cAAc3E,KAAKwC,UAEpCoC,UAAY,IAAIC,mBAAU,CAC5BJ,UAAWA,UACXK,KAAM9E,KAAKoC,SACX2C,YAAa,CACTC,MAAO,IAEXC,eAAgB,YAGfT,WAYLI,UAAUM,OACHC,QAAQC,WAXJR,UAAUS,wBAAwBC,MAAK,KAE1CC,OAAOC,QAAQC,IAAI,kBAAmBzF,KAAKwC,SAAUxC,KAAKoC,WACnD,KACRsD,OAAOC,cACNJ,OAAOC,QAAQG,MAAM,0BAA2BA,OAC1CA,SAelBhB,cAAcnC,iBACFA,cACC,iBACM,oDACN,aACM,qDAED,IAAIoD,mCAA4BpD,6CAWfqD,oBAC7BC,UAAY,IAAIjG,kBAEhBkG,SAAW,IAAIC,mBAAS,CAC1B3D,KAAM,8BACN4D,UAAW,yBAEXC,cAAe,OACfJ,UAAWA,UACX7F,MAAO,CACHC,WAAY,IAAIC,IAChBC,MAAO,IAAID,cAInB4F,SAASI,WAAWb,MAAK,KAErBQ,UAAUhG,aAAaiG,SAAUF,cAC1B,KACRH,OAAOC,cACNJ,OAAOC,QAAQG,MAAM,qCAAsCA,OACrDA,SAGHI"}