{"version":3,"file":"master_checklist_reactive.min.js","sources":["../src/master_checklist_reactive.js"],"sourcesContent":["import { Reactive } from 'core/reactive';\nimport Mutations from 'mod_bookit/master_checklist_mutations';\nimport MasterChecklist from 'mod_bookit/master_checklist';\n\nconst SELECTORS = {\n            TABLE: '#mod-bookit-master-checklist-table',\n            ADD_CHECKLIST_CATEGORY_BUTTON: '#add-checklist-category-button',\n            ADD_CHECKLIST_ITEM_BUTTON: '#add-checklist-item-button',\n            MASTER_CHECKLIST_TITLE: '#mod-bookit-master-checklist-title',\n            ALL_CATEGORY_TABLE_ROWS: 'tr[data-bookit-category-id]',\n            ALL_ITEM_TABLE_ROWS: 'tr[data-bookit-checklistitem-id]',\n            TABLE_BODY: '#mod-bookit-master-checklist-tbody',\n        };\n\n\nconst EVENTNAME = 'mod_bookit:master_checklist_state_event'\n\nexport const init = (elementId) => {\n\n    window.console.log('THIS IS REACTIVE');\n\n    const masterChecklistReactiveInstance = new Reactive({\n        eventName: EVENTNAME,\n        eventDispatch: dispatchMasterChecklistStateEvent,\n        target: document.getElementById(elementId),\n        mutations: new Mutations(),\n        name: 'Moodle Bookit Master Checklist',\n        // state: {}\n    });\n\n    loadState(masterChecklistReactiveInstance);\n\n    return new MasterChecklist({\n        element: document.getElementById(elementId),\n        reactive: masterChecklistReactiveInstance,\n        selectors: SELECTORS,\n    });\n}\n\nfunction dispatchMasterChecklistStateEvent(detail, target) {\n\n    window.console.log('dispatch master checklist state event function');\n    if (target === undefined) {\n        target = document;\n    }\n    target.dispatchEvent(\n        new CustomEvent(\n            EVENTNAME,\n            {\n                bubbles: true,\n                detail: detail,\n            }\n        )\n    );\n}\n\n/**\n * Load the initial state.\n *\n * This iterates over the initial tree of category items, and captures the data required for the state from each category.\n * It also captures a count of the number of children in each list.\n *\n * @param {Reactive} reactive\n * @return {Promise<void>}\n */\nconst loadState = async(reactive) => {\n\n    window.console.log('loading state');\n\n    const tableElement = document.querySelector(SELECTORS.TABLE);\n\n\n    const stateData = {\n        masterchecklists: [{\n            id: tableElement.dataset.masterChecklistId,\n            name: tableElement.dataset.masterChecklistName\n        }],\n        activechecklist: {\n            id: tableElement.dataset.masterChecklistId,\n        },\n        checklistcategories: [],\n        checklistitems: [],\n    };\n    const checklistCategoryRows = document.querySelectorAll(SELECTORS.ALL_CATEGORY_TABLE_ROWS);\n    checklistCategoryRows.forEach(categoryRow => {\n\n        const categoryItemRows = document.querySelectorAll(`tr[data-bookit-checklistitem-category=\"${categoryRow.dataset.bookitCategoryId}\"]`);\n\n        const checklistItems = [];\n        categoryItemRows.forEach(itemRow => {\n            checklistItems.push(itemRow.dataset.bookitChecklistitemId)\n        });\n\n        stateData.checklistcategories.push({\n            id: categoryRow.dataset.bookitCategoryId,\n            name: categoryRow.dataset.bookitCategoryName,\n            order: categoryRow.dataset.bookitCategoryOrder,\n            items: checklistItems\n        });\n    });\n\n    const checklistItemRows = document.querySelectorAll(SELECTORS.ALL_ITEM_TABLE_ROWS);\n    checklistItemRows.forEach(itemRow => {\n        stateData.checklistitems.push({\n            id: itemRow.dataset.bookitChecklistitemId,\n            name: itemRow.dataset.bookitChecklistitemName,\n            order: itemRow.dataset.bookitChecklistitemOrder,\n            category: itemRow.dataset.bookitCategoryId\n        });\n    });\n\n\n    // const categoryLists = document.querySelectorAll(SELECTORS.CATEGORY_LIST);\n    // categoryLists.forEach(categoryList => {\n    //     stateData.categoryLists.push({\n    //         id: categoryList.dataset.categoryid,\n    //         childCount: categoryList.querySelectorAll(SELECTORS.CATEGORY_ITEM).length,\n    //     });\n    // });\n    reactive.setInitialState(stateData);\n};"],"names":["SELECTORS","TABLE","ADD_CHECKLIST_CATEGORY_BUTTON","ADD_CHECKLIST_ITEM_BUTTON","MASTER_CHECKLIST_TITLE","ALL_CATEGORY_TABLE_ROWS","ALL_ITEM_TABLE_ROWS","TABLE_BODY","EVENTNAME","dispatchMasterChecklistStateEvent","detail","target","window","console","log","undefined","document","dispatchEvent","CustomEvent","bubbles","elementId","masterChecklistReactiveInstance","Reactive","eventName","eventDispatch","getElementById","mutations","Mutations","name","loadState","MasterChecklist","element","reactive","selectors","async","tableElement","querySelector","stateData","masterchecklists","id","dataset","masterChecklistId","masterChecklistName","activechecklist","checklistcategories","checklistitems","querySelectorAll","forEach","categoryRow","categoryItemRows","bookitCategoryId","checklistItems","itemRow","push","bookitChecklistitemId","bookitCategoryName","order","bookitCategoryOrder","items","bookitChecklistitemName","bookitChecklistitemOrder","category","setInitialState"],"mappings":"6gBAIMA,UAAY,CACNC,MAAO,qCACPC,8BAA+B,iCAC/BC,0BAA2B,6BAC3BC,uBAAwB,qCACxBC,wBAAyB,8BACzBC,oBAAqB,mCACrBC,WAAY,sCAIlBC,UAAY,mDAwBTC,kCAAkCC,OAAQC,QAE/CC,OAAOC,QAAQC,IAAI,uDACJC,IAAXJ,SACAA,OAASK,UAEbL,OAAOM,cACH,IAAIC,YACAV,UACA,CACIW,SAAS,EACTT,OAAQA,wBAjCHU,YAEjBR,OAAOC,QAAQC,IAAI,0BAEbO,gCAAkC,IAAIC,mBAAS,CACjDC,UAAWf,UACXgB,cAAef,kCACfE,OAAQK,SAASS,eAAeL,WAChCM,UAAW,IAAIC,oCACfC,KAAM,0CAIVC,UAAUR,iCAEH,IAAIS,0BAAgB,CACvBC,QAASf,SAASS,eAAeL,WACjCY,SAAUX,gCACVY,UAAWjC,mBA8Bb6B,UAAYK,MAAAA,WAEdtB,OAAOC,QAAQC,IAAI,uBAEbqB,aAAenB,SAASoB,cAAcpC,UAAUC,OAGhDoC,UAAY,CACdC,iBAAkB,CAAC,CACfC,GAAIJ,aAAaK,QAAQC,kBACzBb,KAAMO,aAAaK,QAAQE,sBAE/BC,gBAAiB,CACbJ,GAAIJ,aAAaK,QAAQC,mBAE7BG,oBAAqB,GACrBC,eAAgB,IAEU7B,SAAS8B,iBAAiB9C,UAAUK,yBAC5C0C,SAAQC,oBAEpBC,iBAAmBjC,SAAS8B,kEAA2DE,YAAYR,QAAQU,wBAE3GC,eAAiB,GACvBF,iBAAiBF,SAAQK,UACrBD,eAAeE,KAAKD,QAAQZ,QAAQc,0BAGxCjB,UAAUO,oBAAoBS,KAAK,CAC/Bd,GAAIS,YAAYR,QAAQU,iBACxBtB,KAAMoB,YAAYR,QAAQe,mBAC1BC,MAAOR,YAAYR,QAAQiB,oBAC3BC,MAAOP,oBAIWnC,SAAS8B,iBAAiB9C,UAAUM,qBAC5CyC,SAAQK,UACtBf,UAAUQ,eAAeQ,KAAK,CAC1Bd,GAAIa,QAAQZ,QAAQc,sBACpB1B,KAAMwB,QAAQZ,QAAQmB,wBACtBH,MAAOJ,QAAQZ,QAAQoB,yBACvBC,SAAUT,QAAQZ,QAAQU,sBAYlClB,SAAS8B,gBAAgBzB"}