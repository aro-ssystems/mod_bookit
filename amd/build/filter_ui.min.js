define("mod_bookit/filter_ui",["exports","core/ajax","core/str","core/templates"],(function(_exports,_ajax,_str,_templates){var obj;Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.FilterUI=void 0,_templates=(obj=_templates)&&obj.__esModule?obj:{default:obj};_exports.FilterUI=class{constructor(){this.strings={},this.filters={search:"",room:"",timeslot:"",faculty:"",status:""},this.hasAdminAccess=!1}async init(){let hasAdminAccess=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.hasAdminAccess=hasAdminAccess,await this.loadStrings(),await this.render(),await this.loadFilterData(),this.attachEventListeners()}async loadFilterData(){const[rooms,faculties,statuses]=await Promise.all([this.fetchRooms(),this.fetchFaculties(),this.fetchStatuses()]),timeslots=[{id:"morning",name:this.strings.morning},{id:"afternoon",name:this.strings.afternoon},{id:"evening",name:this.strings.evening}];this.updateOptions({room:rooms||[],timeslot:timeslots,faculty:faculties||[],status:statuses||[]})}async fetchRooms(){return(await(0,_ajax.call)([{methodname:"mod_bookit_get_rooms",args:{}}]))[0]}async fetchFaculties(){return(await(0,_ajax.call)([{methodname:"mod_bookit_get_faculties",args:{}}]))[0]}async fetchStatuses(){try{return(await(0,_ajax.call)([{methodname:"mod_bookit_get_statuses",args:{}}]))[0]}catch(error){return[]}}async loadStrings(){const strings=await(0,_str.getStrings)([{key:"filter_search",component:"mod_bookit"},{key:"filter_search_placeholder",component:"mod_bookit"},{key:"filter_room",component:"mod_bookit"},{key:"filter_timeslot",component:"mod_bookit"},{key:"filter_faculty",component:"mod_bookit"},{key:"filter_status",component:"mod_bookit"},{key:"morning",component:"mod_bookit"},{key:"afternoon",component:"mod_bookit"},{key:"evening",component:"mod_bookit"},{key:"all_entries",component:"mod_bookit"}]);this.strings={search:strings[0],searchPlaceholder:strings[1],room:strings[2],timeslot:strings[3],faculty:strings[4],status:strings[5],morning:strings[6],afternoon:strings[7],evening:strings[8],select:strings[9]}}async render(){const templateContext={strings:this.strings||{},hasAdminAccess:this.hasAdminAccess||!1},html=await _templates.default.render("mod_bookit/filter_ui",templateContext);let container=document.querySelector(".filter-container");var _document$querySelect;container||(container=document.createElement("div"),container.className="filter-container",null===(_document$querySelect=document.querySelector("#ec"))||void 0===_document$querySelect||_document$querySelect.insertAdjacentElement("beforebegin",container));container.outerHTML=html}updateOptions(options){Object.entries(options).forEach((_ref=>{let[filterType,values]=_ref;const select=document.querySelector('select[name="'.concat(filterType,'"]'));if(!select)return;select.innerHTML="";const defaultOption=document.createElement("option");defaultOption.value="",defaultOption.textContent=this.strings.select||"---",select.appendChild(defaultOption),Array.isArray(values)&&values.forEach((option=>{const optionElement=document.createElement("option");optionElement.value=option.id||option,optionElement.textContent=option.name||option,select.appendChild(optionElement)}))}))}attachEventListeners(){const searchInput=document.querySelector('input[name="search"]');searchInput&&searchInput.addEventListener("input",(()=>{this.dispatchFilterUpdate()})),["room","timeslot","faculty","status"].forEach((filterType=>{const select=document.querySelector('select[name="'.concat(filterType,'"]'));select&&select.addEventListener("change",(()=>{this.dispatchFilterUpdate()}))}))}dispatchFilterUpdate(){var _document$querySelect2,_document$querySelect3,_document$querySelect4,_document$querySelect5,_document$querySelect6;const filters={search:(null===(_document$querySelect2=document.querySelector('input[name="search"]'))||void 0===_document$querySelect2?void 0:_document$querySelect2.value)||"",room:(null===(_document$querySelect3=document.querySelector('select[name="room"]'))||void 0===_document$querySelect3?void 0:_document$querySelect3.value)||"",timeslot:(null===(_document$querySelect4=document.querySelector('select[name="timeslot"]'))||void 0===_document$querySelect4?void 0:_document$querySelect4.value)||"",faculty:(null===(_document$querySelect5=document.querySelector('select[name="faculty"]'))||void 0===_document$querySelect5?void 0:_document$querySelect5.value)||"",status:(null===(_document$querySelect6=document.querySelector('select[name="status"]'))||void 0===_document$querySelect6?void 0:_document$querySelect6.value)||""},event=new CustomEvent("filterupdate",{detail:filters});document.dispatchEvent(event)}}}));

//# sourceMappingURL=filter_ui.min.js.map