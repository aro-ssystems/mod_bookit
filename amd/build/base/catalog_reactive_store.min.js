define("mod_bookit/base/catalog_reactive_store",["exports","core/reactive","core/ajax","core/str","core/notification"],(function(_exports,_reactive,_ajax,_str,_notification){var obj;
/**
   * Reactive store factory for catalog-based modules.
   *
   * @module mod_bookit/base/catalog_reactive_store
   * @copyright   2026 ssystems GmbH <oss@ssystems.de>
   * @author      Andreas Rosenthal
   * @license     http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
   */Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.createCatalogStore=void 0,_notification=(obj=_notification)&&obj.__esModule?obj:{default:obj};_exports.createCatalogStore=config=>{const storeName=config.storeName||"mod_bookit-catalog",categoriesName=config.categoriesName||"categories",itemsName=config.itemsName||"items",ajaxEndpoint=config.ajaxEndpoint||"mod_bookit_catalog",reactive=new _reactive.Reactive({name:storeName,eventName:"".concat(storeName,":statechanged"),eventDispatch:()=>document});return reactive.stateReady((state=>{state[categoriesName]=state[categoriesName]||new Map,state[itemsName]=state[itemsName]||new Map,state.activeFilters=state.activeFilters||{}})),reactive.registerMutation("prepareState",(stateManager=>data=>{const state=stateManager.state;state[categoriesName]=state[categoriesName]||new Map,state[itemsName]=state[itemsName]||new Map,state.activeFilters=state.activeFilters||{},data.categories&&data.categories.forEach((category=>{state[categoriesName].set(category.id,category)})),data.items&&data.items.forEach((item=>{state[itemsName].set(item.id,item)})),stateManager.setReadOnly(!1),stateManager.state=state,stateManager.setReadOnly(!0)})),reactive.registerMutation("createCategory",(stateManager=>async data=>{try{const result=await(0,_ajax.call)([{methodname:"".concat(ajaxEndpoint,"_create_category"),args:{name:data.name,description:data.description||"",sortorder:data.sortorder||0,active:void 0!==data.active?data.active:1}}]),state=stateManager.state;state[categoriesName].set(result[0].id,result[0]),stateManager.setReadOnly(!1),stateManager.state=state,stateManager.setReadOnly(!0);const message=await(0,_str.get_string)("category_created","mod_bookit");_notification.default.addNotification({message:message,type:"success"})}catch(error){_notification.default.exception(error)}})),reactive.registerMutation("updateCategory",(stateManager=>async data=>{try{const result=await(0,_ajax.call)([{methodname:"".concat(ajaxEndpoint,"_update_category"),args:{categoryid:data.id,name:data.name,description:data.description,active:data.active}}]),state=stateManager.state;state[categoriesName].set(data.id,result[0]),stateManager.setReadOnly(!1),stateManager.state=state,stateManager.setReadOnly(!0);const message=await(0,_str.get_string)("category_updated","mod_bookit");_notification.default.addNotification({message:message,type:"success"})}catch(error){_notification.default.exception(error)}})),reactive.registerMutation("deleteCategory",(stateManager=>async categoryId=>{try{await(0,_ajax.call)([{methodname:"".concat(ajaxEndpoint,"_delete_category"),args:{categoryid:categoryId}}]);const state=stateManager.state;state[categoriesName].delete(categoryId),state[itemsName].forEach(((item,itemId)=>{item.categoryid===categoryId&&state[itemsName].delete(itemId)})),stateManager.setReadOnly(!1),stateManager.state=state,stateManager.setReadOnly(!0);const message=await(0,_str.get_string)("category_deleted","mod_bookit");_notification.default.addNotification({message:message,type:"success"})}catch(error){_notification.default.exception(error)}})),reactive.registerMutation("createItem",(stateManager=>async data=>{try{const result=await(0,_ajax.call)([{methodname:"".concat(ajaxEndpoint,"_create_item"),args:{name:data.name,categoryid:data.categoryid,description:data.description||"",amount:data.amount||0,amountirrelevant:data.amountirrelevant||0,sortorder:data.sortorder||0,active:void 0!==data.active?data.active:1}}]),state=stateManager.state;state[itemsName].set(result[0].id,result[0]),stateManager.setReadOnly(!1),stateManager.state=state,stateManager.setReadOnly(!0);const message=await(0,_str.get_string)("item_created","mod_bookit");_notification.default.addNotification({message:message,type:"success"})}catch(error){_notification.default.exception(error)}})),reactive.registerMutation("updateItem",(stateManager=>async data=>{try{const result=await(0,_ajax.call)([{methodname:"".concat(ajaxEndpoint,"_update_item"),args:{itemid:data.id,name:data.name,description:data.description,amount:data.amount,amountirrelevant:data.amountirrelevant,active:data.active}}]),state=stateManager.state;state[itemsName].set(data.id,result[0]),stateManager.setReadOnly(!1),stateManager.state=state,stateManager.setReadOnly(!0);const message=await(0,_str.get_string)("item_updated","mod_bookit");_notification.default.addNotification({message:message,type:"success"})}catch(error){_notification.default.exception(error)}})),reactive.registerMutation("deleteItem",(stateManager=>async itemId=>{try{await(0,_ajax.call)([{methodname:"".concat(ajaxEndpoint,"_delete_item"),args:{itemid:itemId}}]);const state=stateManager.state;state[itemsName].delete(itemId),stateManager.setReadOnly(!1),stateManager.state=state,stateManager.setReadOnly(!0);const message=await(0,_str.get_string)("item_deleted","mod_bookit");_notification.default.addNotification({message:message,type:"success"})}catch(error){_notification.default.exception(error)}})),reactive.registerMutation("reorderCategory",(stateManager=>async _ref=>{let{categoryId:categoryId,targetCategoryId:targetCategoryId}=_ref;try{await(0,_ajax.call)([{methodname:"".concat(ajaxEndpoint,"_reorder_categories"),args:{categoryid:categoryId,targetcategoryid:targetCategoryId}}]);const state=stateManager.state,category=state[categoriesName].get(categoryId),targetCategory=state[categoriesName].get(targetCategoryId);if(category&&targetCategory){const tempOrder=category.sortorder;category.sortorder=targetCategory.sortorder,targetCategory.sortorder=tempOrder,state[categoriesName].set(categoryId,category),state[categoriesName].set(targetCategoryId,targetCategory),stateManager.setReadOnly(!1),stateManager.state=state,stateManager.setReadOnly(!0)}}catch(error){_notification.default.exception(error),window.location.reload()}})),reactive.registerMutation("reorderItem",(stateManager=>async _ref2=>{let{itemId:itemId,targetItemId:targetItemId,categoryId:categoryId}=_ref2;try{await(0,_ajax.call)([{methodname:"".concat(ajaxEndpoint,"_reorder_items"),args:{itemid:itemId,targetitemid:targetItemId,categoryid:categoryId}}]);const state=stateManager.state,item=state[itemsName].get(itemId),targetItem=state[itemsName].get(targetItemId);if(item&&targetItem){item.categoryid=categoryId;const tempOrder=item.sortorder;item.sortorder=targetItem.sortorder,targetItem.sortorder=tempOrder,state[itemsName].set(itemId,item),state[itemsName].set(targetItemId,targetItem),stateManager.setReadOnly(!1),stateManager.state=state,stateManager.setReadOnly(!0)}}catch(error){_notification.default.exception(error),window.location.reload()}})),reactive.registerMutation("setFilter",(stateManager=>_ref3=>{let{filterName:filterName,filterValue:filterValue}=_ref3;const state=stateManager.state;state.activeFilters[filterName]=filterValue,stateManager.setReadOnly(!1),stateManager.state=state,stateManager.setReadOnly(!0)})),reactive}}));

//# sourceMappingURL=catalog_reactive_store.min.js.map