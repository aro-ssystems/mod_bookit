define("mod_bookit/base/catalog_category_component",["exports","core/templates","core_form/modalform","core/str"],(function(_exports,_templates,_modalform,_str){function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}
/**
   * Base component for catalog categories.
   *
   * @module mod_bookit/base/catalog_category_component
   * @copyright   2026 ssystems GmbH <oss@ssystems.de>
   * @author      Andreas Rosenthal
   * @license     http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
   */Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.default=void 0,_templates=_interopRequireDefault(_templates),_modalform=_interopRequireDefault(_modalform);return _exports.default=class{constructor(reactive,categoryData,ItemComponentClass){this.reactive=reactive,this.categoryData=categoryData,this.ItemComponentClass=ItemComponentClass,this.element=null,this.itemComponents=new Map}async render(){const context=this.getTemplateContext(),html=await _templates.default.render(this.getTemplateName(),context),wrapper=document.createElement("div");return wrapper.innerHTML=html.trim(),this.element=wrapper.firstChild,await this.renderItems(),this.attachEventListeners(),this.attachDragDropListeners(),this.element}getTemplateName(){throw new Error("getTemplateName() must be implemented by subclass")}getTemplateContext(){return{...this.categoryData,resources:[]}}getEditModalFormClass(){throw new Error("getEditModalFormClass() must be implemented by subclass")}async renderItems(){if(!this.element)return;const itemsContainer=this.element.querySelector('[data-region="items-container"]');if(!itemsContainer)return;itemsContainer.innerHTML="",this.itemComponents.clear();const state=this.reactive.state,items=Array.from(state.items.values()).filter((item=>item.categoryid===this.categoryData.id)).sort(((a,b)=>a.sortorder-b.sortorder));for(const itemData of items){const itemComponent=new this.ItemComponentClass(this.reactive,itemData),itemElement=await itemComponent.render();itemsContainer.appendChild(itemElement),this.itemComponents.set(itemData.id,itemComponent)}this.updateNoItemsMessage(0===items.length)}updateNoItemsMessage(show){const noItemsMsg=this.element.querySelector('[data-region="no-items"]');noItemsMsg&&(show?noItemsMsg.classList.remove("d-none"):noItemsMsg.classList.add("d-none"))}attachEventListeners(){if(!this.element)return;const addItemBtn=this.element.querySelector('[data-action="add-item"]');addItemBtn&&addItemBtn.addEventListener("click",(e=>{e.preventDefault(),this.handleAddItem()}));const editBtn=this.element.querySelector('[data-action="edit-category"]');editBtn&&editBtn.addEventListener("click",(e=>{e.preventDefault(),this.handleEdit()}));const deleteBtn=this.element.querySelector('[data-action="delete-category"]');deleteBtn&&deleteBtn.addEventListener("click",(e=>{e.preventDefault(),this.handleDelete()}))}attachDragDropListeners(){if(!this.element)return;const header=this.element.querySelector('[data-region="category-header"]');header&&(header.setAttribute("draggable","true"),header.classList.add("draggable-category"),header.addEventListener("dragstart",(e=>{e.dataTransfer.effectAllowed="move",e.dataTransfer.setData("application/x-bookit-category-id",this.categoryData.id),this.element.classList.add("dragging")})),header.addEventListener("dragend",(()=>{this.element.classList.remove("dragging")})),header.addEventListener("dragover",(e=>{e.preventDefault(),e.dataTransfer.dropEffect="move"})),header.addEventListener("drop",(e=>{e.preventDefault();const draggedCategoryId=parseInt(e.dataTransfer.getData("application/x-bookit-category-id"),10);draggedCategoryId&&draggedCategoryId!==this.categoryData.id&&this.handleReorder(draggedCategoryId,this.categoryData.id)})));const itemsContainer=this.element.querySelector('[data-region="items-container"]');itemsContainer&&(itemsContainer.addEventListener("dragover",(e=>{e.preventDefault(),e.dataTransfer.dropEffect="move"})),itemsContainer.addEventListener("drop",(e=>{e.preventDefault();const itemId=parseInt(e.dataTransfer.getData("application/x-bookit-item-id"),10);itemId&&this.handleItemMovedToCategory(itemId)})))}async handleAddItem(){const instance=new(0,this.ItemComponentClass)(this.reactive,{categoryid:this.categoryData.id}),modalForm=new _modalform.default({formClass:instance.getEditModalFormClass(),args:{id:0,categoryid:this.categoryData.id},modalConfig:{title:await this.getAddItemModalTitle()}});modalForm.addEventListener(modalForm.events.FORM_SUBMITTED,(e=>{this.reactive.dispatch("createItem",e.detail)})),modalForm.show()}async getAddItemModalTitle(){return(0,_str.get_string)("resources:add_resource","mod_bookit")}async handleEdit(){const modalForm=new _modalform.default({formClass:this.getEditModalFormClass(),args:{id:this.categoryData.id},modalConfig:{title:await this.getEditModalTitle()}});modalForm.addEventListener(modalForm.events.FORM_SUBMITTED,(e=>{this.reactive.dispatch("updateCategory",e.detail)})),modalForm.show()}async getEditModalTitle(){return(0,_str.get_string)("resources:edit_category","mod_bookit")}async handleDelete(){const message=await(0,_str.get_string)("resources:confirm_delete_category","mod_bookit",this.categoryData.name);window.confirm(message)&&this.reactive.dispatch("deleteCategory",this.categoryData.id)}handleReorder(draggedCategoryId,targetCategoryId){this.reactive.dispatch("reorderCategory",{categoryId:draggedCategoryId,targetCategoryId:targetCategoryId})}handleItemMovedToCategory(itemId){const item=this.reactive.state.items.get(itemId);item&&item.categoryid!==this.categoryData.id&&this.reactive.dispatch("updateItem",{...item,categoryid:this.categoryData.id})}update(newData){return this.categoryData=newData,this.element&&this.element.parentNode?this.render().then((newElement=>(this.element.parentNode.replaceChild(newElement,this.element),newElement))).catch((error=>{throw window.console.error("Error updating category:",error),error})):Promise.resolve()}remove(){this.itemComponents.forEach((component=>component.remove())),this.itemComponents.clear(),this.element&&this.element.parentNode&&this.element.parentNode.removeChild(this.element)}},_exports.default}));

//# sourceMappingURL=catalog_category_component.min.js.map