{"version":3,"file":"catalog_catalog_component.min.js","sources":["../../src/base/catalog_catalog_component.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Base component for catalog container.\n *\n * @module mod_bookit/base/catalog_catalog_component\n * @copyright   2026 ssystems GmbH <oss@ssystems.de>\n * @author      Andreas Rosenthal\n * @license     http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\nimport ModalForm from 'core_form/modalform';\nimport {get_string as getString} from 'core/str';\n\n/**\n * Base class for catalog container component.\n */\nexport default class CatalogCatalogComponent {\n    /**\n     * Constructor.\n     *\n     * @param {Object} reactive - Reactive store instance\n     * @param {Function} CategoryComponentClass - Category component class constructor\n     */\n    constructor(reactive, CategoryComponentClass) {\n        this.reactive = reactive;\n        this.CategoryComponentClass = CategoryComponentClass;\n        this.containerElement = null;\n        this.categoriesContainer = null;\n        this.categoryComponents = new Map();\n    }\n\n    /**\n     * Initialize the catalog.\n     *\n     * @param {string} containerId - Container element ID\n     */\n    async init(containerId) {\n        this.containerElement = document.getElementById(containerId);\n\n        if (!this.containerElement) {\n            window.console.error('Catalog container not found:', containerId);\n            return;\n        }\n\n        this.categoriesContainer = this.containerElement.querySelector('#mod-bookit-resource-categories');\n\n        if (!this.categoriesContainer) {\n            window.console.error('Categories container not found');\n            return;\n        }\n\n        await this.registerWatchers();\n        await this.renderCategories();\n        this.attachEventListeners();\n        this.hideSpinner();\n        this.showContent();\n    }\n\n    /**\n     * Register state watchers.\n     */\n    async registerWatchers() {\n        // Watch for category changes.\n        return this.reactive.stateReady.then(() => {\n            const state = this.reactive.state;\n\n            // Watch categories map.\n            if (state.categories) {\n                this.reactive.watch(() => state.categories, () => {\n                    this.renderCategories();\n                });\n            }\n\n            // Watch items map.\n            if (state.items) {\n                this.reactive.watch(() => state.items, () => {\n                    this.renderCategories();\n                });\n            }\n            return true;\n        }).catch((error) => {\n            window.console.error('Error registering watchers:', error);\n            throw error;\n        });\n    }\n\n    /**\n     * Render all categories.\n     */\n    async renderCategories() {\n        if (!this.categoriesContainer) {\n            return;\n        }\n\n        const state = this.reactive.state;\n        const categories = Array.from(state.categories.values())\n            .sort((a, b) => a.sortorder - b.sortorder);\n\n        // Clear existing.\n        this.categoriesContainer.innerHTML = '';\n        this.categoryComponents.clear();\n\n        if (categories.length === 0) {\n            this.showNoCategoriesMessage();\n            return;\n        }\n\n        this.hideNoCategoriesMessage();\n\n        // Render each category.\n        for (const categoryData of categories) {\n            const categoryComponent = new this.CategoryComponentClass(\n                this.reactive,\n                categoryData,\n                this.getItemComponentClass()\n            );\n            const categoryElement = await categoryComponent.render();\n            this.categoriesContainer.appendChild(categoryElement);\n            this.categoryComponents.set(categoryData.id, categoryComponent);\n        }\n    }\n\n    /**\n     * Get item component class.\n     *\n     * ABSTRACT - Must be implemented by subclass.\n     *\n     * @return {Function} Item component class constructor\n     */\n    getItemComponentClass() {\n        throw new Error('getItemComponentClass() must be implemented by subclass');\n    }\n\n    /**\n     * Get the form class name for adding category.\n     *\n     * ABSTRACT - Must be implemented by subclass.\n     *\n     * @return {string} Form class name\n     */\n    getAddCategoryModalFormClass() {\n        throw new Error('getAddCategoryModalFormClass() must be implemented by subclass');\n    }\n\n    /**\n     * Attach event listeners.\n     */\n    attachEventListeners() {\n        const addCategoryBtn = document.getElementById('add-category-btn');\n        if (addCategoryBtn) {\n            addCategoryBtn.addEventListener('click', (e) => {\n                e.preventDefault();\n                this.handleAddCategory();\n            });\n        }\n    }\n\n    /**\n     * Handle add category action.\n     */\n    async handleAddCategory() {\n        const modalForm = new ModalForm({\n            formClass: this.getAddCategoryModalFormClass(),\n            args: {\n                id: 0,\n            },\n            modalConfig: {\n                title: await this.getAddCategoryModalTitle(),\n            },\n        });\n\n        modalForm.addEventListener(modalForm.events.FORM_SUBMITTED, (e) => {\n            this.reactive.dispatch('createCategory', e.detail);\n        });\n\n        modalForm.show();\n    }\n\n    /**\n     * Get add category modal title.\n     *\n     * @return {Promise<string>} Modal title\n     */\n    async getAddCategoryModalTitle() {\n        return getString('resources:add_category', 'mod_bookit');\n    }\n\n    /**\n     * Hide spinner.\n     */\n    hideSpinner() {\n        const spinner = document.getElementById('mod-bookit-resource-spinner');\n        if (spinner) {\n            spinner.classList.add('d-none');\n        }\n    }\n\n    /**\n     * Show content.\n     */\n    showContent() {\n        const content = document.getElementById('mod-bookit-resource-content');\n        if (content) {\n            content.classList.remove('d-none');\n        }\n    }\n\n    /**\n     * Show no categories message.\n     */\n    showNoCategoriesMessage() {\n        const msg = document.getElementById('mod-bookit-no-categories');\n        if (msg) {\n            msg.classList.remove('d-none');\n        }\n    }\n\n    /**\n     * Hide no categories message.\n     */\n    hideNoCategoriesMessage() {\n        const msg = document.getElementById('mod-bookit-no-categories');\n        if (msg) {\n            msg.classList.add('d-none');\n        }\n    }\n}\n"],"names":["constructor","reactive","CategoryComponentClass","containerElement","categoriesContainer","categoryComponents","Map","containerId","document","getElementById","this","querySelector","registerWatchers","renderCategories","attachEventListeners","hideSpinner","showContent","window","console","error","stateReady","then","state","categories","watch","items","catch","Array","from","values","sort","a","b","sortorder","innerHTML","clear","length","hideNoCategoriesMessage","categoryData","categoryComponent","getItemComponentClass","categoryElement","render","appendChild","set","id","showNoCategoriesMessage","Error","getAddCategoryModalFormClass","addCategoryBtn","addEventListener","e","preventDefault","handleAddCategory","modalForm","ModalForm","formClass","args","modalConfig","title","getAddCategoryModalTitle","events","FORM_SUBMITTED","dispatch","detail","show","spinner","classList","add","content","remove","msg"],"mappings":";;;;;;;;iLAqCIA,YAAYC,SAAUC,6BACbD,SAAWA,cACXC,uBAAyBA,4BACzBC,iBAAmB,UACnBC,oBAAsB,UACtBC,mBAAqB,IAAIC,eAQvBC,kBACFJ,iBAAmBK,SAASC,eAAeF,aAE3CG,KAAKP,uBAKLC,oBAAsBM,KAAKP,iBAAiBQ,cAAc,mCAE1DD,KAAKN,2BAKJM,KAAKE,yBACLF,KAAKG,wBACNC,4BACAC,mBACAC,eARDC,OAAOC,QAAQC,MAAM,mCAPrBF,OAAOC,QAAQC,MAAM,+BAAgCZ,6CAuBlDG,KAAKT,SAASmB,WAAWC,MAAK,WAC3BC,MAAQZ,KAAKT,SAASqB,aAGxBA,MAAMC,iBACDtB,SAASuB,OAAM,IAAMF,MAAMC,aAAY,UACnCV,sBAKTS,MAAMG,YACDxB,SAASuB,OAAM,IAAMF,MAAMG,QAAO,UAC9BZ,uBAGN,KACRa,OAAOP,cACNF,OAAOC,QAAQC,MAAM,8BAA+BA,OAC9CA,sCAQLT,KAAKN,iCAIJkB,MAAQZ,KAAKT,SAASqB,MACtBC,WAAaI,MAAMC,KAAKN,MAAMC,WAAWM,UAC1CC,MAAK,CAACC,EAAGC,IAAMD,EAAEE,UAAYD,EAAEC,oBAG/B7B,oBAAoB8B,UAAY,QAChC7B,mBAAmB8B,QAEE,IAAtBZ,WAAWa,aAKVC,8BAGA,MAAMC,gBAAgBf,WAAY,OAC7BgB,kBAAoB,IAAI7B,KAAKR,uBAC/BQ,KAAKT,SACLqC,aACA5B,KAAK8B,yBAEHC,sBAAwBF,kBAAkBG,cAC3CtC,oBAAoBuC,YAAYF,sBAChCpC,mBAAmBuC,IAAIN,aAAaO,GAAIN,8BAfxCO,0BA0BbN,8BACU,IAAIO,MAAM,2DAUpBC,qCACU,IAAID,MAAM,kEAMpBjC,6BACUmC,eAAiBzC,SAASC,eAAe,oBAC3CwC,gBACAA,eAAeC,iBAAiB,SAAUC,IACtCA,EAAEC,sBACGC,uDASPC,UAAY,IAAIC,mBAAU,CAC5BC,UAAW9C,KAAKsC,+BAChBS,KAAM,CACFZ,GAAI,GAERa,YAAa,CACTC,YAAajD,KAAKkD,8BAI1BN,UAAUJ,iBAAiBI,UAAUO,OAAOC,gBAAiBX,SACpDlD,SAAS8D,SAAS,iBAAkBZ,EAAEa,WAG/CV,UAAUW,+CASH,mBAAU,yBAA0B,cAM/ClD,oBACUmD,QAAU1D,SAASC,eAAe,+BACpCyD,SACAA,QAAQC,UAAUC,IAAI,UAO9BpD,oBACUqD,QAAU7D,SAASC,eAAe,+BACpC4D,SACAA,QAAQF,UAAUG,OAAO,UAOjCxB,gCACUyB,IAAM/D,SAASC,eAAe,4BAChC8D,KACAA,IAAIJ,UAAUG,OAAO,UAO7BjC,gCACUkC,IAAM/D,SAASC,eAAe,4BAChC8D,KACAA,IAAIJ,UAAUC,IAAI"}