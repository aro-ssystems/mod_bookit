{"version":3,"file":"catalog_item_component.min.js","sources":["../../src/base/catalog_item_component.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Base component for catalog items.\n *\n * @module mod_bookit/base/catalog_item_component\n * @copyright   2026 ssystems GmbH <oss@ssystems.de>\n * @author      Andreas Rosenthal\n * @license     http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\nimport Templates from 'core/templates';\nimport ModalForm from 'core_form/modalform';\nimport {get_string as getString} from 'core/str';\n\n/**\n * Base class for catalog item components.\n *\n * Abstract class - must be extended by concrete implementations.\n */\nexport default class CatalogItemComponent {\n    /**\n     * Constructor.\n     *\n     * @param {Object} reactive - Reactive store instance\n     * @param {Object} itemData - Item data from state\n     */\n    constructor(reactive, itemData) {\n        this.reactive = reactive;\n        this.itemData = itemData;\n        this.element = null;\n    }\n\n    /**\n     * Render the item to a DOM element.\n     *\n     * @return {Promise<HTMLElement>} Rendered element\n     */\n    async render() {\n        const context = this.getTemplateContext();\n        const html = await Templates.render(this.getTemplateName(), context);\n\n        const wrapper = document.createElement('div');\n        wrapper.innerHTML = html.trim();\n        this.element = wrapper.firstChild;\n\n        this.attachEventListeners();\n        this.attachDragDropListeners();\n\n        return this.element;\n    }\n\n    /**\n     * Get template name for rendering.\n     *\n     * ABSTRACT - Must be implemented by subclass.\n     *\n     * @return {string} Template name (e.g., 'mod_bookit/resource_item_card')\n     */\n    getTemplateName() {\n        throw new Error('getTemplateName() must be implemented by subclass');\n    }\n\n    /**\n     * Get template context data.\n     *\n     * @return {Object} Context for template\n     */\n    getTemplateContext() {\n        return {\n            ...this.itemData,\n        };\n    }\n\n    /**\n     * Get the form class name for editing.\n     *\n     * ABSTRACT - Must be implemented by subclass.\n     *\n     * @return {string} Form class name (e.g., 'mod_bookit\\\\form\\\\edit_resource_form')\n     */\n    getEditModalFormClass() {\n        throw new Error('getEditModalFormClass() must be implemented by subclass');\n    }\n\n    /**\n     * Attach event listeners to the element.\n     */\n    attachEventListeners() {\n        if (!this.element) {\n            return;\n        }\n\n        // Edit button.\n        const editBtn = this.element.querySelector('[data-action=\"edit-item\"]');\n        if (editBtn) {\n            editBtn.addEventListener('click', (e) => {\n                e.preventDefault();\n                this.handleEdit();\n            });\n        }\n\n        // Delete button.\n        const deleteBtn = this.element.querySelector('[data-action=\"delete-item\"]');\n        if (deleteBtn) {\n            deleteBtn.addEventListener('click', (e) => {\n                e.preventDefault();\n                this.handleDelete();\n            });\n        }\n    }\n\n    /**\n     * Attach drag and drop listeners.\n     */\n    attachDragDropListeners() {\n        if (!this.element) {\n            return;\n        }\n\n        this.element.setAttribute('draggable', 'true');\n        this.element.classList.add('draggable-item');\n\n        this.element.addEventListener('dragstart', (e) => {\n            e.dataTransfer.effectAllowed = 'move';\n            e.dataTransfer.setData('text/plain', this.itemData.id);\n            e.dataTransfer.setData('application/x-bookit-item-id', this.itemData.id);\n            this.element.classList.add('dragging');\n        });\n\n        this.element.addEventListener('dragend', () => {\n            this.element.classList.remove('dragging');\n        });\n\n        this.element.addEventListener('dragover', (e) => {\n            e.preventDefault();\n            e.dataTransfer.dropEffect = 'move';\n        });\n\n        this.element.addEventListener('drop', (e) => {\n            e.preventDefault();\n            const draggedItemId = parseInt(e.dataTransfer.getData('application/x-bookit-item-id'), 10);\n            this.handleReorder(draggedItemId, this.itemData.id);\n        });\n    }\n\n    /**\n     * Handle edit action.\n     */\n    async handleEdit() {\n        const modalForm = new ModalForm({\n            formClass: this.getEditModalFormClass(),\n            args: {\n                id: this.itemData.id,\n                categoryid: this.itemData.categoryid,\n            },\n            modalConfig: {\n                title: await this.getEditModalTitle(),\n            },\n        });\n\n        modalForm.addEventListener(modalForm.events.FORM_SUBMITTED, (e) => {\n            // Reactive store will handle update via mutation.\n            this.reactive.dispatch('updateItem', e.detail);\n        });\n\n        modalForm.show();\n    }\n\n    /**\n     * Get edit modal title.\n     *\n     * @return {Promise<string>} Modal title\n     */\n    async getEditModalTitle() {\n        return getString('resources:edit_resource', 'mod_bookit');\n    }\n\n    /**\n     * Handle delete action.\n     */\n    async handleDelete() {\n        const message = await getString('resources:confirm_delete_resource', 'mod_bookit', this.itemData.name);\n        // Use eslint-disable for window.confirm as it's acceptable in Moodle context.\n        // eslint-disable-next-line no-alert\n        const confirmed = window.confirm(message);\n\n        if (confirmed) {\n            this.reactive.dispatch('deleteItem', this.itemData.id);\n        }\n    }\n\n    /**\n     * Handle reorder action.\n     *\n     * @param {number} draggedItemId - ID of dragged item\n     * @param {number} targetItemId - ID of target item\n     */\n    handleReorder(draggedItemId, targetItemId) {\n        if (draggedItemId === targetItemId) {\n            return;\n        }\n\n        this.reactive.dispatch('reorderItem', {\n            itemId: draggedItemId,\n            targetItemId: targetItemId,\n            categoryId: this.itemData.categoryid,\n        });\n    }\n\n    /**\n     * Update the element with new data.\n     *\n     * @param {Object} newData - Updated item data\n     */\n    update(newData) {\n        this.itemData = newData;\n        // Re-render if needed.\n        if (this.element && this.element.parentNode) {\n            return this.render().then(newElement => {\n                this.element.parentNode.replaceChild(newElement, this.element);\n                return newElement;\n            }).catch((error) => {\n                window.console.error('Error updating item:', error);\n                throw error;\n            });\n        }\n        return Promise.resolve();\n    }\n\n    /**\n     * Remove the element from DOM.\n     */\n    remove() {\n        if (this.element && this.element.parentNode) {\n            this.element.parentNode.removeChild(this.element);\n        }\n    }\n}\n"],"names":["constructor","reactive","itemData","element","context","this","getTemplateContext","html","Templates","render","getTemplateName","wrapper","document","createElement","innerHTML","trim","firstChild","attachEventListeners","attachDragDropListeners","Error","getEditModalFormClass","editBtn","querySelector","addEventListener","e","preventDefault","handleEdit","deleteBtn","handleDelete","setAttribute","classList","add","dataTransfer","effectAllowed","setData","id","remove","dropEffect","draggedItemId","parseInt","getData","handleReorder","modalForm","ModalForm","formClass","args","categoryid","modalConfig","title","getEditModalTitle","events","FORM_SUBMITTED","dispatch","detail","show","message","name","window","confirm","targetItemId","itemId","categoryId","update","newData","parentNode","then","newElement","replaceChild","catch","error","console","Promise","resolve","removeChild"],"mappings":";;;;;;;;+MAwCIA,YAAYC,SAAUC,eACbD,SAAWA,cACXC,SAAWA,cACXC,QAAU,0BASTC,QAAUC,KAAKC,qBACfC,WAAaC,mBAAUC,OAAOJ,KAAKK,kBAAmBN,SAEtDO,QAAUC,SAASC,cAAc,cACvCF,QAAQG,UAAYP,KAAKQ,YACpBZ,QAAUQ,QAAQK,gBAElBC,4BACAC,0BAEEb,KAAKF,QAUhBO,wBACU,IAAIS,MAAM,qDAQpBb,2BACW,IACAD,KAAKH,UAWhBkB,8BACU,IAAID,MAAM,2DAMpBF,2BACSZ,KAAKF,qBAKJkB,QAAUhB,KAAKF,QAAQmB,cAAc,6BACvCD,SACAA,QAAQE,iBAAiB,SAAUC,IAC/BA,EAAEC,sBACGC,sBAKPC,UAAYtB,KAAKF,QAAQmB,cAAc,+BACzCK,WACAA,UAAUJ,iBAAiB,SAAUC,IACjCA,EAAEC,sBACGG,kBAQjBV,0BACSb,KAAKF,eAILA,QAAQ0B,aAAa,YAAa,aAClC1B,QAAQ2B,UAAUC,IAAI,uBAEtB5B,QAAQoB,iBAAiB,aAAcC,IACxCA,EAAEQ,aAAaC,cAAgB,OAC/BT,EAAEQ,aAAaE,QAAQ,aAAc7B,KAAKH,SAASiC,IACnDX,EAAEQ,aAAaE,QAAQ,+BAAgC7B,KAAKH,SAASiC,SAChEhC,QAAQ2B,UAAUC,IAAI,oBAG1B5B,QAAQoB,iBAAiB,WAAW,UAChCpB,QAAQ2B,UAAUM,OAAO,oBAG7BjC,QAAQoB,iBAAiB,YAAaC,IACvCA,EAAEC,iBACFD,EAAEQ,aAAaK,WAAa,eAG3BlC,QAAQoB,iBAAiB,QAASC,IACnCA,EAAEC,uBACIa,cAAgBC,SAASf,EAAEQ,aAAaQ,QAAQ,gCAAiC,SAClFC,cAAcH,cAAejC,KAAKH,SAASiC,iCAQ9CO,UAAY,IAAIC,mBAAU,CAC5BC,UAAWvC,KAAKe,wBAChByB,KAAM,CACFV,GAAI9B,KAAKH,SAASiC,GAClBW,WAAYzC,KAAKH,SAAS4C,YAE9BC,YAAa,CACTC,YAAa3C,KAAK4C,uBAI1BP,UAAUnB,iBAAiBmB,UAAUQ,OAAOC,gBAAiB3B,SAEpDvB,SAASmD,SAAS,aAAc5B,EAAE6B,WAG3CX,UAAUY,wCASH,mBAAU,0BAA2B,yCAOtCC,cAAgB,mBAAU,oCAAqC,aAAclD,KAAKH,SAASsD,MAG/EC,OAAOC,QAAQH,eAGxBtD,SAASmD,SAAS,aAAc/C,KAAKH,SAASiC,IAU3DM,cAAcH,cAAeqB,cACrBrB,gBAAkBqB,mBAIjB1D,SAASmD,SAAS,cAAe,CAClCQ,OAAQtB,cACRqB,aAAcA,aACdE,WAAYxD,KAAKH,SAAS4C,aASlCgB,OAAOC,qBACE7D,SAAW6D,QAEZ1D,KAAKF,SAAWE,KAAKF,QAAQ6D,WACtB3D,KAAKI,SAASwD,MAAKC,kBACjB/D,QAAQ6D,WAAWG,aAAaD,WAAY7D,KAAKF,SAC/C+D,cACRE,OAAOC,cACNZ,OAAOa,QAAQD,MAAM,uBAAwBA,OACvCA,SAGPE,QAAQC,UAMnBpC,SACQ/B,KAAKF,SAAWE,KAAKF,QAAQ6D,iBACxB7D,QAAQ6D,WAAWS,YAAYpE,KAAKF"}