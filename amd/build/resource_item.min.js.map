{"version":3,"file":"resource_item.min.js","sources":["../src/resource_item.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Resource item reactive component.\n *\n * @module mod_bookit/resource_item\n * @copyright   2026 ssystems GmbH <oss@ssystems.de>\n * @author      Andreas Rosenthal\n * @license     http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\nimport {BaseComponent} from 'core/reactive';\nimport Templates from 'core/templates';\nimport ModalForm from 'core_form/modalform';\nimport {get_string as getString} from 'core/str';\nimport Notification from 'core/notification';\n\n/**\n * Resource item component.\n */\nexport default class ResourceItem extends BaseComponent {\n    /**\n     * Component descriptor for debugging.\n     *\n     * @return {string} Component name\n     */\n    static get componentName() {\n        return 'mod_bookit/resource_item';\n    }\n\n    /**\n     * Create component.\n     *\n     * @param {Object} options - Component options\n     * @param {HTMLElement} options.element - Parent container element\n     * @param {Object} options.itemData - Item data\n     */\n    create({element, itemData}) {\n        this.itemData = itemData;\n        this.itemElement = null;\n        this.parentElement = element;\n\n        // Render immediately.\n        this._render();\n    }\n\n    /**\n     * Get state watchers.\n     *\n     * Resource items don't need state watchers -\n     * parent category handles item changes.\n     *\n     * @return {Array} Empty array\n     */\n    getWatchers() {\n        return [];\n    }\n\n    /**\n     * Render item (table row).\n     */\n    async _render() {\n        const html = await Templates.render('mod_bookit/resource_item_row', this.itemData);\n\n        const wrapper = document.createElement('tbody');\n        wrapper.innerHTML = html.trim();\n        this.itemElement = wrapper.firstChild;\n\n        this.parentElement.appendChild(this.itemElement);\n\n        this._attachEventListeners();\n    }\n\n    /**\n     * Attach event listeners.\n     */\n    _attachEventListeners() {\n        if (!this.itemElement) {\n            return;\n        }\n\n        // Edit Item.\n        const editBtn = this.itemElement.querySelector('[data-action=\"edit-item\"]');\n        if (editBtn) {\n            editBtn.addEventListener('click', (e) => {\n                e.preventDefault();\n                this._handleEdit();\n            });\n        }\n    }\n\n    /**\n     * Handle edit item.\n     */\n    async _handleEdit() {\n        const modalForm = new ModalForm({\n            formClass: 'mod_bookit\\\\form\\\\edit_resource_form',\n            moduleName: 'mod_bookit/modal_delete_save_cancel',\n            args: {\n                id: this.itemData.id,\n            },\n            modalConfig: {\n                title: await getString('resources:edit_resource', 'mod_bookit'),\n            },\n        });\n\n        modalForm.addEventListener(modalForm.events.FORM_SUBMITTED, (e) => {\n            this.reactive.stateManager.processUpdates(e.detail);\n        });\n\n        modalForm.addEventListener(modalForm.events.LOADED, () => {\n            const deleteButton = modalForm.modal.getRoot().find('button[data-action=\"delete\"]');\n\n            deleteButton.on('click', async(e) => {\n                e.preventDefault();\n\n                const confirmTitle = await getString('confirm', 'core');\n                const confirmMessage = await getString('areyousure', 'core');\n                const deleteText = await getString('delete', 'core');\n\n                Notification.deleteCancel(\n                    confirmTitle,\n                    confirmMessage,\n                    deleteText,\n                    () => {\n                        modalForm.getFormNode().querySelector('input[name=\"action\"]').value = 'delete';\n                        modalForm.submitFormAjax();\n                    }\n                );\n            });\n        });\n\n        modalForm.show();\n    }\n\n    /**\n     * Update with new data (re-render table row).\n     *\n     * @param {Object} newData - Updated item data\n     */\n    update(newData) {\n        this.itemData = newData;\n        // Re-render the entire row.\n        Templates.render('mod_bookit/resource_item_row', newData)\n            .then(html => {\n                const wrapper = document.createElement('tbody');\n                wrapper.innerHTML = html.trim();\n                const newRow = wrapper.firstChild;\n                if (this.itemElement && this.itemElement.parentNode) {\n                    this.itemElement.parentNode.replaceChild(newRow, this.itemElement);\n                    this.itemElement = newRow;\n                    this._attachEventListeners();\n                }\n                return true;\n            })\n            .catch(error => {\n                window.console.error('Error updating resource item:', error);\n            });\n    }\n\n    /**\n     * Remove from DOM.\n     */\n    remove() {\n        if (this.itemElement && this.itemElement.parentNode) {\n            this.itemElement.parentNode.removeChild(this.itemElement);\n        }\n    }\n}\n"],"names":["ResourceItem","BaseComponent","componentName","create","element","itemData","itemElement","parentElement","_render","getWatchers","html","Templates","render","this","wrapper","document","createElement","innerHTML","trim","firstChild","appendChild","_attachEventListeners","editBtn","querySelector","addEventListener","e","preventDefault","_handleEdit","modalForm","ModalForm","formClass","moduleName","args","id","modalConfig","title","events","FORM_SUBMITTED","reactive","stateManager","processUpdates","detail","LOADED","modal","getRoot","find","on","async","confirmTitle","confirmMessage","deleteText","deleteCancel","getFormNode","value","submitFormAjax","show","update","newData","then","newRow","parentNode","replaceChild","catch","error","window","console","remove","removeChild"],"mappings":";;;;;;;;2OAiCqBA,qBAAqBC,wBAM3BC,iCACA,2BAUXC,iBAAOC,QAACA,QAADC,SAAUA,oBACRA,SAAWA,cACXC,YAAc,UACdC,cAAgBH,aAGhBI,UAWTC,oBACW,yBAODC,WAAaC,mBAAUC,OAAO,+BAAgCC,KAAKR,UAEnES,QAAUC,SAASC,cAAc,SACvCF,QAAQG,UAAYP,KAAKQ,YACpBZ,YAAcQ,QAAQK,gBAEtBZ,cAAca,YAAYP,KAAKP,kBAE/Be,wBAMTA,4BACSR,KAAKP,yBAKJgB,QAAUT,KAAKP,YAAYiB,cAAc,6BAC3CD,SACAA,QAAQE,iBAAiB,SAAUC,IAC/BA,EAAEC,sBACGC,2CASPC,UAAY,IAAIC,mBAAU,CAC5BC,UAAW,uCACXC,WAAY,sCACZC,KAAM,CACFC,GAAIpB,KAAKR,SAAS4B,IAEtBC,YAAa,CACTC,YAAa,mBAAU,0BAA2B,iBAI1DP,UAAUJ,iBAAiBI,UAAUQ,OAAOC,gBAAiBZ,SACpDa,SAASC,aAAaC,eAAef,EAAEgB,WAGhDb,UAAUJ,iBAAiBI,UAAUQ,OAAOM,QAAQ,KAC3Bd,UAAUe,MAAMC,UAAUC,KAAK,gCAEvCC,GAAG,SAASC,MAAAA,IACrBtB,EAAEC,uBAEIsB,mBAAqB,mBAAU,UAAW,QAC1CC,qBAAuB,mBAAU,aAAc,QAC/CC,iBAAmB,mBAAU,SAAU,8BAEhCC,aACTH,aACAC,eACAC,YACA,KACItB,UAAUwB,cAAc7B,cAAc,wBAAwB8B,MAAQ,SACtEzB,UAAU0B,0BAM1B1B,UAAU2B,OAQdC,OAAOC,cACEpD,SAAWoD,2BAEN7C,OAAO,+BAAgC6C,SAC5CC,MAAKhD,aACII,QAAUC,SAASC,cAAc,SACvCF,QAAQG,UAAYP,KAAKQ,aACnByC,OAAS7C,QAAQK,kBACnBN,KAAKP,aAAeO,KAAKP,YAAYsD,kBAChCtD,YAAYsD,WAAWC,aAAaF,OAAQ9C,KAAKP,kBACjDA,YAAcqD,YACdtC,0BAEF,KAEVyC,OAAMC,QACHC,OAAOC,QAAQF,MAAM,gCAAiCA,UAOlEG,SACQrD,KAAKP,aAAeO,KAAKP,YAAYsD,iBAChCtD,YAAYsD,WAAWO,YAAYtD,KAAKP"}